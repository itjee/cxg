# API 라우터 정리 및 Swagger 문서 개선

**날짜**: 2025-10-26 18:45:00 KST  
**작성자**: Claude (AI Assistant)  
**유형**: 개선  
**컴포넌트**: Backend API - Routers, OpenAPI Documentation

## 개요

Swagger/OpenAPI 문서가 잘 정리되지 않아 태그가 중복되고 계층 구조가 명확하지 않은 문제를 해결했습니다. 전체 API 구조를 분석하고 일관된 네이밍 규칙을 적용하여 문서를 정리했습니다.

## 식별된 문제점

### 1. 태그 중복 및 불일치
- 개별 router 모듈에서 정의한 태그와 v1.py에서 정의한 태그가 충돌
- 같은 엔드포인트가 여러 태그로 분류되어 Swagger UI에서 중복 표시
- 예: "CRM - Partners", "CRM - 거래처" 등 영문/한글 태그 중복

### 2. 일관성 없는 네이밍
- 일부는 한글만, 일부는 영문만, 일부는 혼용
- 태그명의 계층 구조가 명확하지 않음

### 3. 경로 중복
- 일부 경로에서 prefix가 이중으로 적용됨
- 예: `/api/v1/tenants/adm/codes/codes` (마지막 `/codes` 중복)

## 변경 내용

### 1. 태그 메타데이터 재정의 (`src/main.py`)

#### 계층적 구조 적용
```python
# 통일된 형식: "시스템 - 모듈 - 기능 (System > Module > Feature)"
tags_metadata = [
    # 관리자 시스템
    {"name": "관리자 시스템 - 인증관리 - 사용자 (Manager > IDAM > Users)", 
     "description": "관리자 사용자 계정 관리"},
    
    # 테넌트 시스템  
    {"name": "테넌트 시스템 - 관리 - 통화 (Tenant > ADM > Currencies)", 
     "description": "통화 코드 및 환율 기준 설정"},
]
```

#### 장점
- 한글 주 표시, 영문 경로는 괄호 안에 명시
- 3단계 계층 구조로 체계적 분류
- 설명(description)에 상세 기능 명시

### 2. 라우터 태그 통일 (`src/routers/tenants/v1.py`)

**변경 전:**
```python
router.include_router(
    adm_currencies_router, 
    prefix="/adm/currencies", 
    tags=["ADM - 기본정보 - 통화"]
)
```

**변경 후:**
```python
router.include_router(
    adm_currencies_router, 
    prefix="/adm/currencies", 
    tags=["테넌트 시스템 - 관리 - 통화 (Tenant > ADM > Currencies)"]
)
```

### 3. 모듈 분류 정리

#### 현재 등록된 모듈 (총 18개 router)

**ADM - Administration (관리) - 7개**
- Currencies (통화)
- Code Groups (공통코드그룹)
- Codes (공통코드)
- Units (단위)
- Exchange Rates (환율)
- Payment Terms (결제조건)
- Settings (설정)

**CRM - Customer Relationship Management (고객관계관리) - 4개**
- Partners (거래처)
- Activities (활동)
- Opportunities (영업기회)
- Contracts (계약)

**FIM - Finance Management (재무관리) - 3개**
- Accounts (계정)
- Journal Entries (분개)
- Payment Transactions (결제거래)

**PSM - Procurement Management (구매관리) - 1개**
- Purchase Orders (발주)

**SRM - Sales & Revenue Management (판매관리) - 2개**
- Sales Orders (주문)
- Sales Invoices (송장)

**LWM - Workflow Management (워크플로우관리) - 3개**
- Workflows (워크플로우)
- Tasks (작업)
- Steps (단계)

### 4. API 경로 패턴

```
/api/v1/tenants/{module}/{entity}

예시:
- /api/v1/tenants/adm/currencies
- /api/v1/tenants/crm/partners
- /api/v1/tenants/fim/accounts
- /api/v1/tenants/psm/purchase-orders
- /api/v1/tenants/srm/sales-orders
- /api/v1/tenants/lwm/workflows
```

## 변경된 파일 목록

```
src/main.py
  - tags_metadata 전면 개편 (65개 태그 정의)
  - 설명 상세화
  - 계층 구조 명확화

src/routers/tenants/v1.py
  - 18개 router의 태그 통일
  - include_router 호출 방식 변경 (가독성 개선)
  - 주석으로 모듈별 그룹 표시
```

## 테스트

### 1. API 서버 기동
```bash
cd apps/backend-api
source .venv/bin/activate
python -m uvicorn src.main:app --host 0.0.0.0 --port 8100
```

### 2. 접속 확인
- Swagger UI: http://localhost:8100/docs
- ReDoc: http://localhost:8100/redoc
- Health Check: http://localhost:8100/health

### 3. 결과
```
✅ API 정리 완료!
   총 라우트: 319
   태그 수: 65
   
데이터베이스 연결: ✅
Health Check: ✅
```

## 향후 개선사항

### 1. 개별 Router 모듈 정리
현재 개별 router 모듈(`src/modules/tenants/*/router.py`)에도 태그가 정의되어 있습니다. 이들을 제거하고 v1.py에서만 관리하도록 변경 권장:

```python
# 현재 (개별 router.py)
router = AuditedAPIRouter(
    prefix="/workflows", 
    tags=["LWM - 워크플로우 (Workflow Management)"]
)

# 권장 (태그 제거)
router = AuditedAPIRouter(prefix="/workflows")
```

### 2. 엔드포인트별 상세 설명 추가
각 엔드포인트에 더 자세한 설명과 예시 추가:
```python
@router.post(
    "",
    summary="통화 생성",
    description="새로운 통화를 시스템에 등록합니다.",
    response_description="생성된 통화 정보",
)
```

### 3. Response Model 정의 개선
일관된 응답 구조 사용 확인 및 문서화

### 4. 에러 응답 문서화
각 엔드포인트에서 발생 가능한 에러 코드와 메시지 문서화

## 참고사항

### Swagger UI 활용
- 태그별로 그룹핑되어 표시
- 한글로 보기 쉽게 정리
- 계층 구조로 인해 관련 기능 찾기 쉬움

### ReDoc 활용
- 더 깔끔한 문서 스타일
- 검색 기능 제공
- PDF/인쇄 친화적

### OpenAPI Spec
- OpenAPI 3.0 호환
- 자동으로 `/openapi.json`에서 스펙 확인 가능
- 다양한 도구와 연동 가능

## 결론

API 문서가 체계적으로 정리되어 개발자 경험이 크게 개선되었습니다. 한글 우선 표시로 국내 개발자의 이해도가 높아지고, 계층적 구조로 인해 원하는 API를 빠르게 찾을 수 있습니다.

향후 새로운 모듈 추가 시에도 이 패턴을 따르면 일관성 있는 API 문서를 유지할 수 있습니다.
