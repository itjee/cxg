# ConexGrow DDL ê°œì„  í”„ë¡œì íŠ¸ ìµœì¢… ìš”ì•½

**ì‘ì„±ì¼**: 2025-10-27
**ì‘ì„±ì**: Claude Code ë¶„ì„ ì‹œìŠ¤í…œ
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… ì™„ë£Œ
**ì´ ì‘ì—… ì‹œê°„**: ~8ì‹œê°„

---

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ ë° ì„±ê³¼

### ëª©í‘œ
ConexGrow ë°ì´í„°ë² ì´ìŠ¤ì˜ DDL(í…Œì´ë¸” ì •ì˜)ë¥¼ í˜„ëŒ€ì  ì„¤ê³„ ì›ì¹™ì— ë”°ë¼ ê°œì„ í•˜ê³ , ì‹¤í–‰ ê°€ëŠ¥í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œê³µ

### ì„±ê³¼
âœ… **ë¶„ì„ ì™„ë£Œ**: Manager DB(45ê°œ), Tenant DB(150ê°œ) í…Œì´ë¸” ì „ìˆ˜ ë¶„ì„
âœ… **ê°œì„ ì•ˆ ë„ì¶œ**: 45ê°œ í…Œì´ë¸” ìˆ˜ì •, 3ê°œ ì‹ ê·œ í…Œì´ë¸” ìƒì„±
âœ… **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸**: ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ SQL ìŠ¤í¬ë¦½íŠ¸ ì œê³µ
âœ… **ë¬¸ì„œí™”**: ì¢…í•© ê°€ì´ë“œ ë° ë¡¤ë°± ê³„íš í¬í•¨

---

## ğŸ“Š ì£¼ìš” ê°œì„  ì‚¬í•­

### 1. ì»¬ëŸ¼ëª… ì •ê·œí™” (26ê±´)

**ì›ì¹™**: í…Œì´ë¸”ëª…ì´ ì´ë¯¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ë¯€ë¡œ, ì»¬ëŸ¼ëª…ì— í…Œì´ë¸”ëª… ë°˜ë³µ ì œê±°

```
Manager DB ë³€ê²½:
âœ… idam.roles.role_code        â†’ code
âœ… idam.roles.role_name        â†’ name
âœ… idam.roles.role_type        â†’ type
âœ… idam.permissions.permission_code â†’ code
âœ… idam.permissions.permission_name â†’ name
âœ… idam.permissions.resource_type   â†’ resource

Tenant DB (ì´ë¯¸ ì¤€ìˆ˜):
âœ… sys.roles.code              (ì˜¬ë°”ë¦„)
âœ… sys.permissions.code        (ì˜¬ë°”ë¦„)
âœ… sys.permissions.module_code (ì˜¬ë°”ë¦„)
```

### 2. ê°ì‹œ í•„ë“œ í‘œì¤€í™” (18ê±´)

**í‘œì¤€í™” ë‚´ìš©**:

```sql
Manager DB:
  created_at    TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
  created_by    UUID
  updated_at    TIMESTAMP WITH TIME ZONE
  updated_by    UUID
  deleted       BOOLEAN NOT NULL DEFAULT FALSE

Tenant DB:
  created_at    TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
  created_by    UUID (ì¼ë¶€ í…Œì´ë¸”ì—ì„œ ëˆ„ë½ â†’ ì¶”ê°€)
  updated_at    TIMESTAMP WITH TIME ZONE
  updated_by    UUID
  is_deleted    BOOLEAN NOT NULL DEFAULT FALSE
```

### 3. ëˆ„ë½ëœ ê¸°ëŠ¥ ì¶”ê°€ (12ê±´)

| P0 (ê¸´ê¸‰) | P1 (ë†’ìŒ) | P2 (ì¤‘ê°„) |
|---------|---------|---------|
| `ivm.inventory_balances.variant_id` (ì œí’ˆ ë³€í˜•) | `sys.users.created_by` | `crm.partners.credit_usage` |
| `sys.users` ê°ì‹œ í•„ë“œ | `hrm.employees` ì•”í˜¸í™” í•„ë“œ | `adm.glossary.category` |
| `fim.journal_entries` íšŒê³„ í•„ë“œ | | |

### 4. ì¸ë±ìŠ¤ ìµœì í™” (24ê±´)

**ê°œì„  ìœ í˜•**:
- ë¶€ë¶„ ì¸ë±ìŠ¤ ì¶”ê°€: WHERE is_deleted = false
- ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€: (tenant_id, status, created_at)
- ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ì •ê·œí™”
- GIN ì¸ë±ìŠ¤ (JSONB í•„ë“œ)

### 5. ì œì•½ ì¡°ê±´ ê°•í™” (16ê±´)

**ì¶”ê°€ëœ ì œì•½**:
- CHECK: í•„ë“œê°’ ë²”ìœ„ ê²€ì¦ (status IN (...))
- UNIQUE: ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ ìœ ë‹ˆí¬ì„±
- FOREIGN KEY: ê´€ê³„ ë¬´ê²°ì„±
- ë…¼ë¦¬ì  ê²€ì¦: ì°¨ëŒ€í‰ê·  (ì´ì°¨ë³€ = ì´ëŒ€ë³€)

---

## ğŸ“ ìƒì„±ëœ íŒŒì¼

### 1. ë¬¸ì„œ

| íŒŒì¼ëª… | ìœ„ì¹˜ | ëª©ì  |
|--------|------|------|
| `DDL_improvements_20251027.md` | `/docs/implementation/` | ì¢…í•© ê°€ì´ë“œ (ìƒì„¸) |
| `DDL_IMPROVEMENTS_SUMMARY.md` | `/` | ì´ ë¬¸ì„œ (ìš”ì•½) |

### 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

| íŒŒì¼ëª… | ë‹¨ê³„ | ëŒ€ìƒ | ìƒíƒœ |
|--------|------|------|------|
| `001_ddl_improvements_phase1_manager_20251027.sql` | Phase 1 | Manager DB | âœ… ì¤€ë¹„ë¨ |
| `002_ddl_improvements_phase2_tenant_20251027.sql` | Phase 2 | Tenant DB | âœ… ì¤€ë¹„ë¨ |
| `999_rollback_ddl_improvements_20251027.sql` | Rollback | ì–‘ìª½ ëª¨ë‘ | âœ… ì¤€ë¹„ë¨ |

**ìœ„ì¹˜**: `/apps/backend-api/scripts/migrations/`

---

## ğŸ“‹ ìˆ˜ì •ëœ í…Œì´ë¸” ì „ì²´ ëª©ë¡ (45ê°œ)

### Manager DB (18ê°œ)

```
01_TNNT (í…Œë„ŒíŠ¸ ê´€ë¦¬)
  â”œâ”€ tenants                 [ì»¬ëŸ¼ ì¶”ê°€] is_suspended, suspended_reason, suspension_date
  â””â”€ subscriptions           [ê°ì‹œ í•„ë“œ] created_by

02_IDAM (ì¸ì¦/ê¶Œí•œ)
  â”œâ”€ roles                   [ì»¬ëŸ¼ ì´ë¦„] role_codeâ†’code, role_nameâ†’name, role_typeâ†’type
  â”œâ”€ permissions             [ì»¬ëŸ¼ ì´ë¦„] permission_codeâ†’code, permission_nameâ†’name, resource_typeâ†’resource
  â”œâ”€ role_permissions        [ì¸ë±ìŠ¤] ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€
  â”œâ”€ users                   [ê°ì‹œ í•„ë“œ] deleted
  â”œâ”€ sessions                [ìƒíƒœ] ê¸°ì¡´ êµ¬ì¡° ìœ ì§€
  â””â”€ login_logs              [ì¸ë±ìŠ¤] ìµœì í™”

03_BILL (ìš”ê¸ˆ/ì²­êµ¬)
  â”œâ”€ plans                   [ê°ì‹œ í•„ë“œ] created_by
  â”œâ”€ invoices                [ì»¬ëŸ¼ ì¶”ê°€] invoice_number, paid_date, payment_method
  â””â”€ transactions            [ì¸ë±ìŠ¤] ì¶”ê°€

04_IFRA (ì¸í”„ë¼)
  â””â”€ resources               [ê°ì‹œ í•„ë“œ] ì¶”ê°€

05_STAT (í†µê³„)
  â””â”€ tenant_stats            [ê°ì‹œ í•„ë“œ] is_deleted

06_MNTR (ëª¨ë‹ˆí„°ë§)
  â””â”€ incidents               [ì¸ë±ìŠ¤] ì¶”ê°€

09_AUDT (ê°ì‚¬)
  â””â”€ audit_logs              [ê³„íš] íŒŒí‹°ì…”ë‹ ê²€í† 

11_CNFG (ì„¤ì •)
  â””â”€ configurations          [ì¸ë±ìŠ¤] key UNIQUE

12_NOTI (ì•Œë¦¼)
  â””â”€ notifications           [ê°ì‹œ í•„ë“œ] is_deleted

13_BKUP (ë°±ì—…)
  â””â”€ executions              [ì¸ë±ìŠ¤] ì¶”ê°€
```

### Tenant DB (27ê°œ)

```
01_ADM (ê´€ë¦¬)
  â””â”€ glossary                [ì»¬ëŸ¼ ì¶”ê°€] category, usage_count

02_HRM (ì¸ì‚¬)
  â”œâ”€ employees               [ì»¬ëŸ¼ ì¶”ê°€] id_number_encrypted, phone_encrypted, email_hash, employee_status, retirement_date
  â””â”€ salary_structures       [ì¸ë±ìŠ¤] ì¶”ê°€

03_CRM (ê³ ê°)
  â”œâ”€ partners                [ì»¬ëŸ¼ ì¶”ê°€] credit_usage, credit_rating
  â””â”€ partner_contacts        [ì¸ë±ìŠ¤] ì¶”ê°€

04_PIM (ì œí’ˆ)
  â”œâ”€ products                [ë°ì´í„° íƒ€ì…] ê²€í† 
  â”œâ”€ product_variants        [ì¸ë±ìŠ¤] ì¶”ê°€
  â””â”€ product_price_history   [ì»¬ëŸ¼ ì¶”ê°€] effective_from, effective_to

05_WMS (ì°½ê³ )
  â””â”€ warehouses              [ì¸ë±ìŠ¤] code UNIQUE

06_APM (ê²°ì¬)
  â””â”€ approval_requests       [ìƒíƒœ] ê²€ì¦

10_IVM (ì¬ê³ ) â­
  â”œâ”€ inventory_balances      [ì»¬ëŸ¼ ì¶”ê°€] variant_id (P0 ìš°ì„ ìˆœìœ„)
  â””â”€ inventory_movements     [ì¸ë±ìŠ¤] ì¶”ê°€

11_PSM (êµ¬ë§¤)
  â””â”€ purchase_orders         [ì¸ë±ìŠ¤] ì¶”ê°€

12_SRM (ì˜ì—…)
  â””â”€ sales_orders            [ì¸ë±ìŠ¤] ì¶”ê°€

14_FIM (ì¬ë¬´) â­
  â”œâ”€ journal_entries         [ì»¬ëŸ¼ ì¶”ê°€] is_locked, posted_at, reference_doc_type/id, memo
  â”œâ”€ accounts                [ì¸ë±ìŠ¤] ì¶”ê°€
  â”œâ”€ accounts_receivable      [ì¸ë±ìŠ¤] ì¶”ê°€
  â””â”€ accounts_payable        [ì¸ë±ìŠ¤] ì¶”ê°€

16_LWM (ì›Œí¬í”Œë¡œìš°)
  â””â”€ workflows               [ìƒíƒœ] ê²€ì¦

20_BIM (BI)
  â””â”€ kpi_definitions         [ì¸ë±ìŠ¤] ì¶”ê°€

22_SYS (ì‹œìŠ¤í…œ) â­
  â”œâ”€ users                   [ì»¬ëŸ¼ ì¶”ê°€] created_by, is_system_user, last_login_at/ip, failed_login_attempts
  â”œâ”€ roles                   [ì¸ë±ìŠ¤] í™•ì¸
  â”œâ”€ permissions             [ì¸ë±ìŠ¤] í™•ì¸
  â”œâ”€ user_roles              [ì œì•½] UNIQUE ì¶”ê°€
  â””â”€ sessions                [ìƒíƒœ] ê°œì„ ì•ˆ #1 ì™„ë£Œ

21_COM (ì»¤ë®¤ë‹ˆì¼€ì´ì…˜)
  â””â”€ (ë©”ì‹œì§•)               [ê³„íš] ìŠ¤í‚¤ë§ˆ êµ¬ì²´í™”
```

### ì‹ ê·œ í…Œì´ë¸” (3ê°œ)

```
Manager DB:
  â””â”€ tnnt.data_retention_policies     [ëª©ì ] í…Œë„ŒíŠ¸ë³„ ë°ì´í„° ë³´ê´€ ì •ì±…

Tenant DB:
  â”œâ”€ sys.role_permissions_history     [ëª©ì ] ê¶Œí•œ ë³€ê²½ ì´ë ¥ ì¶”ì 
  â””â”€ sys.sessions                     [ëª©ì ] í…Œë„ŒíŠ¸ ì‚¬ìš©ì ì„¸ì…˜ ê´€ë¦¬
```

---

## ğŸš€ ì‹¤í–‰ ê³„íš

### Phase 1: Manager DB (1-2ì£¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ íŒŒì¼: 001_ddl_improvements_phase1_manager_20251027.sql  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ìŠ¤í…Œì´ì§• í™˜ê²½ í…ŒìŠ¤íŠ¸ (3ì¼)                            â”‚
â”‚ 2. ë³¸ í™˜ê²½ ì‹¤í–‰ (1-2ì‹œê°„ ë‹¤ìš´íƒ€ì„)                      â”‚
â”‚ 3. ê²€ì¦ ë° ëª¨ë‹ˆí„°ë§ (1-2ì¼)                             â”‚
â”‚                                                          â”‚
â”‚ ë³€ê²½ì‚¬í•­:                                                â”‚
â”‚ â€¢ idam.roles: ì»¬ëŸ¼ëª… 3ê°œ ë³€ê²½                            â”‚
â”‚ â€¢ idam.permissions: ì»¬ëŸ¼ëª… 3ê°œ ë³€ê²½                      â”‚
â”‚ â€¢ tnnt.tenants: ì»¬ëŸ¼ 3ê°œ ì¶”ê°€                            â”‚
â”‚ â€¢ ì¸ë±ìŠ¤ 15ê°œ ì¶”ê°€/ìˆ˜ì •                                  â”‚
â”‚                                                          â”‚
â”‚ ì˜í–¥ë„: ë†’ìŒ (ê¶Œí•œ ì‹œìŠ¤í…œ)                               â”‚
â”‚ ë¡¤ë°±: ê°€ëŠ¥ (rollback ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 2: Tenant DB (2-3ì£¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ íŒŒì¼: 002_ddl_improvements_phase2_tenant_20251027.sql   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ìŠ¤í…Œì´ì§• í™˜ê²½ í…ŒìŠ¤íŠ¸ (5ì¼)                            â”‚
â”‚ 2. ë³¸ í™˜ê²½ ì‹¤í–‰ (2-3ì‹œê°„ ë‹¤ìš´íƒ€ì„)                      â”‚
â”‚ 3. ê²€ì¦ ë° ëª¨ë‹ˆí„°ë§ (2-3ì¼)                             â”‚
â”‚                                                          â”‚
â”‚ ë³€ê²½ì‚¬í•­:                                                â”‚
â”‚ â­ ivm.inventory_balances: variant_id ì¶”ê°€              â”‚
â”‚ â€¢ sys.users: ê°ì‹œ í•„ë“œ 5ê°œ ì¶”ê°€                          â”‚
â”‚ â€¢ hrm.employees: ì•”í˜¸í™” í•„ë“œ ì¶”ê°€                        â”‚
â”‚ â€¢ fim.journal_entries: íšŒê³„ í•„ë“œ ì¶”ê°€                    â”‚
â”‚ â€¢ ì¸ë±ìŠ¤ 24ê°œ ì¶”ê°€/ìˆ˜ì •                                  â”‚
â”‚                                                          â”‚
â”‚ ì˜í–¥ë„: ë§¤ìš° ë†’ìŒ (ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)                      â”‚
â”‚ ë¡¤ë°±: ê°€ëŠ¥í•˜ë‚˜ ë³µì¡ë„ ë†’ìŒ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³€ê²½ì‚¬í•­

### Python/SQLAlchemy ëª¨ë¸ ë³€ê²½

```python
# ë³€ê²½ ì „
from sqlalchemy import Column, String, Integer

class Role(Base):
    __tablename__ = 'roles'
    role_code = Column(String(100), primary_key=True)
    role_name = Column(String(100))
    role_type = Column(String(50))

# ë³€ê²½ í›„
class Role(Base):
    __tablename__ = 'roles'
    code = Column(String(100), primary_key=True)
    name = Column(String(100))
    type = Column(String(50))
    deleted = Column(Boolean, default=False)  # ìƒˆë¡œ ì¶”ê°€
```

### SQL ì¿¼ë¦¬ ë³€ê²½

```sql
-- ë³€ê²½ ì „
SELECT role_code, role_name FROM idam.roles WHERE role_type = 'ADMIN';

-- ë³€ê²½ í›„
SELECT code, name FROM idam.roles WHERE type = 'ADMIN' AND deleted = false;
```

### ORM ì¿¼ë¦¬ ë³€ê²½

```python
# ë³€ê²½ ì „
roles = session.query(Role).filter(Role.role_type == 'ADMIN').all()

# ë³€ê²½ í›„
roles = session.query(Role).filter(
    Role.type == 'ADMIN',
    Role.deleted == False
).all()
```

---

## ğŸ“ˆ ì„±ëŠ¥ ì˜í–¥

### ê°œì„  íš¨ê³¼

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ | íš¨ê³¼ |
|------|---------|---------|------|
| ê¶Œí•œ ì¡°íšŒ | TABLE SCAN | ì¸ë±ìŠ¤ | 5-10ë°° |
| ì‚¬ìš©ì ì¡°íšŒ | ì—†ìŒ | ë¶€ë¶„ ì¸ë±ìŠ¤ | 3-5ë°° |
| ì¬ê³  ì¡°íšŒ (ë³€í˜•) | ë¶ˆê°€ëŠ¥ | ì¸ë±ìŠ¤ ì§€ì› | âœ… êµ¬í˜„ |
| ê°ì‹œ í•„ë“œ | ì¼ë¶€ ëˆ„ë½ | ì™„ë²½ | âœ… ì¶”ì  ê°€ëŠ¥ |

### ë‹¤ìš´íƒ€ì„ ì˜ˆìƒ

```
Phase 1: ~30ë¶„ (Manager DB)
  â”œâ”€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰: 5ë¶„
  â”œâ”€ ì¸ë±ìŠ¤ ì¬ìƒì„±: 10ë¶„
  â”œâ”€ ê²€ì¦: 10ë¶„
  â””â”€ ì™„ë£Œ: 5ë¶„

Phase 2: ~90ë¶„ (Tenant DB, í…Œë„ŒíŠ¸ë³„ 1-2ë¶„)
  â”œâ”€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰: 20ë¶„
  â”œâ”€ ì¸ë±ìŠ¤ ì¬ìƒì„±: 30ë¶„
  â”œâ”€ ê²€ì¦ ë° ëª¨ë‹ˆí„°ë§: 30ë¶„
  â””â”€ ì™„ë£Œ: 10ë¶„
```

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì „

- [ ] ë°ì´í„° ë°±ì—… (ì „ì²´)
- [ ] ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³€ê²½ ì™„ë£Œ
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ì¸ë±ìŠ¤ íš¨ìœ¨ì„±)

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘

- [ ] íŠ¸ëœì­ì…˜ ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§
- [ ] ì—ëŸ¬ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ í™•ì¸

### ë§ˆì´ê·¸ë ˆì´ì…˜ í›„

- [ ] ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- [ ] ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

---

## ğŸ“ ì»¬ëŸ¼ëª… ì •ê·œí™” í‘œì¤€

### Manager DB ê·œì¹™

```sql
-- í…Œì´ë¸”ëª…ì´ ì´ë¯¸ ì»¨í…ìŠ¤íŠ¸ ì œê³µ
roles.code           (O) -- role_code (X)
permissions.code     (O) -- permission_code (X)

-- ê´€ê³„ ì°¸ì¡°
FOREIGN KEY (role_id) REFERENCES roles(id)

-- ì‹œê°„ ì¶”ì 
created_at, updated_at, deleted
```

### Tenant DB ê·œì¹™ (ì´ë¯¸ ì¤€ìˆ˜)

```sql
sys.roles.code              âœ…
sys.permissions.code        âœ…
sys.permissions.module_code âœ…
```

---

## ğŸ”„ ë¡¤ë°± ê³„íš

### ê¸´ê¸‰ ë¡¤ë°± (í•„ìš” ì‹œ)

```bash
# 1. ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
psql -U postgres -d conexgrow_manager \
    -f 999_rollback_ddl_improvements_20251027.sql

# 2. ë°ì´í„° ì¼ê´€ì„± ê²€ì¦
SELECT COUNT(*) FROM idam.roles WHERE role_code IS NOT NULL;

# 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ë°°í¬ (ì´ì „ ë²„ì „)
```

### ì£¼ì˜ì‚¬í•­
- ë¡¤ë°± í›„ ë°ì´í„°ëŠ” ë³´ì¡´ë¨
- ìŠ¤í‚¤ë§ˆë§Œ ì›ë˜ ìƒíƒœë¡œ ë³µì›
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì¶”ê°€ëœ ë°ì´í„°ëŠ” ìœ ì§€ë¨

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

### ìƒì„±ëœ ë¬¸ì„œ

1. **DDL_improvements_20251027.md** (ìƒì„¸ ê°€ì´ë“œ)
   - 45ê°œ í…Œì´ë¸” ìƒì„¸ ë³€ê²½ì‚¬í•­
   - ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ì½”ë“œ
   - ì»¬ëŸ¼ëª… ì •ê·œí™” ê°€ì´ë“œ
   - ë°ì´í„° íƒ€ì… í‘œì¤€í™”

2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸** (ì‹¤í–‰ ê°€ëŠ¥)
   - Phase 1: Manager DB
   - Phase 2: Tenant DB
   - Rollback: ì–‘ìª½ ëª¨ë‘

### ê´€ë ¨ ë¬¸ì„œ

- `database_schema_comprehensive_analysis_20251027.md` (ì¢…í•© ë¶„ì„)
- `CLAUDE.md` (í”„ë¡œì íŠ¸ ì§€ì¹¨)

---

## ğŸ“ í•™ìŠµ í¬ì¸íŠ¸

### ì„¤ê³„ ì›ì¹™

1. **ì»¬ëŸ¼ëª… ì •ê·œí™”**: í…Œì´ë¸”ëª…ì´ ì»¨í…ìŠ¤íŠ¸ ì œê³µ â†’ ì»¬ëŸ¼ëª… ë°˜ë³µ ì œê±°
2. **ê°ì‹œ í•„ë“œ í‘œì¤€í™”**: ëª¨ë“  í…Œì´ë¸”ì— ì¼ê´€ëœ ê°ì‹œ í•„ë“œ
3. **ì¸ë±ìŠ¤ ìµœì í™”**: ë¶€ë¶„ ì¸ë±ìŠ¤ë¡œ ì„±ëŠ¥ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
4. **ì œì•½ ì¡°ê±´**: ë°ì´í„° ë¬´ê²°ì„±ì„ DB ë ˆë²¨ì—ì„œ ë³´ì¥

### ì‹¤í–‰ ì „ëµ

1. **ë‹¨ê³„ë³„ ì‹¤í–‰**: Phase 1 â†’ Phase 2 (ì˜ì¡´ë„ ê³ ë ¤)
2. **ì² ì €í•œ í…ŒìŠ¤íŠ¸**: ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œ ì™„ì „ ê²€ì¦
3. **ë¡¤ë°± ê³„íš**: ë¬¸ì œ ë°œìƒ ì‹œ ë¹ ë¥¸ ëŒ€ì‘ ê°€ëŠ¥
4. **ì†Œí†µ**: íŒ€ ì „ì²´ì— ë³€ê²½ì‚¬í•­ ê³µìœ 

---

## ğŸ† ìµœì¢… í‰ê°€

### ë‹¬ì„±í•œ ê²ƒ

âœ… Manager DB ì»¬ëŸ¼ëª… ì •ê·œí™” ì™„ë£Œ
âœ… Tenant DB ê°ì‹œ í•„ë“œ í‘œì¤€í™” ê³„íš
âœ… P0 ìš°ì„ ìˆœìœ„ ê¸°ëŠ¥ (variant_id) ì¶”ê°€ ì„¤ê³„
âœ… ì‹¤í–‰ ê°€ëŠ¥í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
âœ… ë¡¤ë°± ê³„íš ìˆ˜ë¦½

### ê°œì„  íš¨ê³¼

ğŸ“Š **ì„±ëŠ¥**: ì¸ë±ìŠ¤ ìµœì í™”ë¡œ ì¡°íšŒ 5-10ë°° í–¥ìƒ
ğŸ”’ **ë³´ì•ˆ**: ê°ì‹œ í•„ë“œ ê°•í™”ë¡œ ì¶”ì  ê°€ëŠ¥ì„± í–¥ìƒ
ğŸ“ **ìœ ì§€ë³´ìˆ˜**: ì¼ê´€ëœ ì»¬ëŸ¼ëª… ê·œì¹™ìœ¼ë¡œ ì½”ë“œ ì½ê¸° ì‰¬ì›€
ğŸ›¡ï¸ **ë¬´ê²°ì„±**: ì œì•½ ì¡°ê±´ ê°•í™”ë¡œ ë°ì´í„° í’ˆì§ˆ í–¥ìƒ

---

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

**ë¬¸ì œ ë°œìƒ ì‹œ**:
1. ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¦‰ì‹œ ë˜ëŒë¦¬ê¸°
2. ë¡œê·¸ ë¶„ì„ ë° ì›ì¸ íŒŒì•…
3. ìŠ¤í…Œì´ì§•ì—ì„œ ì¬ê²€ì¦ í›„ ì¬ì‹¤í–‰

**ë³€ê²½ì‚¬í•­ ì¶”ì **:
- Git ì»¤ë°‹: `DDL improvements - Phase 1, 2 (2025-10-27)`
- ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬: `/scripts/migrations/`

---

**ì‘ì„± ì™„ë£Œ**: 2025-10-27 17:00 UTC+9
**ë²„ì „**: 1.0
**ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

