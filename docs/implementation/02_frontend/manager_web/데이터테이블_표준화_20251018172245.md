# 데이터테이블 표준화 구현

**날짜**: 2025-10-18 17:22:45 KST
**작성자**: Claude Code
**유형**: 개선
**컴포넌트**: manager-web, tenants-web 모든 데이터테이블

## 개요
ConexGrow의 모든 데이터테이블을 통일된 구조로 표준화했습니다. 사용자관리 데이터테이블을 참조 구현으로 하여 다음의 표준을 적용했습니다:
1. 첫 번째 컬럼에 NO (행 번호) 추가
2. 작업 컬럼에 표준화된 아이콘 메뉴 적용
3. 일관된 스타일링 및 사용자 경험

## 식별된 문제점

기존 데이터테이블들은 다음과 같은 일관성 문제가 있었습니다:
- **manager-web**: 7개 테이블 중 6개가 NO 컬럼 누락
- **작업 컬럼 스타일**: 일부는 MoreHorizontal 아이콘만 사용, 일부는 작업 버튼이 없음
- **행 번호 계산**: 페이지네이션을 고려한 행 번호가 누락
- **사용자 경험**: 테이블마다 다른 UI/UX로 인해 사용자 혼란

## 변경 내용

### 1. NO (행 번호) 컬럼 구현

모든 테이블의 첫 번째 컬럼에 표준 NO 컬럼을 추가했습니다.

```typescript
{
  id: "rowNumber",
  header: () => (
    <div className="text-center text-xs font-medium text-muted-foreground uppercase tracking-wider">
      NO
    </div>
  ),
  cell: ({ row, table }) => {
    const pageIndex = table.getState().pagination.pageIndex;
    const pageSize = table.getState().pagination.pageSize;
    const rowIndex = row.index;
    return (
      <div className="text-center text-sm font-medium text-foreground w-12">
        {pageIndex * pageSize + rowIndex + 1}
      </div>
    );
  },
  enableSorting: false,
  enableHiding: false,
}
```

**특징**:
- 페이지네이션을 고려한 동적 계산 (다중 페이지에서도 연속된 번호)
- 중앙 정렬된 텍스트
- 고정 너비 (w-12)
- 정렬 및 숨김 비활성화

### 2. 작업 컬럼 표준화

작업이 있는 테이블에 통일된 아이콘 기반 메뉴를 적용했습니다.

#### 2.1 편집 기능이 있는 테이블

**적용 대상**: Role, Permission, Tenant Management

```typescript
{
  id: "actions",
  header: () => <div className="text-right">작업</div>,
  cell: ({ row }) => {
    const item = row.original;

    return (
      <TooltipProvider>
        <div className="flex items-center justify-end gap-1">
          {/* Edit Button */}
          <Tooltip>
            <TooltipTrigger asChild>
              <Button
                variant="ghost"
                size="icon"
                className="h-8 w-8 text-muted-foreground hover:text-foreground"
                onClick={() => onEdit?.(item)}
              >
                <Edit2 className="h-4 w-4" />
              </Button>
            </TooltipTrigger>
            <TooltipContent>
              <p>수정</p>
            </TooltipContent>
          </Tooltip>

          {/* More Actions Menu */}
          <DropdownMenu>
            <Tooltip>
              <TooltipTrigger asChild>
                <DropdownMenuTrigger asChild>
                  <Button
                    variant="ghost"
                    size="icon"
                    className="h-8 w-8 text-muted-foreground hover:text-foreground"
                  >
                    <MoreVertical className="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
              </TooltipTrigger>
              <TooltipContent>
                <p>더보기</p>
              </TooltipContent>
            </Tooltip>
            <DropdownMenuContent align="end">
              <DropdownMenuItem onClick={() => onViewDetails?.(item)}>
                <Eye className="mr-2 h-4 w-4" />
                <span>상세 보기</span>
              </DropdownMenuItem>
              <DropdownMenuItem
                className="text-destructive"
                onClick={() => onDelete?.(item)}
              >
                <Trash2 className="mr-2 h-4 w-4" />
                <span>삭제</span>
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </TooltipProvider>
    );
  },
  enableHiding: false,
}
```

**구조**:
- **Edit2 아이콘 버튼**: 빠른 수정 접근
- **MoreVertical 아이콘**: 추가 작업 (상세 보기, 삭제)
- **Tooltip**: 모든 버튼에 툴팁 제공
- **우측 정렬**: 테이블 우측에 배치

#### 2.2 조회 전용 테이블

**적용 대상**: Invoice

```typescript
{
  id: "actions",
  header: () => <div className="text-right">작업</div>,
  cell: ({ row }) => {
    const invoice = row.original;

    return (
      <TooltipProvider>
        <div className="flex items-center justify-end gap-1">
          <DropdownMenu>
            <Tooltip>
              <TooltipTrigger asChild>
                <DropdownMenuTrigger asChild>
                  <Button
                    variant="ghost"
                    size="icon"
                    className="h-8 w-8 text-muted-foreground hover:text-foreground"
                  >
                    <MoreVertical className="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
              </TooltipTrigger>
              <TooltipContent>
                <p>더보기</p>
              </TooltipContent>
            </Tooltip>
            <DropdownMenuContent align="end">
              <DropdownMenuItem onClick={() => onViewDetails?.(invoice)}>
                <Eye className="mr-2 h-4 w-4" />
                <span>상세 보기</span>
              </DropdownMenuItem>
              <DropdownMenuItem onClick={() => onDownload?.(invoice)}>
                <Download className="mr-2 h-4 w-4" />
                <span>PDF 다운로드</span>
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </TooltipProvider>
    );
  },
  enableHiding: false,
}
```

**특징**:
- 편집 버튼 없음 (조회 전용)
- MoreVertical 메뉴만 제공
- 도메인별 특화 작업 (예: PDF 다운로드)

### 3. Import 정리

표준화된 컴포넌트만 import하도록 정리:

```typescript
// Before
import { MoreHorizontal, Eye, Edit, Trash2 } from "lucide-react";
import {
  DropdownMenuLabel,
  DropdownMenuSeparator,
  // ...
} from "@/components/ui/dropdown-menu";

// After
import { Eye, Trash2, Edit2, MoreVertical } from "lucide-react";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";
```

**변경 사항**:
- `MoreHorizontal` → `MoreVertical`
- `Edit` → `Edit2` (더 직관적인 아이콘)
- 사용하지 않는 컴포넌트 제거 (DropdownMenuLabel, DropdownMenuSeparator)
- Tooltip 컴포넌트 추가

## 변경된 파일 목록

### Manager-Web (7개 파일)

1. `/apps/manager-web/src/features/idam/role/components/role-columns.tsx`
   - NO 컬럼 추가
   - Edit2 + MoreVertical 메뉴 구조 적용
   - 불필요한 import 제거

2. `/apps/manager-web/src/features/idam/permission/components/permission-columns.tsx`
   - NO 컬럼 추가
   - Edit2 + MoreVertical 메뉴 구조 적용
   - Tooltip 추가

3. `/apps/manager-web/src/features/idam/access-log/components/access-log-columns.tsx`
   - NO 컬럼 추가
   - 작업 컬럼 없음 (읽기 전용 로그 테이블)

4. `/apps/manager-web/src/features/bill/invoice/components/invoice-columns.tsx`
   - NO 컬럼 추가
   - MoreVertical 메뉴 (상세 보기, PDF 다운로드)
   - Tooltip 추가

5. `/apps/manager-web/src/features/bill/payment/components/payment-columns.tsx`
   - NO 컬럼 추가
   - 작업 컬럼 없음 (읽기 전용 트랜잭션 테이블)

6. `/apps/manager-web/src/features/tnnt/tenant/components/tenant-columns.tsx`
   - NO 컬럼 추가
   - Edit2 + MoreVertical 메뉴 구조 적용
   - Tooltip 추가

7. `/apps/manager-web/src/features/tnnt/subscription/components/subscription-columns.tsx`
   - NO 컬럼 추가
   - 작업 컬럼 없음 (읽기 전용 구독 정보 테이블)

### Tenants-Web

**참고**: tenants-web의 모든 데이터테이블은 이미 표준화되어 있었습니다.
- DataTable 컴포넌트가 자동으로 NO 컬럼을 생성
- 모든 테이블에서 일관된 인라인 작업 버튼 사용

## 테스트

### 수동 테스트 시나리오

각 테이블에서 다음 항목을 확인:

1. **NO 컬럼**
   - [ ] 첫 번째 페이지에서 1부터 시작
   - [ ] 두 번째 페이지에서 (pageSize + 1)부터 시작
   - [ ] 중앙 정렬 확인
   - [ ] 정렬 버튼이 없음 (비활성화)

2. **작업 컬럼** (해당되는 경우)
   - [ ] Edit2 아이콘 버튼 클릭 → 수정 동작 실행
   - [ ] MoreVertical 아이콘 클릭 → 드롭다운 메뉴 표시
   - [ ] 각 메뉴 항목 클릭 → 해당 동작 실행
   - [ ] Tooltip 호버 → "수정", "더보기" 텍스트 표시

3. **일관성 확인**
   - [ ] 모든 테이블의 NO 컬럼 스타일 동일
   - [ ] 작업 컬럼 레이아웃 동일 (우측 정렬)
   - [ ] 아이콘 크기 및 간격 일관성

### 테이블별 테스트 체크리스트

#### Manager-Web

| 테이블 | NO 컬럼 | 작업 컬럼 | 비고 |
|--------|---------|-----------|------|
| User Management | ✅ (기존) | ✅ Edit2 + MoreVertical | 참조 구현 |
| Role Management | ✅ 신규 | ✅ Edit2 + MoreVertical | 상세/삭제 메뉴 |
| Permission Management | ✅ 신규 | ✅ Edit2 + MoreVertical | 상세/삭제 메뉴 |
| Access Log | ✅ 신규 | N/A | 읽기 전용 |
| Invoice | ✅ 신규 | ✅ MoreVertical만 | 상세/다운로드 |
| Payment | ✅ 신규 | N/A | 읽기 전용 |
| Tenant Management | ✅ 신규 | ✅ Edit2 + MoreVertical | 상세/삭제 메뉴 |
| Subscription | ✅ 신규 | N/A | 읽기 전용 |

#### Tenants-Web

| 테이블 | NO 컬럼 | 작업 컬럼 | 비고 |
|--------|---------|-----------|------|
| Departments | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |
| Employees | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |
| Products | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |
| Partners | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |
| Companies | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |
| Warehouses | ✅ (기존) | ✅ 인라인 버튼 | 자동 생성 |

## 향후 개선사항

### 1. 공통 컴포넌트화
현재 각 테이블마다 NO 컬럼 코드를 반복하고 있습니다. 향후 다음과 같이 개선 가능:

```typescript
// 제안: apps/manager-web/src/components/ui/data-table-columns.tsx
export const createRowNumberColumn = <TData,>(): ColumnDef<TData> => ({
  id: "rowNumber",
  header: () => (
    <div className="text-center text-xs font-medium text-muted-foreground uppercase tracking-wider">
      NO
    </div>
  ),
  cell: ({ row, table }) => {
    const pageIndex = table.getState().pagination.pageIndex;
    const pageSize = table.getState().pagination.pageSize;
    const rowIndex = row.index;
    return (
      <div className="text-center text-sm font-medium text-foreground w-12">
        {pageIndex * pageSize + rowIndex + 1}
      </div>
    );
  },
  enableSorting: false,
  enableHiding: false,
});

// 사용 예시
export const getRoleColumns = (...) => [
  createRowNumberColumn<Role>(),
  // 나머지 컬럼들...
];
```

### 2. 작업 컬럼 팩토리 패턴
작업 컬럼도 재사용 가능한 팩토리 함수로 만들 수 있습니다:

```typescript
export const createActionsColumn = <TData,>(config: {
  onEdit?: (item: TData) => void;
  onDelete?: (item: TData) => void;
  onViewDetails?: (item: TData) => void;
  additionalActions?: Array<{
    label: string;
    icon: LucideIcon;
    onClick: (item: TData) => void;
  }>;
}): ColumnDef<TData> => {
  // 표준화된 작업 컬럼 반환
};
```

### 3. TypeScript 타입 개선
더 엄격한 타입 체크를 위해:

```typescript
interface DataTableConfig<TData> {
  includeRowNumber?: boolean;
  actions?: ActionsConfig<TData>;
  // ...
}
```

### 4. Tenants-Web 스타일 통일
manager-web과 tenants-web의 작업 컬럼 스타일을 완전히 통일할지 검토:
- manager-web: Tooltip + MoreVertical 드롭다운
- tenants-web: 인라인 버튼

사용자 경험 관점에서 어느 것이 더 나은지 A/B 테스트 고려

### 5. 접근성 개선
- 키보드 내비게이션 지원 강화
- 스크린 리더를 위한 aria-label 추가
- 고대비 모드 지원

## 참고사항

### 디자인 토큰
표준화에 사용된 주요 스타일:

```typescript
// NO 컬럼
- Header: text-xs, uppercase, tracking-wider, text-muted-foreground
- Cell: text-sm, font-medium, text-foreground, w-12, text-center

// 작업 버튼
- Size: h-8 w-8
- Icon: h-4 w-4
- Color: text-muted-foreground hover:text-foreground
- Variant: ghost
```

### 아이콘 선택 이유
- **Edit2**: Edit보다 더 직관적이고 현대적인 디자인
- **MoreVertical**: 수직 3점 메뉴는 "더 많은 옵션"의 표준 UI 패턴
- **Eye**: 상세 보기의 보편적 아이콘
- **Trash2**: 삭제 동작의 명확한 시각적 표현

### 브라우저 호환성
- 모든 모던 브라우저 지원 (Chrome, Firefox, Safari, Edge)
- Tooltip은 Radix UI 기반으로 접근성 보장
- DropdownMenu도 Radix UI 기반으로 키보드 탐색 지원

### 성능 고려사항
- NO 컬럼 계산은 메모이제이션 없이도 충분히 빠름
- Tooltip과 DropdownMenu는 필요시에만 렌더링됨
- 각 테이블은 독립적으로 페이지네이션 상태 관리
