# 테마 및 팔레트 설정 기능 구현 완료

**날짜**: 2025-10-19 16:34:35 KST
**작성자**: Claude Code
**유형**: 기능 구현
**컴포넌트**: 시스템 설정, 테마 관리, UI 컴포넌트

## 개요

시스템 설정에서 21개의 색상 팔레트를 선택하여 전체 사이트의 디자인 색상을 실시간으로 변경할 수 있는 테마 설정 기능을 구현했습니다. OKLCH 색상 공간을 사용하여 정확한 색상 표현을 보장하며, Zustand를 통한 상태 관리와 localStorage 기반 영속성을 제공합니다.

## 주요 기능

### 1. 21개 색상 팔레트
- **Neutral 계열**: slate, gray, zinc, neutral, stone
- **Warm 계열**: red, orange, amber, yellow, lime
- **Cool 계열**: green, emerald, teal, cyan, sky, blue
- **Vibrant 계열**: indigo, violet, purple, fuchsia, pink, rose

### 2. 실시간 테마 변경
- CSS 변수를 동적으로 업데이트하여 페이지 새로고침 없이 테마 적용
- requestAnimationFrame을 사용한 성능 최적화
- Dark/Light 모드 지원 (각 모드별 자동 색상 조정)

### 3. 사용자 경험
- 임시 선택 상태로 미리보기 가능
- 변경사항 알림 및 적용/취소 기능
- 실시간 프리뷰 패널 (통계 카드, 버튼, 배지, 입력 필드, 카드, 텍스트 색상)
- localStorage를 통한 사용자 설정 저장

## 구현된 파일 목록

### 1. 색상 상수 및 타입 정의
**`/apps/manager-web/src/lib/constants/colors.ts`**
- 21개 팔레트의 OKLCH 색상 값 정의 (각 팔레트당 11개 shade: 50-950)
- TypeScript 타입: `ColorPalette`, `ColorShades`, `PaletteInfo`
- 팔레트 메타데이터: 라벨, 설명, 카테고리
- 카테고리별 그룹핑 함수: `getGroupedPalettes()`

```typescript
export const COLOR_PALETTES: Record<ColorPalette, ColorShades> = {
  violet: {
    50: "oklch(97% 0.02 294)",
    // ... 11 shades
    950: "oklch(28% 0.14 291)",
  },
  // ... 20 more palettes
};
```

### 2. CSS 변수 관리
**`/apps/manager-web/src/lib/theme/css-vars.ts`**
- 동적 CSS 변수 업데이트 함수: `updatePrimaryColors()`
- Dark 모드 토글 함수: `toggleDarkMode()`
- Dark 모드 감지 함수: `isDarkMode()`
- requestAnimationFrame을 사용한 배치 업데이트

```typescript
export function updatePrimaryColors(palette: ColorPalette, mode: 'light' | 'dark' = 'light') {
  const root = document.documentElement;
  const colors = COLOR_PALETTES[palette];

  requestAnimationFrame(() => {
    // 모든 shade 업데이트
    Object.entries(colors).forEach(([shade, value]) => {
      root.style.setProperty(`--${palette}-${shade}`, value);
    });

    // primary 색상 설정 (light: 600, dark: 500)
    const primaryShade = mode === 'light' ? '600' : '500';
    root.style.setProperty('--primary', colors[primaryShade]);
  });
}
```

### 3. 상태 관리 (Zustand)
**`/apps/manager-web/src/stores/theme.store.ts`**
- Zustand store with persist middleware
- localStorage 키: 'theme-storage'
- 상태: palette, mode
- 액션: setPalette, setMode, toggleMode, resetTheme

```typescript
export const useThemeStore = create<ThemeState>()(
  persist(
    (set, get) => ({
      palette: 'violet',
      mode: 'light',
      setPalette: (palette) => {
        const { mode } = get();
        updatePrimaryColors(palette, mode);
        set({ palette });
      },
      // ...
    }),
    { name: 'theme-storage' }
  )
);
```

### 4. 커스텀 훅
**`/apps/manager-web/src/hooks/use-theme.ts`**
- useThemeStore를 감싸는 편의 훅
- useEffect로 초기 CSS 변수 적용
- isDark 헬퍼 속성 제공

### 5. UI 컴포넌트

#### ColorPalettePicker
**`/apps/manager-web/src/components/theme/color-palette-picker.tsx`**
- 21개 팔레트를 카테고리별로 그룹핑하여 표시
- 각 팔레트당 5개 색상의 그라데이션 프리뷰
- 선택된 팔레트에 체크 마크 표시
- 반응형 그리드 레이아웃 (모바일: 2열, 태블릿: 3열, 데스크톱: 5-6열)
- memo로 성능 최적화

#### ThemePreview
**`/apps/manager-web/src/components/theme/theme-preview.tsx`**
- 실시간 테마 적용 미리보기
- 표시 항목: 통계 카드, 버튼(5종), 배지(4종), 입력 필드, 카드, 텍스트 색상
- 선택한 팔레트가 실제 UI에 어떻게 적용되는지 시각화

#### ThemeSettings
**`/apps/manager-web/src/components/theme/theme-settings.tsx`**
- 메인 테마 설정 컴포넌트
- 임시 상태 관리 (tempPalette vs palette)
- 헤더에 Dark/Light 모드 토글 버튼
- 변경사항 알림 배너
- 적용/취소/초기화 버튼
- 반응형 레이아웃 (데스크톱: 2/3 선택 + 1/3 미리보기)
- 하단에 현재 테마 정보 표시 (팔레트, 모드, 색상 시스템)

### 6. 시스템 설정 페이지
**`/apps/manager-web/src/app/(main)/cnfg/system/page.tsx`**
- 탭 구조: 일반, 테마, 알림, 보안
- 테마 탭에 ThemeSettings 컴포넌트 통합
- 나머지 탭은 향후 확장을 위한 플레이스홀더

### 7. Tabs UI 컴포넌트
**`/apps/manager-web/src/components/ui/tabs.tsx`**
- Radix UI 기반 Tabs 컴포넌트
- shadcn/ui 스타일링 적용
- 접근성 준수 (ARIA 속성, 키보드 내비게이션)

## 기술 스택

- **색상 시스템**: OKLCH (Lightness, Chroma, Hue)
- **상태 관리**: Zustand with persist middleware
- **스타일링**: Tailwind CSS v4, CSS Variables
- **UI 컴포넌트**: Radix UI (Tabs)
- **성능 최적화**: React.memo, requestAnimationFrame
- **영속성**: localStorage

## 사용 방법

### 사용자 관점

1. 시스템 설정 메뉴 접근: `/cnfg/system`
2. "테마" 탭 선택
3. 원하는 색상 팔레트 클릭
4. 오른쪽 미리보기 패널에서 변경 사항 확인
5. "적용" 버튼 클릭하여 저장
6. 헤더의 달/해 아이콘으로 Dark/Light 모드 전환

### 개발자 관점

```typescript
// 컴포넌트에서 테마 사용
import { useTheme } from '@/hooks/use-theme';

function MyComponent() {
  const { palette, mode, setPalette, toggleMode, isDark } = useTheme();

  return (
    <div>
      <p>현재 팔레트: {palette}</p>
      <p>다크 모드: {isDark ? '예' : '아니오'}</p>
      <button onClick={toggleMode}>모드 전환</button>
      <button onClick={() => setPalette('blue')}>파란색으로 변경</button>
    </div>
  );
}
```

## 테스트 시나리오

### 기본 기능 테스트
- [x] 21개 팔레트 모두 정상 표시
- [x] 팔레트 선택 시 미리보기 즉시 업데이트
- [x] "적용" 버튼 클릭 시 테마 저장
- [x] "취소" 버튼 클릭 시 이전 상태로 복원
- [x] "초기화" 버튼 클릭 시 violet 팔레트로 리셋
- [x] Dark/Light 모드 토글 정상 작동
- [x] 페이지 새로고침 후 설정 유지 (localStorage)

### 반응형 테스트
- [x] 모바일: 2열 그리드
- [x] 태블릿: 3열 그리드
- [x] 데스크톱: 5-6열 그리드
- [x] 미리보기 패널 sticky 동작

### 성능 테스트
- [x] 팔레트 변경 시 버벅임 없음 (requestAnimationFrame)
- [x] PaletteCard memo로 불필요한 리렌더링 방지

## 향후 개선사항

### Phase 5: 고급 기능 (제안서 참조)
1. **커스텀 색상 생성기**
   - 사용자가 직접 OKLCH 값 입력
   - 색상 피커 UI
   - 커스텀 팔레트 저장

2. **테마 프리셋**
   - 미리 정의된 테마 조합 (기업용, 창의적, 미니멀 등)
   - 한 번의 클릭으로 전체 테마 변경

3. **접근성 체크**
   - 색상 대비 검사 (WCAG 2.1 AA/AAA)
   - 색맹 모드 시뮬레이션
   - 경고 표시 및 개선 제안

4. **테마 공유**
   - 테마 설정을 JSON으로 내보내기/가져오기
   - URL 파라미터로 테마 공유

5. **다크 모드 자동 전환**
   - 시스템 설정 감지
   - 시간대별 자동 전환 (일출/일몰)

## 관련 문서

- [테마 팔레트 설정 기능 제안서](/docs/implementation/manager-web/테마_팔레트_설정_기능_20251019143000.md)
- [colorchip.html 원본 파일](/docs/sample/colorchip.html)

## 참고사항

### OKLCH 색상 공간
OKLCH는 인간의 시각적 인식에 기반한 현대적인 색상 공간입니다:
- **L (Lightness)**: 명도 (0-100%)
- **C (Chroma)**: 채도 (0-0.4 정도)
- **H (Hue)**: 색조 (0-360도)

기존 RGB/HSL 대비 장점:
- 인지적으로 균일한 색상 변화
- 더 정확한 색상 보간
- 넓은 색상 범위 (Display P3, Rec.2020 지원)

### 브라우저 지원
- Chrome 111+
- Edge 111+
- Safari 15.4+
- Firefox 113+

구형 브라우저는 자동으로 fallback RGB 값 사용 (Tailwind CSS 처리)

## 변경 이력

- 2025-10-19 16:34:35 KST: 초기 구현 완료
  - 21개 색상 팔레트 구현
  - 실시간 테마 변경 기능
  - 시스템 설정 페이지 통합
  - Dark/Light 모드 지원
  - localStorage 영속성
