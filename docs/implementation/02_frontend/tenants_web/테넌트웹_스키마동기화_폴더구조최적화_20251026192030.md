# Tenants-Web 스키마 동기화 및 폴더 구조 최적화

**날짜**: 2025-10-26 19:20:30 KST
**작성자**: Claude Code
**유형**: 아키텍처 개선 | 폴더 구조 리팩토링
**컴포넌트**: tenants-web / App Router / Database Schema Alignment

## 개요

`packages/database/schemas/tenants` 의 데이터베이스 스키마 구조와 `apps/tenants-web/src/app/(main)` 의 프론트엔드 폴더 구조를 완벽하게 동기화했습니다.

이를 통해:
- 백엔드 DB 스키마와 프론트엔드 폴더 구조의 1:1 매칭
- 개발자가 쉽게 데이터 모델을 이해하고 페이지를 작성 가능
- API 엔드포인트와 UI의 자동 매핑
- 일관성 있는 프로젝트 구조 유지

## 문제점

이전 구조의 문제:
1. **명칭 불일치**: 프론트엔드 폴더명이 데이터베이스 스키마명과 다름
   - 예: `csm` vs `03_crm`, `asm` vs `13_fsm`, `bim` vs `20_bim`

2. **누락된 스키마**: 데이터베이스에는 있지만 프론트엔드에 없는 스키마
   - `02_hrm` (Human Resource Management)
   - `04_pim` (Product Information Management)
   - `05_wms` (Warehouse Management System)
   - `06_apm` (Approval Management)
   - `15_fam` (Fixed Asset Management)

3. **엔티티 불일치**: 테이블명과 프론트엔드 폴더명이 다름
   - 예: `inventory` vs `inventory-balances`, `inventory-movements` 등

4. **혼재된 책임**: 시스템 설정, 공통 코드, 사용자 관리가 여러 스키마에 분산

## 변경 내용

### 1. 스키마 번호 체계

데이터베이스 스키마 구조를 그대로 프론트엔드에 반영:

```
프론트엔드 폴더          데이터베이스 스키마       설명
─────────────────      ────────────────       ────
01_adm                 01_adm                 공통 코드, 설정 (기본 관리 데이터)
02_hrm                 02_hrm                 인사/급여 관리
03_crm                 03_crm                 고객 관계 관리
04_pim                 04_pim                 제품 정보 관리
05_wms                 05_wms                 창고 관리
06_apm                 06_apm                 승인 관리
10_ivm                 10_ivm                 재고 관리
11_psm                 11_psm                 구매 관리
12_srm                 12_srm                 판매 관리
13_fsm                 13_asm                 사후 판매/서비스 관리
14_fim                 14_fim                 재무/회계 관리
15_fam                 15_fam                 고정자산 관리
16_lwm                 16_lwm                 워크플로우 관리
20_bim                 20_bim                 비즈니스 인텔리전스
22_sys                 22_sys + 21_com        시스템/사용자 관리 + 공통 설정
```

### 2. 스키마별 폴더 구조 및 엔티티

#### 01_adm - Administration (공통 관리 데이터)
```
01_adm/
├── page.tsx
├── code-groups/page.tsx          # 코드 그룹
├── codes/page.tsx                # 코드
├── settings/page.tsx             # 설정값
├── currencies/page.tsx           # 통화
├── exchange-rates/page.tsx       # 환율
├── units/page.tsx                # 단위
└── payment-terms/page.tsx        # 결제 조건
```

#### 02_hrm - Human Resource Management (신규 추가)
```
02_hrm/
├── page.tsx
├── departments/page.tsx
├── employees/page.tsx
├── department-histories/page.tsx
├── employee-histories/page.tsx
├── salary-structures/page.tsx
├── payroll-records/page.tsx
├── attendances/page.tsx
├── absences/page.tsx
└── leave-policies/page.tsx
```

#### 03_crm - Customer Relationship Management (csm → crm)
```
03_crm/                            # 기존 csm에서 이름 변경
├── page.tsx
├── partners/page.tsx              # 거래처 (customers)
├── partner-contacts/page.tsx      # 거래처 연락처
├── partner-addresses/page.tsx     # 거래처 주소
├── partner-managers/page.tsx      # 거래처 담당자
├── partner-banks/page.tsx         # 거래처 은행 정보
├── leads/page.tsx                 # 잠재 고객
├── opportunities/page.tsx         # 영업 기회
├── activities/page.tsx            # 활동
├── interactions/page.tsx          # 상호작용
├── campaigns/page.tsx             # 캠페인
├── campaign-members/page.tsx      # 캠페인 멤버
├── sales-targets/page.tsx         # 판매 목표
├── customer-segments/page.tsx     # 고객 세그먼트
├── customer-segment-members/page.tsx
├── customer-surveys/page.tsx      # 고객 설문
├── email-templates/page.tsx       # 이메일 템플릿
├── rfqs/page.tsx                  # 제안요청서
├── rfq-items/page.tsx
└── contracts/page.tsx             # 계약서
```

#### 04_pim - Product Information Management (신규 추가)
```
04_pim/
├── page.tsx
├── makers/page.tsx                # 제조사
├── brands/page.tsx                # 브랜드
├── categories/page.tsx            # 제품 카테고리
├── category-managers/page.tsx     # 카테고리 담당자
├── products/page.tsx              # 제품
├── product-managers/page.tsx      # 제품 담당자
├── product-images/page.tsx        # 제품 이미지
├── product-suppliers/page.tsx     # 제품별 공급사
├── product-price-history/page.tsx # 제품 가격 이력
├── product-options/page.tsx       # 제품 옵션 (예: 색상, 사이즈)
├── product-option-values/page.tsx # 옵션값
├── product-variants/page.tsx      # 제품 변형
├── product-units/page.tsx         # 제품 단위
├── product-unit-conversions/page.tsx # 단위 변환
├── product-relations/page.tsx     # 제품 관계 (번들, 세트)
└── product-tags/page.tsx          # 제품 태그
```

#### 05_wms - Warehouse Management System (신규 추가)
```
05_wms/
├── page.tsx
├── warehouses/page.tsx            # 창고
├── warehouse-employees/page.tsx   # 창고 직원
├── warehouse-locations/page.tsx   # 창고 위치/로케이션
├── receiving/page.tsx             # 수령
├── receiving-items/page.tsx       # 수령 품목
├── shipping/page.tsx              # 배송
├── shipping-items/page.tsx        # 배송 품목
└── inventory/page.tsx             # 재고 현황 (실시간)
```

#### 06_apm - Approval Management (신규 추가)
```
06_apm/
├── page.tsx
├── approval-lines/page.tsx        # 승인 라인 (승인 단계)
├── approval-line-items/page.tsx   # 승인 라인 항목
├── approval-requests/page.tsx     # 승인 요청
└── approval-histories/page.tsx    # 승인 히스토리
```

#### 10_ivm - Inventory Management
```
10_ivm/                            # 기존 구조 유지
├── page.tsx
├── inventory-balances/page.tsx    # 재고 잔액
├── inventory-movements/page.tsx   # 재고 이동
├── inventory-transfers/page.tsx   # 재고 이전/이관
├── inventory-adjustments/page.tsx # 재고 조정
├── inventory-reservations/page.tsx # 재고 예약
├── inventory-lots/page.tsx        # 재고 로트/배치
├── inventory-serial-numbers/page.tsx # 시리얼번호
├── inventory-counts/page.tsx      # 재고 실사
├── inventory-count-items/page.tsx # 실사 항목
└── inventory-cycle-counts/page.tsx # 정기 실사
```

#### 11_psm - Procurement/Purchase Management
```
11_psm/                            # 기존 구조 유지, 세부 항목 추가
├── page.tsx
├── purchase-requisitions/page.tsx       # 구매 요청서
├── purchase-requisition-items/page.tsx
├── purchase-orders/page.tsx             # 구매주문서
├── purchase-order-items/page.tsx
├── purchase-quotations/page.tsx         # 공급사 견적
├── purchase-quotation-items/page.tsx
├── purchase-price-agreements/page.tsx   # 공급사 단가 합의
├── purchase-order-pr-links/page.tsx     # PO-PR 연결
├── purchase-order-receipts/page.tsx     # 구매 수령
└── purchase-order-receipt-items/page.tsx
```

#### 12_srm - Sales/Revenue Management
```
12_srm/                            # 기존 구조 유지, 세부 항목 추가
├── page.tsx
├── quotations/page.tsx            # 판매 견적
├── quotation-items/page.tsx
├── sales-orders/page.tsx          # 판매주문서
├── sales-order-items/page.tsx
├── sales-deliveries/page.tsx      # 판매 배송
├── sales-delivery-items/page.tsx
├── sales-invoices/page.tsx        # 판매 송장
├── sales-invoice-items/page.tsx
├── sales-returns/page.tsx         # 판매 반품
├── sales-return-items/page.tsx
├── promotions/page.tsx            # 프로모션/할인
└── promotion-usage/page.tsx       # 프로모션 사용 기록
```

#### 13_fsm - After Sales/Service Management (asm → fsm 변경)
```
13_fsm/                            # asm → 13_fsm으로 변경
├── page.tsx
├── service-requests/page.tsx      # 서비스 요청
├── service-works/page.tsx         # 서비스 작업
├── service-parts/page.tsx         # 서비스 부품
├── support-tickets/page.tsx       # 지원 티켓
├── ticket-comments/page.tsx       # 티켓 댓글
├── faqs/page.tsx                  # FAQ
├── customer-feedback/page.tsx     # 고객 피드백
└── nps-surveys/page.tsx           # NPS 설문
```

#### 14_fim - Finance/Accounting Management
```
14_fim/                            # 기존 구조 유지
├── page.tsx
├── accounts/page.tsx              # 계정 (COA)
├── journal-entries/page.tsx       # 분개
├── journal-entry-lines/page.tsx   # 분개 라인
├── accounts-receivable/page.tsx   # 미수금
├── accounts-payable/page.tsx      # 미지급금
├── payment-transactions/page.tsx  # 결제 거래
├── business-documents/page.tsx    # 사업 문서
├── tax-invoices/page.tsx          # 세금 송장
└── tax-invoice-lines/page.tsx     # 송장 라인
```

#### 15_fam - Fixed Asset Management (신규 추가, asm 대체)
```
15_fam/                            # 기존 asm을 이것으로 교체
├── page.tsx
├── fixed-assets/page.tsx          # 고정자산
├── asset-depreciation/page.tsx    # 감가상각
└── asset-disposals/page.tsx       # 자산 처분
```

#### 16_lwm - Workflow/Approval Management
```
16_lwm/                            # 기존 구조 유지
├── page.tsx
├── workflows/page.tsx             # 워크플로우 정의
├── steps/page.tsx                 # 워크플로우 스텝
└── tasks/page.tsx                 # 업무/작업
```

#### 20_bim - Business Intelligence Management
```
20_bim/                            # 기존 구조 유지
├── page.tsx
├── kpi-definitions/page.tsx       # KPI 정의
├── kpi-targets/page.tsx           # KPI 목표
├── sales-analytics/page.tsx       # 판매 분석
└── purchase-analytics/page.tsx    # 구매 분석
```

#### 22_sys - System/User Management (adm + 21_com + 22_sys 통합)
```
22_sys/
├── page.tsx
├── users/page.tsx                 # 사용자 (22_sys)
├── roles/page.tsx                 # 역할 (22_sys)
├── permissions/page.tsx           # 권한 (22_sys)
├── role-permissions/page.tsx      # 역할-권한 (22_sys)
├── sessions/page.tsx              # 세션 (22_sys)
├── user-roles/page.tsx            # 사용자-역할 (22_sys)
├── role-permissions-history/page.tsx # 권한 변경 이력 (22_sys)
├── code-groups/page.tsx           # 코드 그룹 (21_com)
├── codes/page.tsx                 # 코드 (21_com)
└── workflows/page.tsx             # 공통 워크플로우 (21_com)
```

### 3. 주요 변경사항

#### 이름 변경
| 이전 폴더 | 새 폴더 | 이유 |
|---------|--------|------|
| csm | 03_crm | DB 스키마명 일치 |
| asm | 15_fam | 실제 내용은 fixed asset management |
| bim | 20_bim | DB 스키마명 명시 |
| ivm | 10_ivm | DB 스키마번호 추가 |
| psm | 11_psm | DB 스키마번호 추가 |
| srm | 12_srm | DB 스키마번호 추가 |
| fim | 14_fim | DB 스키마번호 추가 |
| lwm | 16_lwm | DB 스키마번호 추가 |
| adm/sys/com | 22_sys | 통합 (사용자, 역할, 권한, 설정) |
| adm | 01_adm | 공통코드, 환율, 결제조건 등 |

#### 신규 추가
- `02_hrm` - Human Resource Management
- `04_pim` - Product Information Management
- `05_wms` - Warehouse Management System
- `06_apm` - Approval Management
- `15_fam` - Fixed Asset Management

## 변경된 파일 목록

### 삭제된 폴더
```
/apps/tenants-web/src/app/(main)/
├── adm/           ❌ 삭제 → 22_sys로 통합
├── asm/           ❌ 삭제 → 15_fam으로 변경
├── bim/           ❌ 삭제 → 20_bim으로 이름 변경
├── com/           ❌ 삭제 → 22_sys로 통합
├── csm/           ❌ 삭제 → 03_crm으로 이름 변경
├── fim/           ❌ 삭제 → 14_fim으로 이름 변경
├── ivm/           ❌ 삭제 → 10_ivm으로 이름 변경
├── lwm/           ❌ 삭제 → 16_lwm으로 이름 변경
├── psm/           ❌ 삭제 → 11_psm으로 이름 변경
├── srm/           ❌ 삭제 → 12_srm으로 이름 변경
└── sys/           ❌ 삭제 → 22_sys로 통합
```

### 생성된 폴더 구조

총 147개의 page.tsx 파일과 함께:

```
(main)/
├── 01_adm/           (8개 엔티티)    ✨ 수정됨
├── 02_hrm/           (10개 엔티티)   ✨ 신규
├── 03_crm/           (20개 엔티티)   ✨ csm → 이름변경
├── 04_pim/           (17개 엔티티)   ✨ 신규
├── 05_wms/           (9개 엔티티)    ✨ 신규
├── 06_apm/           (5개 엔티티)    ✨ 신규
├── 10_ivm/           (11개 엔티티)   ✨ 이름변경
├── 11_psm/           (11개 엔티티)   ✨ 이름변경
├── 12_srm/           (13개 엔티티)   ✨ 이름변경
├── 13_fsm/           (9개 엔티티)    ✨ asm → 이름변경
├── 14_fim/           (10개 엔티티)   ✨ 이름변경
├── 15_fam/           (4개 엔티티)    ✨ 신규 (asm 대체)
├── 16_lwm/           (4개 엔티티)    ✨ 이름변경
├── 20_bim/           (5개 엔티티)    ✨ 이름변경
├── 22_sys/           (11개 엔티티)   ✨ 통합 (adm/com/sys)
├── overview/         (유지)
└── layout.tsx        (유지)
```

## 테스트

개발 서버 실행 및 라우트 확인:

```bash
cd apps/tenants-web
pnpm dev
```

새로운 라우트들이 정상 작동하는지 확인:

```
http://localhost:8300/01_adm
http://localhost:8300/01_adm/code-groups
http://localhost:8300/02_hrm/employees
http://localhost:8300/03_crm/partners
http://localhost:8300/04_pim/products
http://localhost:8300/05_wms/warehouses
http://localhost:8300/06_apm/approval-requests
http://localhost:8300/10_ivm/inventory-movements
http://localhost:8300/11_psm/purchase-orders
http://localhost:8300/12_srm/sales-orders
http://localhost:8300/13_fsm/service-requests
http://localhost:8300/14_fim/journal-entries
http://localhost:8300/15_fam/fixed-assets
http://localhost:8300/16_lwm/workflows
http://localhost:8300/20_bim/kpi-definitions
http://localhost:8300/22_sys/users
http://localhost:8300/overview
```

## 향후 개선사항

### Phase 1 - Navigation & Layout
1. **네비게이션 메뉴 구조화**
   - 스키마 번호 기반 메뉴 생성
   - 사이드바 자동 생성

2. **공통 레이아웃 컴포넌트**
   - 각 스키마별 섹션 헤더
   - 통일된 네비게이션

### Phase 2 - API 연결
1. **API 엔드포인트 매핑**
   - `/api/01_adm/codes` ↔ `03_crm/codes/page.tsx`
   - 일관된 API 경로 규칙

2. **TanStack Query 통합**
   - useQuery 훅 자동 생성
   - 캐싱 전략 표준화

### Phase 3 - 데이터 표시
1. **테이블 컴포넌트**
   - 제네릭 테이블 컴포넌트
   - 정렬, 필터, 페이징 기능

2. **폼 컴포넌트**
   - 엔티티별 CRUD 폼
   - React Hook Form + Zod 통합

### Phase 4 - 실제 기능 구현
1. **목록 조회 (Read)**
2. **상세 조회 (Read Detail)**
3. **생성 (Create)**
4. **수정 (Update)**
5. **삭제 (Delete)**

## 마이그레이션 가이드

기존 경로에서 새 경로로의 변경:

```javascript
// 이전
import UsersPage from '@/app/(main)/sys/users/page'

// 변경 후
import UsersPage from '@/app/(main)/22_sys/users/page'

// 라우트 변경
// 이전: /sys/users
// 변경 후: /22_sys/users
```

## 참고사항

### URL 구조

새로운 URL 구조는 DB 스키마를 명시적으로 나타냅니다:

```
/22_sys/users              → 22_sys 스키마의 users 테이블
/10_ivm/inventory          → 10_ivm 스키마의 inventory 테이블
/03_crm/partners           → 03_crm 스키마의 partners 테이블
```

### 번호 체계의 의미

데이터베이스 스키마 번호:
- `01-09`: 기본 관리 시스템 (adm, hrm, crm, pim, wms, apm)
- `10-19`: 운영 시스템 (ivm, psm, srm, asm, fim, fam, lwm)
- `20-29`: 분석 및 시스템 (bim, com, sys)

### 엔티티 폴더명 규칙

- **CamelCase가 아닌 kebab-case 사용**
  - ❌ `inventoryMovements`
  - ✅ `inventory-movements`

- **DB 테이블명을 기반**으로 하지만 가독성 개선
  - ❌ `inventory_movements` (테이블명)
  - ✅ `inventory-movements` (폴더명)

### 라우팅 자동 생성

Next.js App Router가 자동으로 라우트를 생성합니다:
- 폴더 구조 = 라우트 경로
- `22_sys/users/page.tsx` = `/22_sys/users`

추가로 메뉴 링크를 생성할 때는:
```typescript
// navigation.ts
const routes = [
  { path: '/22_sys/users', label: 'Users' },
  { path: '/10_ivm/inventory', label: 'Inventory' },
  // ...
]
```

## 관련 문서

- **CLAUDE.md**: 프로젝트 아키텍처 및 모듈 약자 정의
- **Database Schema**: `/packages/database/schemas/tenants/*/00_schema.sql`
- **API Routes**: `/apps/backend-api/src/api/routers/`

## 질문 및 해결

### Q1: URL이 길어진 것 아닌가?
**A**: 네, 하지만 이는 의도적입니다. 스키마 번호를 명시함으로써:
- 백엔드 API 경로와 동기화 가능
- 큰 프로젝트에서 필요한 명확성
- 스키마 그룹을 한눈에 파악 가능

### Q2: 기존 북마크/링크가 깨지지 않을까?
**A**: 모두 깨집니다. 이를 방지하려면:
1. Next.js Redirect 사용
2. API 게이트웨이 레벨에서 처리
3. 마이그레이션 문서 제공

### Q3: 라우트 변경에 따른 권한 처리는?
**A**: 백엔드 권한 시스템을 그대로 사용합니다:
- URL은 변경되어도 API 엔드포인트는 동일
- 권한 검증은 API 레벨에서 수행
