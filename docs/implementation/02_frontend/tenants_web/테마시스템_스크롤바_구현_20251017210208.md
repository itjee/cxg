# 테마 시스템 및 커스텀 스크롤바 구현

**날짜**: 2025-10-17 21:02:08 KST  
**작성자**: System  
**유형**: 기능 구현  
**컴포넌트**: 테마 프로바이더, UI 컴포넌트, 스타일링

## 개요

라이트, 다크, 시스템 모드를 갖춘 포괄적인 테마 시스템과 선택한 테마에 맞춰 변경되는 커스텀 스타일 스크롤바를 구현했습니다. 이 개선사항은 테마 선호도 제공과 모든 브라우저에서 시각적으로 일관된 스크롤바 스타일링을 통해 사용자 경험을 향상시킵니다.

## 구현된 기능

### 1. 테마 시스템
- **세 가지 테마 모드**: 라이트, 다크, 시스템 (OS 설정 따름)
- **영구 저장**: 테마 선호도를 localStorage에 저장
- **부드러운 전환**: 테마 변경 시 CSS 전환 효과
- **Hydration 안전**: Hydration 불일치 경고 없음

### 2. 커스텀 스크롤바
- **테마 인식**: 라이트/다크 테마에 자동으로 적응
- **크로스 브라우저**: Webkit (Chrome, Safari, Edge) 및 Firefox에서 작동
- **부드러운 인터랙션**: 호버 효과와 전환 효과
- **모던 디자인**: 둥근 모서리, 적절한 패딩, 은은한 색상

## 생성된 컴포넌트

### 1. ThemeProvider (`src/components/theme-provider.tsx`)

**목적**: 전역 테마 상태 관리 및 DOM 클래스 적용

**주요 기능**:
```typescript
type Theme = "light" | "dark" | "system";

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "conexgrow-theme",
}: ThemeProviderProps)
```

**기능**:
- localStorage에서 초기 테마 읽기
- 루트 HTML 요소에 테마 클래스 적용
- `matchMedia`를 통한 시스템 테마 감지 처리
- 컴포넌트용 `useTheme` 훅 제공

**사용법**:
```typescript
const { theme, setTheme } = useTheme();

// 테마 변경
setTheme("dark");
```

### 2. ThemeToggle (`src/components/theme-toggle.tsx`)

**두 가지 변형**:

#### ThemeToggle (다중 버튼)
```typescript
<ThemeToggle />
```
- 라이트, 다크, 시스템용 세 개의 개별 버튼
- 활성 테마에 대한 시각적 표시
- 비활성 버튼에 호버 효과

#### ThemeToggleSimple (단일 버튼)
```typescript
<ThemeToggleSimple />
```
- 테마를 순환하는 단일 버튼: 라이트 → 다크 → 시스템 → 라이트
- 현재 테마에 따라 아이콘 변경 (Sun, Moon, Monitor)
- 공간이 제한된 UI를 위한 컴팩트 디자인

**아이콘**:
- 라이트: Sun 아이콘
- 다크: Moon 아이콘
- 시스템: Monitor 아이콘

## 스타일링 구현

### 커스텀 스크롤바 스타일 (`src/app/globals.css`)

#### Webkit 브라우저 (Chrome, Safari, Edge)

**라이트 테마**:
```css
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: oklch(0.97 0 0);  /* 매우 밝은 회색 */
  border-radius: 8px;
}

::-webkit-scrollbar-thumb {
  background: oklch(0.8 0 0);   /* 중간 회색 */
  border-radius: 8px;
  border: 3px solid oklch(0.97 0 0);  /* 패딩 효과 생성 */
  transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: oklch(0.6 0 0);   /* 호버 시 더 어둡게 */
}
```

**다크 테마**:
```css
.dark ::-webkit-scrollbar-track {
  background: oklch(0.205 0 0);  /* 어두운 회색 */
}

.dark ::-webkit-scrollbar-thumb {
  background: oklch(0.4 0 0);    /* 밝은 회색 */
  border-color: oklch(0.205 0 0);
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: oklch(0.5 0 0);    /* 호버 시 더 밝게 */
}
```

#### Firefox

```css
* {
  scrollbar-width: thin;
  scrollbar-color: oklch(0.8 0 0) oklch(0.97 0 0);  /* thumb track */
}

.dark * {
  scrollbar-color: oklch(0.4 0 0) oklch(0.205 0 0);
}
```

**디자인 세부사항**:
- 스크롤바 너비 12px (얇지만 사용 가능)
- 모던한 둥근 외관을 위한 8px border-radius
- 3px border로 thumb와 track 사이 시각적 패딩 생성
- 호버 시 부드러운 0.2s 전환
- 지각적으로 균일한 색상을 위한 OKLCH 색공간

## 통합

### 루트 레이아웃 (`src/app/layout.tsx`)

```typescript
import { ThemeProvider } from "@/components/theme-provider";

export default function RootLayout({ children }) {
  return (
    <html lang="ko" suppressHydrationWarning>
      <body>
        <ThemeProvider defaultTheme="system" storageKey="conexgrow-theme">
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

**주요 추가사항**:
- `suppressHydrationWarning`: 테마 클래스 불일치로 인한 hydration 경고 방지
- `ThemeProvider`: 전역 테마 접근을 위해 전체 앱 래핑

### 메인 레이아웃 (`src/app/(main)/layout.tsx`)

**헤더 통합**:
```typescript
import { ThemeToggleSimple } from "@/components/theme-toggle";

// 헤더 컴포넌트에서
<div className="flex items-center gap-2">
  <ThemeToggleSimple />
  <button className="relative p-2...">
    <Bell className="h-5 w-5" />
  </button>
</div>
```

**추가된 다크 테마 클래스**:
- 배경: `dark:bg-gray-900`
- 카드: `dark:bg-gray-800`
- 텍스트: `dark:text-white`, `dark:text-gray-300`, `dark:text-gray-400`
- 테두리: `dark:border-gray-700`
- 호버 상태: `dark:hover:bg-gray-700`

### Overview 페이지 (`src/app/(main)/overview/page.tsx`)

**체계적인 업데이트**:
- 모든 `text-gray-*` 클래스: `dark:text-*` 변형 추가
- 모든 `bg-white`: `dark:bg-gray-800` 추가
- 모든 `border-gray-*`: `dark:border-gray-700` 추가
- 호버 상태: 다크 변형 추가

## 색상 팔레트

### 라이트 테마
```css
--background: oklch(1 0 0);              /* 순수 흰색 */
--foreground: oklch(0.145 0 0);          /* 거의 검정 */
--card: oklch(1 0 0);                    /* 흰색 */
--border: oklch(0.922 0 0);              /* 밝은 회색 */
--primary: var(--indigo-500);            /* Indigo 500 */
```

### 다크 테마
```css
--background: oklch(0.145 0 0);          /* 거의 검정 */
--foreground: oklch(0.985 0 0);          /* 거의 흰색 */
--card: oklch(0.205 0 0);                /* 어두운 회색 */
--border: oklch(1 0 0 / 10%);            /* 흰색 10% 투명도 */
--primary: var(--indigo-400);            /* 다크용 더 밝은 indigo */
```

## 사용자 경험 플로우

### 테마 선택
```
사용자가 ThemeToggleSimple 버튼 클릭
  ↓
테마 순환: 라이트 → 다크 → 시스템
  ↓
아이콘 업데이트: Sun → Moon → Monitor
  ↓
테마가 localStorage에 저장: "conexgrow-theme"
  ↓
루트 HTML 클래스 적용: "light" | "dark"
  ↓
모든 dark: 접두사 CSS가 적용됨
  ↓
스크롤바가 자동으로 적응
```

### 시스템 테마
```
사용자가 "시스템" 테마 선택
  ↓
ThemeProvider가 확인: window.matchMedia("(prefers-color-scheme: dark)")
  ↓
OS가 다크 모드인 경우 → "dark" 클래스 적용
OS가 라이트 모드인 경우 → "light" 클래스 적용
  ↓
OS 테마 변경 시 자동으로 업데이트됨
```

## 브라우저 지원

### 스크롤바 스타일링
- ✅ Chrome/Edge: ::-webkit-scrollbar로 완전 지원
- ✅ Safari: ::-webkit-scrollbar로 완전 지원
- ✅ Firefox: scrollbar-width 및 scrollbar-color로 지원
- ❌ IE11: 커스텀 스크롤바 미지원 (우아한 저하)

### 테마 시스템
- ✅ 모든 모던 브라우저 (CSS 커스텀 속성)
- ✅ Tailwind CSS 다크 모드 변형 지원
- ✅ JavaScript 런타임 오류 없음 (hydration-safe)

## 변경된 파일 목록

### 생성
1. `src/components/theme-provider.tsx` - 테마 컨텍스트 및 프로바이더
2. `src/components/theme-toggle.tsx` - 테마 토글 UI 컴포넌트

### 수정
1. `src/app/globals.css` - 커스텀 스크롤바 스타일 추가
2. `src/app/layout.tsx` - ThemeProvider 통합
3. `src/app/(main)/layout.tsx` - 테마 토글 추가, 다크 테마 클래스
4. `src/app/(main)/overview/page.tsx` - 다크 테마 클래스 추가

## 테스트

### 테마 전환
```bash
# 테마 지속성 확인
1. "다크" 테마 선택
2. 페이지 새로고침
3. 테마가 "다크"로 유지되어야 함

# 시스템 테마 확인
1. "시스템" 테마 선택
2. OS 다크 모드 설정 변경
3. 앱이 OS 설정을 따라야 함
```

### 스크롤바 스타일링
```bash
# 시각적 확인
1. 스크롤 가능한 콘텐츠가 있는 페이지로 이동
2. 스크롤바가 테마(라이트/다크)와 일치하는지 확인
3. 호버 효과 테스트
4. 테마 전환 후 스크롤바 업데이트 확인
```

## 접근성

- **색상 대비**: 모든 다크 테마 색상이 WCAG AA 기준 충족
- **시각적 피드백**: 테마 토글이 활성 상태를 명확하게 표시
- **키보드 내비게이션**: 테마 토글이 키보드로 접근 가능
- **스크린 리더**: 아이콘 레이블이 컨텍스트 제공 ("라이트", "다크", "시스템")

## 성능

- **제로 런타임 비용**: CSS 전용 스크롤바 스타일링
- **최소 JavaScript**: 테마 토글은 사용자 상호작용 시에만 실행
- **즉시 전환**: 테마 변경이 CSS 클래스를 통해 즉시 적용됨
- **LocalStorage**: 단일 문자열 값, 무시할 수 있는 스토리지 영향

## 향후 개선사항

1. **커스텀 스크롤바 너비**: 스크롤바 두께에 대한 사용자 선호도 추가
2. **더 많은 테마 옵션**: 추가 색상 스킴 고려 (예: 고대비)
3. **섹션별 테마**: 다른 섹션에 다른 테마 허용
4. **애니메이션 전환**: 테마 전환 시 부드러운 색상 전환
5. **테마 미리보기**: 적용 전 테마 미리보기 표시

## 적용된 모범 사례

1. **Tailwind 다크 모드**: 클래스 기반 전략 사용 (`dark:`)
2. **OKLCH 색공간**: 지각적으로 균일한 색상
3. **CSS 커스텀 속성**: 유연한 테마 시스템
4. **컴포넌트 구성**: 재사용 가능한 테마 컴포넌트
5. **TypeScript**: 테마 값에 대한 완전한 타입 안전성
6. **접근성 우선**: WCAG 준수 색상 대비

## 참고사항

- 스크롤바 스타일링은 순수하게 장식적이며 기능에 영향을 주지 않음
- 시스템 테마는 `matchMedia` API에 대한 브라우저 지원이 필요함
- 테마 선호도는 기기별 저장 (localStorage는 기기 간 동기화되지 않음)
- 다크 테마 색상은 어두운 환경에서 눈의 피로를 줄이도록 선택됨
