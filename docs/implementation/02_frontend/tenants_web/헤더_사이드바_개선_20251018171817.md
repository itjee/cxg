# 헤더 및 사이드바 개선 - Breadcrumb, 사이드바 토글, 검색바 중앙정렬

**날짜**: 2025-10-18 17:18:17 KST
**작성자**: Claude Code
**유형**: 기능 구현
**컴포넌트**: Header, Sidebar, Layout, Breadcrumbs

## 개요
tenants-web의 메인 레이아웃을 개선하여 Breadcrumb 네비게이션 추가, 사이드바 축소/확장 기능 구현, 검색바를 헤더 중앙에 배치하는 UX 개선 작업을 수행했습니다.

## 구현된 기능

### 1. Breadcrumb 네비게이션
- 현재 페이지 경로를 자동으로 분석하여 시각적으로 표시
- 클릭 가능한 링크로 상위 페이지 이동 지원
- ChevronRight 아이콘으로 경로 구분
- 예: `홈 > 기준정보 > 회사 관리`

### 2. 사이드바 축소/확장
- 헤더의 Menu 버튼을 클릭하여 토글
- 데스크톱: 축소/확장 전환
- 모바일: 사이드바 오버레이 열기/닫기
- 축소 시: 56px 너비, 아이콘만 표시, 툴팁 제공
- 확장 시: 256px 너비, 전체 메뉴 레이블 표시
- 부드러운 애니메이션 전환 (200ms)

### 3. 헤더 레이아웃 개선
- **좌측**: 사이드바 토글 버튼 + Breadcrumb (가변 너비)
- **중앙**: 검색 입력란 (고정 320px, 중앙 정렬)
- **우측**: 테마 토글 + 알림 버튼

### 4. 컴포넌트 분리
- 기존 단일 layout.tsx를 Header, Sidebar 컴포넌트로 분리
- 재사용 가능한 구조로 리팩토링
- 유지보수 용이성 향상

## 변경 내용

### 새로운 파일

#### `src/lib/breadcrumbs.ts`
Breadcrumb 자동 생성 유틸리티:

```typescript
export interface BreadcrumbItem {
  label: string;
  href?: string;
}

export function generateBreadcrumbs(pathname: string): BreadcrumbItem[]
```

**주요 기능**:
- 경로 기반 자동 Breadcrumb 생성
- 모듈 카테고리 및 페이지 레이블 매핑
- 동적 라우트 지원 (예: `/adm/companies/123`)
- 클릭 가능한 링크와 현재 페이지 구분

**매핑된 모듈 카테고리**:
- `adm` → 기준정보
- `psm` → 구매/조달
- `srm` → 영업/매출
- `ivm` → 재고/자재
- `lwm` → 물류/창고
- `csm` → 고객지원
- `asm` → A/S 관리
- `fim` → 재무/회계
- `bim` → 경영분석
- `com` → 공통/지원
- `sys` → 시스템

**매핑된 페이지 예시**:
- `/overview` → "대시보드"
- `/adm/companies` → "회사 관리"
- `/psm/orders` → "발주 관리"
- `/srm/opportunities` → "영업기회"
- `/ivm/stock` → "재고현황"
- `/fim/receivables` → "채권 관리"

#### `src/components/layout/header.tsx`
헤더 컴포넌트:

**Props**:
```typescript
interface HeaderProps {
  onToggleSidebar?: () => void;
}
```

**주요 기능**:
1. 자동 Breadcrumb 생성 및 표시
2. 사이드바 토글 버튼
3. 중앙 정렬된 검색바 (⌘K 단축키 표시)
4. 테마 토글 버튼
5. 알림 버튼 (읽지 않은 알림 표시)

**레이아웃 구조**:
```tsx
<header>
  <div className="flex-1">        {/* 좌측: 토글 + Breadcrumb */}
  <div className="flex-shrink-0"> {/* 중앙: 검색바 */}
  <div className="flex-shrink-0"> {/* 우측: 버튼들 */}
</header>
```

#### `src/components/layout/sidebar.tsx`
사이드바 컴포넌트:

**Props**:
```typescript
interface SidebarProps {
  collapsed: boolean;
  mobileOpen: boolean;
  onCollapsedChange: (collapsed: boolean) => void;
  onMobileClose: () => void;
}
```

**주요 기능**:
1. 축소/확장 상태 지원
2. 모바일 오버레이 지원
3. 그룹별 메뉴 접기/펼치기
4. 현재 활성 페이지 하이라이트
5. 축소 시 아이콘만 표시 및 툴팁
6. 사용자 정보 및 로그아웃 버튼

**축소/확장 동작**:
- 확장 시: 로고 + 텍스트, 그룹 레이블, 메뉴 아이템 전체 표시
- 축소 시: 로고만, 그룹 아이콘만, 툴팁으로 레이블 표시

### 수정된 파일

#### `src/app/(main)/layout.tsx`
메인 레이아웃을 간소화하고 분리된 컴포넌트 사용:

**변경사항**:
1. 기존 인라인 사이드바/헤더 코드를 컴포넌트로 분리
2. `collapsed`, `mobileOpen` 상태 관리
3. 데스크톱/모바일 토글 로직 구분:
   - 데스크톱 (≥1024px): 축소/확장 전환
   - 모바일 (<1024px): 오버레이 열기/닫기
4. 반응형 레이아웃 적용

**레이아웃 구조**:
```tsx
<div className="h-screen flex">
  <Sidebar {...props} />
  <div className={collapsed ? "lg:ml-14" : "lg:ml-64"}>
    <Header onToggleSidebar={handleToggleSidebar} />
    <main>{children}</main>
  </div>
</div>
```

## 사용 예시

### Breadcrumb 경로 예시

1. **대시보드**:
   ```
   홈 > 대시보드
   ```

2. **회사 관리**:
   ```
   홈 > 기준정보 > 회사 관리
   ```

3. **구매요청**:
   ```
   홈 > 구매/조달 > 구매요청
   ```

4. **영업기회**:
   ```
   홈 > 영업/매출 > 영업기회
   ```

5. **동적 라우트 (예: 회사 상세)**:
   ```
   홈 > 기준정보 > 회사 관리 > {company_id}
   ```

### 사이드바 상태

**확장 상태** (기본):
- 너비: 256px (w-64)
- 로고 + "ConexGrow 워크스페이스" 텍스트
- 모든 메뉴 그룹 및 아이템 레이블 표시
- 사용자 정보 전체 표시

**축소 상태**:
- 너비: 56px (w-14)
- 로고만 표시
- 메뉴 그룹 아이콘만 표시
- 호버 시 툴팁으로 레이블 표시
- 사용자 아이콘만 표시

**모바일**:
- 사이드바가 화면 밖으로 숨김
- 햄버거 버튼 클릭 시 오버레이로 표시
- 백드롭 클릭 시 닫힘

## 테스트

### 컴파일 검증
```bash
cd apps/tenants-web
pnpm run build
```
✅ 레이아웃 컴포넌트 컴파일 성공
⚠️ signin 페이지의 기존 이슈로 전체 빌드 실패 (레이아웃과 무관)

### 테스트 시나리오
1. ✅ 헤더의 Menu 버튼 클릭 시 사이드바 축소/확장
2. ✅ 축소된 사이드바에서 아이콘만 표시
3. ✅ 페이지 이동 시 Breadcrumb 자동 업데이트
4. ✅ Breadcrumb 링크 클릭 시 상위 페이지로 이동
5. ✅ 검색바가 헤더 중앙에 고정 표시
6. ✅ 반응형 레이아웃 (데스크톱/모바일)
7. ✅ 모바일에서 사이드바 오버레이 동작

## 기술적 고려사항

### CSS 클래스 구조
- `flex-1`: Breadcrumb 영역이 가변 공간 차지
- `flex-shrink-0`: 검색바와 우측 메뉴는 축소되지 않음
- `overflow-x-auto`: 긴 Breadcrumb 경로 시 스크롤
- `transition-all duration-200`: 부드러운 애니메이션
- `lg:ml-14` / `lg:ml-64`: 반응형 여백

### 반응형 디자인
- **데스크톱 (≥1024px)**: 
  - 사이드바 고정, 축소/확장 지원
  - 검색바 항상 표시
  - Breadcrumb 표시
  
- **태블릿/모바일 (<1024px)**:
  - 사이드바 오버레이 방식
  - 검색바 숨김, 검색 버튼만 표시
  - Breadcrumb은 공간에 따라 스크롤

### 접근성
- 축소 상태에서 `title` 속성으로 툴팁 제공
- 키보드 네비게이션 지원 (Link, button 요소)
- 의미 있는 HTML 요소 사용 (`<nav>`, `<header>`, `<aside>`)
- ARIA 속성 추가 고려 가능

### 성능
- `usePathname()` 훅은 클라이언트 사이드에서만 실행
- Breadcrumb 생성 O(n) 시간 복잡도
- 컴포넌트 분리로 재렌더링 최적화
- 테마 이미지 로딩 hydration 이슈 방지

## 향후 개선사항

1. **Breadcrumb 커스터마이징**
   - 페이지별 메타데이터 기반 Breadcrumb
   - 동적 이름 표시 (예: 회사명, 제품명)

2. **사이드바 상태 저장**
   - localStorage에 축소/확장 상태 저장
   - 사용자별 선호 설정 저장

3. **검색 기능 구현**
   - 실시간 검색 결과 표시
   - ⌘K 단축키 지원
   - 최근 검색 히스토리

4. **알림 기능**
   - 실시간 알림 수신
   - 알림 목록 드롭다운
   - 읽음/안읽음 관리

5. **메뉴 즐겨찾기**
   - 자주 사용하는 메뉴 북마크
   - 빠른 접근 기능

6. **키보드 단축키**
   - 사이드바 토글 단축키
   - 메뉴 네비게이션 단축키

## 참고사항

### 관련 파일
- `src/lib/breadcrumbs.ts` - Breadcrumb 유틸리티
- `src/components/layout/header.tsx` - 헤더 컴포넌트
- `src/components/layout/sidebar.tsx` - 사이드바 컴포넌트
- `src/app/(main)/layout.tsx` - 메인 레이아웃

### 디자인 토큰
- 사이드바 확장: `w-64` (256px)
- 사이드바 축소: `w-14` (56px)
- 헤더 높이: `h-14` (56px)
- 검색바 너비: `w-80` (320px)
- 애니메이션: `duration-200` (200ms)
- 반응형 브레이크포인트: `lg` (1024px)

### 기존 이슈
- signin 페이지의 `useSearchParams()` Suspense 경고
  - 레이아웃 변경과 무관한 기존 이슈
  - 별도 수정 필요
