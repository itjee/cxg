# 컴포넌트 컴포지션 구조 적용

**날짜**: 2025-10-18 18:20:11 KST
**작성자**: Claude Code
**유형**: 리팩토링
**컴포넌트**: 목록 페이지 전체 구조

## 개요

tenants-web 애플리케이션에 컴포넌트 컴포지션 패턴을 적용하여 목록 페이지의 구조를 개선했습니다. 이를 통해 재사용성, 유지보수성, 일관성을 크게 향상시켰습니다.

## 구현 배경

기존 목록 페이지들은 다음과 같은 문제점이 있었습니다:
- 각 페이지마다 레이아웃 코드 중복
- 필터, 통계, 테이블이 페이지마다 다른 스타일
- 재사용 불가능한 인라인 구조
- 일관성 없는 UX

## 새로운 아키텍처

### 컴포넌트 계층 구조

```
ListPageLayout (컨테이너)
├── StatsCards (독립 컴포넌트)
├── ListFilter (독립 컴포넌트)
└── DataTable (결합 컴포넌트)
    └── Pagination (내장)
```

### 디렉토리 구조

```
src/components/
├── stats/
│   └── stats-cards.tsx          # 통계 카드 그리드
├── filters/
│   └── list-filter.tsx          # 검색 필터
├── data-table/
│   └── data-table.tsx           # 테이블 + 페이지네이션
└── layouts/
    └── list-page-layout.tsx     # 목록 페이지 레이아웃
```

## 생성된 컴포넌트

### 1. StatsCards (`components/stats/stats-cards.tsx`)

**역할**: 통계 지표 표시

**인터페이스**:
```typescript
interface StatCard {
  title: string;
  value: string | number;
  description?: string;
  icon?: ReactElement;
  iconColor?: string;
  trend?: {
    value: number;
    isPositive: boolean;
    label?: string;
  };
  color?: 'default' | 'primary' | 'success' | 'warning' | 'danger';
}

interface StatsCardsProps {
  cards: StatCard[];
  columns?: 2 | 3 | 4;
  className?: string;
}
```

**특징**:
- 그리드 레이아웃 (2/3/4 컬럼)
- 호버 효과 및 애니메이션
- 아이콘 및 그라디언트 배경
- 트렌드 표시 지원

### 2. ListFilter (`components/filters/list-filter.tsx`)

**역할**: 데이터 필터링 UI

**인터페이스**:
```typescript
type FilterFieldType = 'text' | 'select' | 'multiSelect' | 'dateRange' | 'date' | 'number';

interface FilterField {
  name: string;
  type: FilterFieldType;
  label?: string;
  placeholder?: string;
  options?: Array<{ label: string; value: string | number }>;
  defaultValue?: any;
}

interface ListFilterProps {
  fields: FilterField[];
  defaultValues?: Record<string, any>;
  onFilter: (values: Record<string, any>) => void;
  onReset: () => void;
  className?: string;
}
```

**특징**:
- 다양한 필드 타입 지원
- 접기/펼치기 기능
- 활성 필터 카운트 표시
- 초기화 버튼

### 3. ListPageLayout (`components/layouts/list-page-layout.tsx`)

**역할**: 목록 페이지 일관된 레이아웃

**인터페이스**:
```typescript
interface ListPageLayoutProps {
  title: string;
  description?: string;
  actions?: ReactNode;
  children: ReactNode;
  className?: string;
}
```

**특징**:
- 페이지 제목 및 설명
- 액션 버튼 영역
- 일관된 여백 및 간격

### 4. DataTable (기존 개선)

**위치**: `components/data-table/data-table.tsx`

**개선사항**:
- 새로운 위치로 이동
- 페이지네이션 내장
- 행 번호 자동 표시

## 리팩토링된 페이지

### 회사 관리 페이지 (`adm/companies/page.tsx`)

**변경 전**:
```typescript
// 200+ 라인의 인라인 레이아웃 및 필터 코드
<div className="space-y-6">
  <div className="flex items-center justify-between">...</div>
  <div className="grid grid-cols-4 gap-4">...</div>
  <div className="bg-white rounded-lg border p-4">...</div>
  <DataTable />
</div>
```

**변경 후**:
```typescript
<ListPageLayout title="회사 관리" description="..." actions={<>...</>}>
  <StatsCards cards={stats} columns={4} />
  <ListFilter fields={filterFields} onFilter={...} onReset={...} />
  <DataTable columns={columns} data={data} />
</ListPageLayout>
```

**개선 효과**:
- 코드 라인 수: 274줄 → 270줄 (구조는 동일하나 가독성 향상)
- 재사용 가능한 컴포넌트로 분리
- 명확한 의도와 책임 분리

## 사용 예시

### 기본 사용

```typescript
import { ListPageLayout } from "@/components/layouts/list-page-layout";
import { StatsCards } from "@/components/stats/stats-cards";
import { ListFilter } from "@/components/filters/list-filter";
import { DataTable } from "@/components/data-table/data-table";

export default function MyListPage() {
  const stats = [
    { title: "총 항목", value: 100, icon: <Icon />, color: "primary" }
  ];

  const filterFields = [
    { name: "search", type: "text", placeholder: "검색..." },
    { name: "status", type: "select", options: [...] }
  ];

  return (
    <ListPageLayout title="목록" actions={<Button>추가</Button>}>
      <StatsCards cards={stats} />
      <ListFilter fields={filterFields} onFilter={...} onReset={...} />
      <DataTable columns={columns} data={data} />
    </ListPageLayout>
  );
}
```

### 선택적 사용

```typescript
// 통계 없이 사용
<ListPageLayout title="목록">
  <ListFilter fields={filterFields} onFilter={...} onReset={...} />
  <DataTable columns={columns} data={data} />
</ListPageLayout>

// 필터 없이 사용
<ListPageLayout title="목록">
  <StatsCards cards={stats} />
  <DataTable columns={columns} data={data} />
</ListPageLayout>

// 테이블만 사용
<DataTable columns={columns} data={data} />
```

## 장점

### 1. 재사용성
- 모든 목록 페이지에서 동일한 컴포넌트 사용
- 다른 도메인에도 쉽게 적용 가능

### 2. 일관성
- 모든 페이지에서 동일한 UX
- 디자인 시스템 유지 용이

### 3. 유지보수성
- 컴포넌트별 독립적 수정
- 버그 수정 시 한 곳만 수정

### 4. 테스트 용이성
- 각 컴포넌트를 독립적으로 테스트
- 단위 테스트 작성 간편

### 5. 확장성
- 새 기능 추가 시 기존 코드 영향 최소화
- 인터페이스 확장으로 기능 추가

## 향후 작업

### 단계별 마이그레이션 계획

**Phase 1: 핵심 페이지 (완료)**
- ✅ 회사 관리 (`adm/companies`)

**Phase 2: 기준정보 모듈**
- [ ] 부서 관리 (`adm/departments`)
- [ ] 사원 관리 (`adm/employees`)
- [ ] 거래처 관리 (`adm/partners`)
- [ ] 제품 관리 (`adm/products`)
- [ ] 창고 관리 (`adm/warehouses`)

**Phase 3: 운영 모듈**
- [ ] 구매/조달 모듈 (`psm/*`)
- [ ] 영업/매출 모듈 (`srm/*`)
- [ ] 재고/자재 모듈 (`ivm/*`)
- [ ] 물류/창고 모듈 (`lwm/*`)

**Phase 4: 지원 모듈**
- [ ] 고객지원 모듈 (`csm/*`)
- [ ] A/S 관리 모듈 (`asm/*`)
- [ ] 재무/회계 모듈 (`fim/*`)
- [ ] 경영분석 모듈 (`bim/*`)

**Phase 5: 시스템 모듈**
- [ ] 공통/지원 모듈 (`com/*`)
- [ ] 시스템 모듈 (`sys/*`)

### 추가 개선사항

1. **컴포넌트 강화**
   - [ ] 데이터 테이블에 엑셀 내보내기 기능
   - [ ] 필터 프리셋 저장/불러오기
   - [ ] 고급 필터 (복합 조건)
   - [ ] 컬럼 커스터마이징 (표시/숨김)

2. **성능 최적화**
   - [ ] 가상 스크롤링 (대용량 데이터)
   - [ ] 메모이제이션 적용
   - [ ] 지연 로딩

3. **접근성**
   - [ ] 키보드 네비게이션
   - [ ] ARIA 속성 추가
   - [ ] 스크린 리더 지원

4. **반응형**
   - [ ] 모바일 최적화
   - [ ] 태블릿 레이아웃
   - [ ] 터치 제스처 지원

## 기술적 세부사항

### 컴포넌트 위치
```
src/components/
├── stats/stats-cards.tsx         # 4,741 bytes
├── filters/list-filter.tsx       # 6,224 bytes
├── data-table/data-table.tsx     # 기존 파일 이동
└── layouts/list-page-layout.tsx  # 1,031 bytes
```

### 타입 정의
모든 컴포넌트는 TypeScript로 작성되어 타입 안정성을 보장합니다.

### 스타일링
- Tailwind CSS v4 사용
- 다크 모드 완벽 지원
- 호버 및 전환 애니메이션

### 의존성
- React 19
- TanStack Table (DataTable)
- Lucide React (아이콘)
- Next.js 15 App Router

## 테스트

### 컴파일 검증
```bash
cd apps/tenants-web
pnpm run build
```
✅ 새 컴포넌트 컴파일 성공
⚠️ signin 페이지의 기존 이슈로 전체 빌드 실패 (별도 수정 필요)

### 수동 테스트 체크리스트
- [ ] 통계 카드 렌더링
- [ ] 필터 접기/펼치기
- [ ] 검색 필터링 동작
- [ ] 테이블 정렬
- [ ] 페이지네이션
- [ ] 다크 모드 전환
- [ ] 반응형 레이아웃

## 관련 문서

- [COMPONENT-COMPOSITION-GUIDE.md](../../guides/COMPONENT-COMPOSITION-GUIDE.md) - 컴포넌트 컴포지션 가이드
- [07-FRONTEND-GUIDE.md](../../guides/07-FRONTEND-GUIDE.md) - 프론트엔드 가이드
- [04-PROJECT-STRUCTURE.md](../../guides/04-PROJECT-STRUCTURE.md) - 프로젝트 구조

## 참고사항

### 마이그레이션 가이드

기존 페이지를 새 구조로 변경하는 방법:

1. **레이아웃 래핑**
   ```typescript
   // Before
   <div className="space-y-6">
     <div className="flex justify-between">...</div>
     {children}
   </div>

   // After
   <ListPageLayout title="..." description="..." actions={...}>
     {children}
   </ListPageLayout>
   ```

2. **통계 카드 변경**
   ```typescript
   // Before
   <div className="grid grid-cols-4 gap-4">
     <StatsCard title="..." value={...} />
     <StatsCard title="..." value={...} />
   </div>

   // After
   <StatsCards cards={[
     { title: "...", value: ..., icon: <Icon /> },
     { title: "...", value: ..., icon: <Icon /> },
   ]} columns={4} />
   ```

3. **필터 통합**
   ```typescript
   // Before
   <div className="flex gap-4">
     <input type="text" ... />
     <select ... />
   </div>

   // After
   <ListFilter
     fields={[
       { name: "search", type: "text", placeholder: "..." },
       { name: "status", type: "select", options: [...] }
     ]}
     onFilter={(values) => setFilters(values)}
     onReset={() => setFilters({})}
   />
   ```

### 주의사항

1. **기존 StatsCard 사용 중지**
   - `components/stats-card.tsx`는 deprecated
   - 새로운 `components/stats/stats-cards.tsx` 사용

2. **DataTable import 경로 변경**
   - 기존: `@/components/data-table`
   - 신규: `@/components/data-table/data-table`

3. **필터 상태 관리**
   - 필터 값은 페이지 컴포넌트에서 관리
   - `onFilter` 콜백으로 값 전달

## 결론

컴포넌트 컴포지션 패턴 적용으로 tenants-web의 목록 페이지 아키텍처가 크게 개선되었습니다. 이제 일관되고 재사용 가능하며 유지보수하기 쉬운 구조를 갖추었습니다. 향후 모든 목록 페이지를 단계적으로 마이그레이션하여 전체 애플리케이션의 품질을 향상시킬 계획입니다.
