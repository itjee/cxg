# 컬럼명 표준화 - active/deleted → is_active/is_deleted

**날짜**: 2025-10-20 19:43:00 KST
**작성자**: Claude Assistant
**유형**: 리팩토링
**컴포넌트**: packages/database/schemas/tenants

## 개요

데이터베이스 스키마의 불린(Boolean) 컬럼 명명 규칙을 표준화했습니다. 불린 컬럼은 `is_` 접두사를 사용하는 것이 일반적인 관례이며, 가독성과 일관성을 높이기 위해 다음과 같이 변경했습니다:

- `active` → `is_active`
- `deleted` → `is_deleted`

## 식별된 문제점

### 명명 규칙 불일치

기존 스키마에서는 불린 컬럼의 명명이 일관되지 않았습니다:

```sql
-- 일부 테이블은 is_ 접두사 사용
is_taxfree BOOLEAN DEFAULT false
is_serial BOOLEAN DEFAULT false
is_inventory BOOLEAN DEFAULT true

-- 일부 테이블은 접두사 없이 사용
active BOOLEAN DEFAULT true
deleted BOOLEAN DEFAULT false
```

이러한 불일치는:
1. 코드 가독성 저하
2. 컬럼 타입 추론 어려움
3. 쿼리 작성 시 혼란 야기

## 변경 내용

### 변경된 컬럼

#### 1. deleted → is_deleted

**영향받은 파일:**
- `lwm.sql` - 입출고/물류 관리
- `psm.sql` - 구매 관리
- `srm.sql` - 판매 관리

**변경 예시:**
```sql
-- 변경 전
CREATE TABLE lwm.goods_receipts (
    ...
    status VARCHAR(20) DEFAULT 'DRAFT',
    deleted BOOLEAN DEFAULT false,  -- 변경됨
    ...
);

-- 변경 후
CREATE TABLE lwm.goods_receipts (
    ...
    status VARCHAR(20) DEFAULT 'DRAFT',
    is_deleted BOOLEAN DEFAULT false,  -- 표준화됨
    ...
);
```

#### 2. WHERE 절 업데이트

인덱스 생성 시 사용되는 WHERE 절도 함께 업데이트되었습니다:

```sql
-- 변경 전
CREATE INDEX ix_goods_receipts__gr_code 
    ON lwm.goods_receipts (gr_code) 
    WHERE deleted = false;

-- 변경 후
CREATE INDEX ix_goods_receipts__gr_code 
    ON lwm.goods_receipts (gr_code) 
    WHERE is_deleted = false;
```

### 변경 통계

**컬럼 정의 변경:**
- `is_deleted` 컬럼: 26개 정의

**WHERE 절 변경:**
- `WHERE is_deleted = false`: 151개 위치

**영향받은 테이블:**
```sql
-- lwm.sql (입출고/물류)
lwm.goods_receipts
lwm.goods_issues

-- psm.sql (구매)
psm.purchase_requisitions
psm.purchase_orders

-- srm.sql (판매)
srm.quotations
srm.sales_orders
```

## 변경된 파일 목록

```
packages/database/schemas/tenants/
├── lwm.sql  (14KB) - 10 라인 변경
├── psm.sql  (5.7KB) - 4 라인 변경
└── srm.sql  (5.4KB) - 4 라인 변경
```

**총 변경량:** 18 라인 (컬럼 정의 + WHERE 절)

**백업 디렉토리:**
```
packages/database/schemas/tenants/backup_before_active_deleted_rename_20251020_194040/
```

## 명명 규칙 가이드

### 불린 컬럼 명명 규칙

앞으로 모든 불린 컬럼은 다음 규칙을 따릅니다:

1. **`is_` 접두사 사용** (상태를 나타내는 경우)
   ```sql
   is_active BOOLEAN
   is_deleted BOOLEAN
   is_verified BOOLEAN
   is_primary BOOLEAN
   ```

2. **`has_` 접두사 사용** (소유/포함을 나타내는 경우)
   ```sql
   has_dock BOOLEAN
   has_crane BOOLEAN
   has_cold_storage BOOLEAN
   ```

3. **기타 접두사**
   - `can_`: 권한/능력 (`can_edit`, `can_approve`)
   - `should_`: 권장사항 (`should_notify`)
   - `will_`: 미래 행동 (`will_expire`)

### 예외 사항

일부 도메인 특화 불린 컬럼은 예외로 둘 수 있습니다:
```sql
-- 세무 관련
taxable BOOLEAN  -- 또는 is_taxable

-- 시리즈/배치 관련  
serialized BOOLEAN  -- 또는 is_serialized
```

## 코드 예시

### 쿼리 예시 (변경 후)

```sql
-- 활성 상태의 삭제되지 않은 입고 조회
SELECT * FROM lwm.goods_receipts
WHERE is_deleted = false
  AND status = 'CONFIRMED';

-- 삭제되지 않은 구매 요청 조회
SELECT * FROM psm.purchase_requisitions
WHERE is_deleted = false
  AND status IN ('DRAFT', 'SUBMITTED');

-- 활성 판매 주문 조회
SELECT * FROM srm.sales_orders
WHERE is_deleted = false
  AND status NOT IN ('CANCELLED', 'COMPLETED');
```

### 인덱스 최적화

삭제되지 않은 레코드만 인덱싱하여 성능 향상:
```sql
CREATE INDEX ix_goods_receipts__gr_code 
    ON lwm.goods_receipts (gr_code) 
    WHERE is_deleted = false;
```

## 테스트

### 스키마 검증

```bash
# 1. 이전 컬럼명 제거 확인
grep -n "^\s*deleted\s" *.sql | grep -v "backup" | wc -l
# 결과: 0

# 2. 새 컬럼명 적용 확인
grep -n "^\s*is_deleted\s" *.sql | grep -v "backup" | wc -l
# 결과: 26

# 3. WHERE 절 업데이트 확인
grep "WHERE is_deleted" *.sql | grep -v "backup" | wc -l
# 결과: 151
```

### 구문 검증

변경된 SQL이 PostgreSQL 15+ 문법을 준수하는지 확인:
```sql
-- 테이블 생성 검증
CREATE TABLE test_table (
    id UUID PRIMARY KEY,
    is_deleted BOOLEAN DEFAULT false
);

-- 인덱스 생성 검증
CREATE INDEX ix_test__active 
    ON test_table (id) 
    WHERE is_deleted = false;

-- 쿼리 검증
SELECT * FROM test_table WHERE is_deleted = false;
```

## 향후 개선사항

1. **백엔드 모델 동기화**
   - SQLAlchemy 모델에서 `deleted` → `is_deleted` 변경
   - 예: `apps/backend-api/src/api/models/tenant/lwm.py`

2. **API 스키마 업데이트**
   - Pydantic 스키마 필드명 변경
   - 예: `apps/backend-api/src/api/schemas/lwm.py`

3. **프론트엔드 타입 정의**
   - TypeScript 인터페이스 업데이트
   - 예: `packages/shared-types/src/lwm.ts`

4. **데이터 마이그레이션 (기존 데이터가 있는 경우)**
   ```sql
   -- lwm.goods_receipts
   ALTER TABLE lwm.goods_receipts 
   RENAME COLUMN deleted TO is_deleted;
   
   -- lwm.goods_issues
   ALTER TABLE lwm.goods_issues 
   RENAME COLUMN deleted TO is_deleted;
   
   -- psm.purchase_requisitions
   ALTER TABLE psm.purchase_requisitions 
   RENAME COLUMN deleted TO is_deleted;
   
   -- psm.purchase_orders
   ALTER TABLE psm.purchase_orders 
   RENAME COLUMN deleted TO is_deleted;
   
   -- srm.quotations
   ALTER TABLE srm.quotations 
   RENAME COLUMN deleted TO is_deleted;
   
   -- srm.sales_orders
   ALTER TABLE srm.sales_orders 
   RENAME COLUMN deleted TO is_deleted;
   ```

5. **기존 인덱스 재생성**
   ```sql
   -- 이전 인덱스 삭제
   DROP INDEX IF EXISTS ix_goods_receipts__gr_code;
   
   -- 새 인덱스 생성
   CREATE INDEX ix_goods_receipts__gr_code 
       ON lwm.goods_receipts (gr_code) 
       WHERE is_deleted = false;
   ```

## 참고사항

- 이 변경사항은 데이터베이스 스키마 정의 파일에만 적용됨
- 실제 데이터베이스에 적용하려면 ALTER TABLE 마이그레이션 스크립트 필요
- 기존 데이터가 있는 경우 컬럼명 변경 전 백업 필수
- `active` 컬럼은 현재 스키마에 사용되지 않아 변경 대상 없음
- 모든 변경사항은 `backup_before_active_deleted_rename_20251020_194040/`에 백업됨

## 명명 규칙 체크리스트

새로운 테이블 생성 시 다음을 확인하세요:

- [ ] 불린 컬럼에 적절한 접두사 사용 (`is_`, `has_`, `can_` 등)
- [ ] 논리 삭제는 `is_deleted` 사용
- [ ] 활성 상태는 `is_active` 사용
- [ ] WHERE 절에서 일관된 컬럼명 사용
- [ ] 인덱스 조건에 불린 컬럼 활용
