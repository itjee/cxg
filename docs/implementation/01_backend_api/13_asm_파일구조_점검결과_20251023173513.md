# 13_asm í´ë” íŒŒì¼ êµ¬ì¡° ì ê²€ ê²°ê³¼

**ë‚ ì§œ**: 2025-10-23 17:35:13 KST
**ì‘ì„±ì**: Claude (AI Assistant)
**ìœ í˜•**: ê²€ì‚¬ ë° ë¶„ì„
**ì»´í¬ë„ŒíŠ¸**: ASM ìŠ¤í‚¤ë§ˆ (13_asm í´ë”)

## ê°œìš”

13_asm í´ë”ì˜ ëª¨ë“  SQL íŒŒì¼ì„ ì ê²€í•œ ê²°ê³¼, **ì‹¬ê°í•œ êµ¬ì¡°ì  ë¬¸ì œ**ë¥¼ ë°œê²¬í•˜ì˜€ìŠµë‹ˆë‹¤.

## ì ê²€ ê²°ê³¼ ìš”ì•½

### íŒŒì¼ë³„ ì™„ì„±ë„

| íŒŒì¼ | í…Œì´ë¸” | CHECK | ì¸ë±ìŠ¤ | ì™¸ë˜í‚¤ | ì£¼ì„ | ìƒíƒœ |
|------|--------|-------|--------|--------|------|------|
| 00_schema.sql | N/A | N/A | N/A | N/A | âœ… | âœ… ì •ìƒ |
| 01_service_requests.sql | âœ… | âœ… (6ê°œ) | âŒ **0ê°œ** | âŒ **0ê°œ** | âœ… | âš ï¸ 60% |
| 02_service_works.sql | âœ… | âœ… (5ê°œ) | âŒ **0ê°œ** | âŒ **0ê°œ** | âœ… | âš ï¸ 60% |
| 03_service_parts.sql | âœ… | âœ… (4ê°œ) | âš ï¸ **í˜¼ì¬** | âŒ **0ê°œ** | âœ… | ğŸ”´ 30% |
| 04_support_tickets.sql | âœ… | âœ… (5ê°œ) | âŒ **0ê°œ** | âŒ **0ê°œ** | âœ… | âš ï¸ 60% |
| 05_ticket_comments.sql | âœ… | âœ… (1ê°œ) | âŒ **0ê°œ** | âŒ **0ê°œ** | âœ… | âš ï¸ 60% |
| 06_faqs.sql | âœ… | âœ… (4ê°œ) | âœ… (5ê°œ) | N/A | âœ… | âœ… 100% |

## ğŸ”´ ì‹¬ê°í•œ ë¬¸ì œì 

### 1. 03_service_parts.sql - ì¸ë±ìŠ¤ í˜¼ì¬

**ë¬¸ì œ**: service_parts í…Œì´ë¸” íŒŒì¼ì— **ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì¸ë±ìŠ¤ê°€ ëª¨ë‘ í¬í•¨**ë¨

```
ğŸ“ 03_service_parts.sql (233ì¤„)
â”œâ”€â”€ service_parts í…Œì´ë¸” ì •ì˜ (ë³¸ì¸)
â”œâ”€â”€ service_parts ì£¼ì„ (ë³¸ì¸)
â”œâ”€â”€ âŒ service_requests ì¸ë±ìŠ¤ 12ê°œ (ë‹¤ë¥¸ í…Œì´ë¸”!)
â”œâ”€â”€ âŒ service_works ì¸ë±ìŠ¤ 5ê°œ (ë‹¤ë¥¸ í…Œì´ë¸”!)
â”œâ”€â”€ service_parts ì¸ë±ìŠ¤ 4ê°œ (ë³¸ì¸)
â””â”€â”€ âŒ ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ 2ê°œ (service_requests, support_tickets - ë‹¤ë¥¸ í…Œì´ë¸”!)
```

**í¬í•¨ëœ ë‹¤ë¥¸ í…Œì´ë¸” ì¸ë±ìŠ¤:**
- `ix_service_requests__sr_code` (line 69)
- `ix_service_requests__customer_id` (line 74)
- `ix_service_requests__product_id` (line 79)
- `ix_service_requests__assigned_technician_id` (line 84)
- `ix_service_requests__status` (line 90)
- `ix_service_requests__service_type` (line 95)
- `ix_service_requests__priority` (line 100)
- `ix_service_requests__is_warranty` (line 105)
- `ix_service_requests__created_at` (line 110)
- `ix_service_requests__completed_at` (line 115)
- `ix_service_requests__serial_number` (line 121)
- `ix_service_requests__scheduled_date` (line 127)
- `ix_service_works__service_request_id` (line 134)
- `ix_service_works__technician_id` (line 139)
- `ix_service_works__work_date` (line 144)
- `ix_service_works__status` (line 149)
- `ix_service_works__created_at` (line 154)
- `ux_service_requests__code` (line 186)
- `ux_support_tickets__code` (line 192)

### 2. ëª¨ë“  íŒŒì¼ì— ì™¸ë˜í‚¤ ëˆ„ë½

**ë¬¸ì œ**: 6ê°œ í…Œì´ë¸” íŒŒì¼ ëª¨ë‘ ì™¸ë˜í‚¤ ì •ì˜ê°€ **ì „í˜€ ì—†ìŒ**

**í•„ìš”í•œ ì™¸ë˜í‚¤:**

#### 01_service_requests.sql
```sql
-- í•„ìš” ì™¸ë˜í‚¤ 4ê°œ
customer_id â†’ crm.partners(id)
product_id â†’ pim.products(id)
assigned_technician_id â†’ adm.employees(id)
currency â†’ adm.currencies(code)
```

#### 02_service_works.sql
```sql
-- í•„ìš” ì™¸ë˜í‚¤ 2ê°œ
service_request_id â†’ asm.service_requests(id) [CASCADE]
technician_id â†’ adm.employees(id)
```

#### 03_service_parts.sql
```sql
-- í•„ìš” ì™¸ë˜í‚¤ 3ê°œ
service_request_id â†’ asm.service_requests(id) [CASCADE]
service_work_id â†’ asm.service_works(id)
product_id â†’ pim.products(id)
```

#### 04_support_tickets.sql
```sql
-- í•„ìš” ì™¸ë˜í‚¤ 3ê°œ
customer_id â†’ crm.partners(id)
product_id â†’ pim.products(id)
assigned_to â†’ adm.employees(id)
linked_service_request_id â†’ asm.service_requests(id)
```

#### 05_ticket_comments.sql
```sql
-- í•„ìš” ì™¸ë˜í‚¤ 1ê°œ
ticket_id â†’ asm.support_tickets(id) [CASCADE]
```

### 3. ëŒ€ë¶€ë¶„ íŒŒì¼ì— ì¸ë±ìŠ¤ ëˆ„ë½

**ë¬¸ì œ**: 06_faqs.sqlë§Œ ì¸ë±ìŠ¤ê°€ ìˆê³  ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ **0ê°œ**

| íŒŒì¼ | í•„ìš” ì¸ë±ìŠ¤ ìˆ˜ | í˜„ì¬ | ìƒíƒœ |
|------|---------------|------|------|
| 01_service_requests.sql | 10+ | 0 | âŒ |
| 02_service_works.sql | 5+ | 0 | âŒ |
| 03_service_parts.sql | 4 | 4 (í˜¼ì¬) | âš ï¸ |
| 04_support_tickets.sql | 8+ | 0 | âŒ |
| 05_ticket_comments.sql | 3+ | 0 | âŒ |
| 06_faqs.sql | 5 | 5 | âœ… |

## ğŸ“‹ ìˆ˜ì • ì‘ì—… ê³„íš

### Phase 1: 03_service_parts.sql ì •ë¦¬

1. **ë¶„ë¦¬í•  ë‚´ìš© ì¶”ì¶œ**
   - service_requests ì¸ë±ìŠ¤ 12ê°œ â†’ 01_service_requests.sql
   - service_works ì¸ë±ìŠ¤ 5ê°œ â†’ 02_service_works.sql
   - ux_service_requests__code â†’ 01_service_requests.sql
   - ux_support_tickets__code â†’ 04_support_tickets.sql

2. **03_service_parts.sql ì¬êµ¬ì„±**
   ```sql
   â”œâ”€â”€ í…Œì´ë¸” ì •ì˜
   â”œâ”€â”€ ì£¼ì„
   â”œâ”€â”€ service_parts ì¸ë±ìŠ¤ 4ê°œë§Œ ìœ ì§€
   â””â”€â”€ service_parts ì™¸ë˜í‚¤ 3ê°œ ì¶”ê°€
   ```

### Phase 2: ê° íŒŒì¼ì— ì¸ë±ìŠ¤ ì¶”ê°€

#### 01_service_requests.sql
```sql
-- ì¶”ê°€ í•„ìš” (12ê°œ ì¸ë±ìŠ¤ + 1ê°œ ìœ ë‹ˆí¬)
CREATE INDEX ix_service_requests__sr_code ...
CREATE INDEX ix_service_requests__customer_id ...
CREATE INDEX ix_service_requests__product_id ...
CREATE INDEX ix_service_requests__assigned_technician_id ...
CREATE INDEX ix_service_requests__status ...
CREATE INDEX ix_service_requests__service_type ...
CREATE INDEX ix_service_requests__priority ...
CREATE INDEX ix_service_requests__is_warranty ...
CREATE INDEX ix_service_requests__created_at ...
CREATE INDEX ix_service_requests__completed_at ...
CREATE INDEX ix_service_requests__serial_number ...
CREATE INDEX ix_service_requests__scheduled_date ...
CREATE UNIQUE INDEX ux_service_requests__code ...
```

#### 02_service_works.sql
```sql
-- ì¶”ê°€ í•„ìš” (5ê°œ ì¸ë±ìŠ¤)
CREATE INDEX ix_service_works__service_request_id ...
CREATE INDEX ix_service_works__technician_id ...
CREATE INDEX ix_service_works__work_date ...
CREATE INDEX ix_service_works__status ...
CREATE INDEX ix_service_works__created_at ...
```

#### 04_support_tickets.sql
```sql
-- ì¶”ê°€ í•„ìš” (9ê°œ ì¸ë±ìŠ¤ + 1ê°œ ìœ ë‹ˆí¬)
-- 06_faqs.sqlì—ì„œ ì´ë™
CREATE INDEX ix_support_tickets__ticket_code ...
CREATE INDEX ix_support_tickets__customer_id ...
CREATE INDEX ix_support_tickets__status ...
CREATE INDEX ix_support_tickets__assigned_to ...
CREATE INDEX ix_support_tickets__category ...
CREATE INDEX ix_support_tickets__created_at ...
CREATE INDEX ix_support_tickets__linked_service_request_id ...
CREATE INDEX ix_support_tickets__contact_email ...
CREATE INDEX ix_support_tickets__resolved_at ...
CREATE UNIQUE INDEX ux_support_tickets__code ...
```

#### 05_ticket_comments.sql
```sql
-- ì¶”ê°€ í•„ìš” (3ê°œ ì¸ë±ìŠ¤)
-- 06_faqs.sqlì—ì„œ ì´ë™
CREATE INDEX ix_ticket_comments__ticket_id ...
CREATE INDEX ix_ticket_comments__created_by ...
CREATE INDEX ix_ticket_comments__comment_type ...
```

### Phase 3: ëª¨ë“  íŒŒì¼ì— ì™¸ë˜í‚¤ ì¶”ê°€

ê° í…Œì´ë¸” íŒŒì¼ ëì— ì™¸ë˜í‚¤ ì„¹ì…˜ ì¶”ê°€:

```sql
-- =====================================================================================
-- ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´
-- =====================================================================================

ALTER TABLE asm.í…Œì´ë¸”ëª…
  ADD CONSTRAINT fk_í…Œì´ë¸”ëª…__ì»¬ëŸ¼ëª…
    FOREIGN KEY (ì»¬ëŸ¼ëª…) REFERENCES ì°¸ì¡°í…Œì´ë¸”(ì°¸ì¡°ì»¬ëŸ¼)
    ON DELETE ì˜µì…˜;
```

## ğŸ“‚ í‘œì¤€ íŒŒì¼ êµ¬ì¡°

ê° í…Œì´ë¸” íŒŒì¼ì€ ë‹¤ìŒ ìˆœì„œë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•¨:

```sql
-- =====================================================================================
-- í…Œì´ë¸”: asm.í…Œì´ë¸”ëª…
-- ì„¤ëª…: í…Œì´ë¸” ì„¤ëª…
-- ì‘ì„±ì¼: YYYY-MM-DD
-- ìˆ˜ì •ì¼: YYYY-MM-DD - ìˆ˜ì • ë‚´ìš©
-- =====================================================================================

-- 1. CREATE TABLE (í…Œì´ë¸” ì •ì˜ + CHECK ì œì•½ì¡°ê±´)

-- 2. COMMENT ON TABLE/COLUMN (ì£¼ì„)

-- 3. CREATE INDEX (ì¼ë°˜ ì¸ë±ìŠ¤)

-- 4. CREATE UNIQUE INDEX (ìœ ë‹ˆí¬ ì¸ë±ìŠ¤)

-- 5. ALTER TABLE ADD CONSTRAINT (ì™¸ë˜í‚¤)
```

## ğŸ”§ ì¦‰ì‹œ ìˆ˜ì • í•„ìš” ì‚¬í•­

### ìš°ì„ ìˆœìœ„ 1 (ê¸´ê¸‰)
- âœ… **06_faqs.sql**: ì´ë¯¸ ì •ë¦¬ ì™„ë£Œ
- ğŸ”´ **03_service_parts.sql**: í˜¼ì¬ëœ ì¸ë±ìŠ¤ ë¶„ë¦¬ í•„ìš”

### ìš°ì„ ìˆœìœ„ 2 (ë†’ìŒ)
- âš ï¸ **01_service_requests.sql**: ì¸ë±ìŠ¤ 12ê°œ + ì™¸ë˜í‚¤ 4ê°œ ì¶”ê°€
- âš ï¸ **02_service_works.sql**: ì¸ë±ìŠ¤ 5ê°œ + ì™¸ë˜í‚¤ 2ê°œ ì¶”ê°€
- âš ï¸ **04_support_tickets.sql**: ì¸ë±ìŠ¤ 9ê°œ + ì™¸ë˜í‚¤ 4ê°œ ì¶”ê°€
- âš ï¸ **05_ticket_comments.sql**: ì¸ë±ìŠ¤ 3ê°œ + ì™¸ë˜í‚¤ 1ê°œ ì¶”ê°€

## ğŸ“Š ì‘ì—…ëŸ‰ ì¶”ì •

| ì‘ì—… | ì˜ˆìƒ ì‹œê°„ | ë‚œì´ë„ |
|------|----------|--------|
| 03_service_parts.sql ë¶„ë¦¬ | 30ë¶„ | ì¤‘ |
| ì¸ë±ìŠ¤ ì¶”ê°€ (5ê°œ íŒŒì¼) | 1ì‹œê°„ | ì¤‘ |
| ì™¸ë˜í‚¤ ì¶”ê°€ (5ê°œ íŒŒì¼) | 30ë¶„ | í•˜ |
| í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ | 30ë¶„ | ì¤‘ |
| **ì´ê³„** | **2.5ì‹œê°„** | - |

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

### Before (í˜„ì¬)
```
âŒ ì¸ë±ìŠ¤ í˜¼ì¬ (03_service_parts.sqlì— ëª¨ë“  ì¸ë±ìŠ¤ ì§‘ì¤‘)
âŒ ì™¸ë˜í‚¤ ì „ë¬´ (ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥ ì•ˆë¨)
âŒ íŒŒì¼ë³„ ë¶ˆì™„ì „í•œ êµ¬ì¡°
```

### After (ìˆ˜ì • í›„)
```
âœ… ê° í…Œì´ë¸” íŒŒì¼ì´ ë…ë¦½ì ìœ¼ë¡œ ì™„ì„±
âœ… ëª¨ë“  ì™¸ë˜í‚¤ ì •ì˜ (ì°¸ì¡° ë¬´ê²°ì„± í™•ë³´)
âœ… ì¸ë±ìŠ¤ê°€ í•´ë‹¹ í…Œì´ë¸” íŒŒì¼ì—ë§Œ ì¡´ì¬
âœ… í‘œì¤€ íŒŒì¼ êµ¬ì¡° ì¤€ìˆ˜
```

## ì°¸ê³ ì‚¬í•­

### ì™¸ë˜í‚¤ ì‚­ì œ ì˜µì…˜

```sql
CASCADE      -- ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ë„ ì‚­ì œ
RESTRICT     -- ìì‹ì´ ìˆìœ¼ë©´ ë¶€ëª¨ ì‚­ì œ ë¶ˆê°€
SET NULL     -- ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ì˜ FKë¥¼ NULLë¡œ
SET DEFAULT  -- ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ì˜ FKë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ
NO ACTION    -- RESTRICTì™€ ìœ ì‚¬ (íŠ¸ëœì­ì…˜ ì¢…ë£Œ ì‹œ ì²´í¬)
```

### ê¶Œì¥ ì‚­ì œ ì˜µì…˜

- **service_works** â†’ service_requests: CASCADE (ì‘ì—…ì€ ìš”ì²­ì— ì¢…ì†)
- **service_parts** â†’ service_requests: CASCADE (ë¶€í’ˆë„ ìš”ì²­ì— ì¢…ì†)
- **ticket_comments** â†’ support_tickets: CASCADE (ëŒ“ê¸€ì€ í‹°ì¼“ì— ì¢…ì†)
- **service_requests** â†’ customer: RESTRICT (ê³ ê° ì‚­ì œ ê¸ˆì§€)
- **service_requests** â†’ product: SET NULL (ì œí’ˆ ì‚­ì œ ì‹œ NULL)

## ê´€ë ¨ ë¬¸ì„œ

- êµ¬í˜„ ë¬¸ì„œ: `/docs/implementation/backend-api/ASM_ìŠ¤í‚¤ë§ˆ_DDL_í‘œì¤€í™”_20251023171626.md`
- DDL í‘œì¤€: `/docs/prompts/ddl_standard_prompt.md`
- README: `/packages/database/schemas/tenants/13_asm/README.md`

## ê²°ë¡ 

13_asm í´ë”ì˜ SQL íŒŒì¼ë“¤ì€ **í…Œì´ë¸” ì •ì˜ì™€ CHECK ì œì•½ì¡°ê±´**ì€ ì˜ ì‘ì„±ë˜ì–´ ìˆìœ¼ë‚˜, **ì¸ë±ìŠ¤ì™€ ì™¸ë˜í‚¤**ê°€ ì œëŒ€ë¡œ ë°°ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

íŠ¹íˆ 03_service_parts.sqlì— ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì¸ë±ìŠ¤ê°€ ëª¨ë‘ ëª°ë ¤ìˆëŠ” ê²ƒì´ ê°€ì¥ í° ë¬¸ì œì…ë‹ˆë‹¤.

**ì¦‰ì‹œ ìˆ˜ì • ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.**
