# 컴포넌트 조합 패턴 리팩토링

**날짜**: 2025-10-18 18:24:15 KST
**작성자**: Claude Code
**유형**: 리팩토링
**컴포넌트**:
- ListPageLayout (공통 레이아웃)
- StatsCards (통계 카드 그리드)
- StatCard (개별 통계 카드)
- ListFilter (검색/필터 컴포넌트)
- 페이지 컴포넌트 (Users, Roles, Tenants, Companies)

## 개요

COMPONENT-COMPOSITION-GUIDE.md 지침에 따라 주요 목록 페이지들을 컴포넌트 조합 패턴(Composition over Configuration)으로 리팩토링했습니다. 기존의 설정 기반 접근 방식에서 벗어나, 재사용 가능한 컴포넌트를 조합하는 방식으로 전환하여 유연성과 확장성을 크게 개선했습니다.

## 컴포넌트 조합 패턴 (Composition Pattern)

### 핵심 원칙

1. **Composition over Configuration**: 설정보다 조합을 우선
2. **Single Responsibility**: 각 컴포넌트는 단일 책임을 가짐
3. **Flexibility**: 유연한 레이아웃 구성
4. **Reusability**: 재사용 가능한 컴포넌트

### 4-Component 구조

```
┌─────────────────────────────────────┐
│     ListPageLayout (Container)      │
│  ┌───────────────────────────────┐  │
│  │   1. StatsCards (Optional)    │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   2. ListFilter (Optional)    │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   3. DataTable (Required)     │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

## 생성된 공통 컴포넌트

### 1. ListPageLayout

**위치**:
- `apps/manager-web/src/components/layouts/list-page-layout.tsx`
- `apps/tenants-web/src/components/layouts/list-page-layout.tsx`

**역할**: 페이지 전체 레이아웃 제공

**Props**:
```typescript
interface ListPageLayoutProps {
  title: string;              // 페이지 제목
  description?: string;       // 페이지 설명
  actions?: React.ReactNode;  // 우측 액션 버튼들
  children: React.ReactNode;  // 내부 컨텐츠 (Stats, Filter, Table 등)
  className?: string;
}
```

**특징**:
- 일관된 헤더 구조 (제목 + 설명 + 액션)
- 자식 컴포넌트를 자유롭게 배치 가능
- 6px 간격으로 컨텐츠 배치

### 2. StatsCards

**위치**:
- `apps/manager-web/src/components/stats/stats-cards.tsx`
- `apps/tenants-web/src/components/stats/stats-cards.tsx`

**역할**: 통계 카드 그리드 컨테이너

**Props**:
```typescript
interface StatsCardsProps {
  cards: StatCardData[];           // 카드 데이터 배열
  columns?: 2 | 3 | 4;             // 컬럼 수 (기본: 4)
  className?: string;
}

interface StatCardData {
  title: string;                   // 카드 제목
  value: string | number;          // 주요 값
  description?: string;            // 부가 설명
  icon?: React.ReactNode;          // 아이콘
  trend?: {                        // 트렌드 정보
    value: number;
    isPositive: boolean;
    label?: string;
  };
  color?: "default" | "primary" | "success" | "warning" | "danger";
}
```

**반응형 그리드**:
- 2 columns: `grid-cols-1 md:grid-cols-2`
- 3 columns: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3`
- 4 columns: `grid-cols-1 md:grid-cols-2 lg:grid-cols-4`

### 3. StatCard

**위치**:
- `apps/manager-web/src/components/stats/stats-card.tsx`
- `apps/tenants-web/src/components/stats/stats-card.tsx`

**역할**: 개별 통계 카드 표시

**색상 시스템**:
```typescript
const colorClasses = {
  default: "border-border",
  primary: "border-primary/20 bg-primary/5",
  success: "border-emerald-500/20 bg-emerald-500/5",
  warning: "border-orange-500/20 bg-orange-500/5",
  danger: "border-destructive/20 bg-destructive/5",
};

const iconColorClasses = {
  default: "text-muted-foreground",
  primary: "text-primary",
  success: "text-emerald-600 dark:text-emerald-500",
  warning: "text-orange-600 dark:text-orange-500",
  danger: "text-destructive",
};
```

**특징**:
- 아이콘 + 값 + 설명 + 트렌드 표시
- 5가지 색상 변형 지원
- Neutral + Violet 색상 시스템 사용

### 4. ListFilter

**위치**:
- `apps/manager-web/src/components/filters/list-filter.tsx`
- `apps/tenants-web/src/components/filters/list-filter.tsx`

**역할**: 검색 및 필터링 UI 제공

**Props**:
```typescript
interface ListFilterProps {
  fields: FilterField[];                      // 필터 필드 정의
  defaultValues?: Record<string, any>;        // 기본값
  onFilter: (values: Record<string, any>) => void;
  onReset: () => void;
  className?: string;
}

interface FilterField {
  name: string;
  type: "text" | "select" | "multiSelect" | "dateRange" | "date" | "number";
  label?: string;
  placeholder?: string;
  options?: Array<{ label: string; value: string | number }>;
  defaultValue?: any;
}
```

**지원 필드 타입**:
- `text`: 텍스트 검색 (검색 아이콘 포함)
- `select`: 단일 선택 드롭다운
- `number`: 숫자 입력
- `multiSelect`, `dateRange`, `date`: 향후 확장 가능

## 리팩토링된 페이지

### 1. 사용자 관리 페이지 (manager-web)

**파일**: `apps/manager-web/src/app/(main)/idam/users/page.tsx`

**변경 전**:
```typescript
// 구조화되지 않은 레이아웃, 설정 기반 접근
<ListPageLayout title="..." stats={stats}>
  <UserTable />
</ListPageLayout>
```

**변경 후**:
```typescript
<ListPageLayout
  title="사용자 관리"
  description="플랫폼 관리자 및 운영자 계정을 관리합니다"
  actions={actions}
>
  {/* 1. 통계 카드 */}
  <StatsCards cards={stats} columns={4} />

  {/* 2. 데이터 테이블 */}
  <UserTable
    onEdit={handleEditUser}
    onDelete={handleDeleteUser}
    onViewDetails={handleViewDetails}
    onToggleStatus={handleToggleStatus}
  />
</ListPageLayout>
```

**통계 카드 구성**:
- 전체 사용자 (primary)
- 활성 사용자 (success)
- 비활성 사용자 (default)
- 정지 사용자 (danger)

### 2. 역할 관리 페이지 (manager-web)

**파일**: `apps/manager-web/src/app/(main)/idam/roles/page.tsx`

**변경사항**:
- 구 레이아웃 (`@/components/layout/list-page-layout`) → 새 레이아웃
- Stats props 전달 방식 → StatsCards 컴포넌트 사용
- 버튼 그룹 스타일 제거 → 개별 버튼으로 변경

**통계 카드 구성**:
- 전체 역할 (primary)
- 활성 사용자 (success)
- 평균 권한 (warning)
- 커스텀 역할 (default)

### 3. 테넌트 관리 페이지 (manager-web)

**파일**: `apps/manager-web/src/app/(main)/tnnt/tenant/page.tsx`

**변경사항**:
- 구 레이아웃 → 새 레이아웃 + StatsCards
- 3컬럼 그리드 사용 (전체 테넌트, 활성 테넌트, 월 매출)
- 트렌드 정보 포함

**통계 카드 구성** (3 columns):
- 전체 테넌트 (primary, 트렌드: +20%)
- 활성 테넌트 (success)
- 월 매출 (warning, 트렌드: +15.3%)

### 4. 회사 관리 페이지 (tenants-web)

**파일**: `apps/tenants-web/src/app/(main)/adm/companies/page.tsx`

**특징**:
- 이미 조합 패턴으로 구현되어 있었음
- 데이터 테이블 컬럼 표준화 적용
- NO 컬럼 추가 (페이지네이션 인식)
- 액션 컬럼 표준화 (Edit2 + MoreVertical with Tooltips)

**통계 카드 구성**:
- 전체 회사 (primary)
- 활성 회사 (success)
- 총 직원 수 (primary)
- 비활성 회사 (warning)

**필터 구성**:
- 검색: 회사명, 코드, 사업자번호
- 상태: 전체/활성/비활성
- 업종: 전체/제조업/서비스업

## 데이터 테이블 표준화 적용

Companies 페이지의 데이터 테이블에 다음 표준화 적용:

### NO 컬럼 (첫 번째 컬럼)

```typescript
{
  id: "rowNumber",
  header: () => (
    <div className="text-center text-xs font-medium text-muted-foreground uppercase tracking-wider">
      NO
    </div>
  ),
  cell: ({ row, table }) => {
    const pageIndex = table.getState().pagination.pageIndex;
    const pageSize = table.getState().pagination.pageSize;
    const rowIndex = row.index;
    return (
      <div className="text-center text-sm font-medium text-foreground w-12">
        {pageIndex * pageSize + rowIndex + 1}
      </div>
    );
  },
  enableSorting: false,
  enableHiding: false,
}
```

### 액션 컬럼 표준화

**변경 전**:
```typescript
<Button variant="ghost" size="sm">
  <Edit className="h-4 w-4" />
</Button>
<Button variant="ghost" size="sm">
  <Trash2 className="h-4 w-4" />
</Button>
<Button variant="ghost" size="sm">
  <MoreVertical className="h-4 w-4" />
</Button>
```

**변경 후**:
```typescript
<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <Button variant="ghost" size="icon" className="h-8 w-8">
        <Edit2 className="h-4 w-4" />
      </Button>
    </TooltipTrigger>
    <TooltipContent><p>수정</p></TooltipContent>
  </Tooltip>
</TooltipProvider>

<DropdownMenu>
  <TooltipProvider>
    <Tooltip>
      <TooltipTrigger asChild>
        <DropdownMenuTrigger asChild>
          <Button variant="ghost" size="icon" className="h-8 w-8">
            <MoreVertical className="h-4 w-4" />
          </Button>
        </DropdownMenuTrigger>
      </TooltipTrigger>
      <TooltipContent><p>더보기</p></TooltipContent>
    </Tooltip>
  </TooltipProvider>
  <DropdownMenuContent align="end">
    <DropdownMenuItem>상세보기</DropdownMenuItem>
    <DropdownMenuItem className="text-destructive">삭제</DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>
```

### 색상 시스템 적용

모든 하드코딩된 색상을 Neutral + Violet 시스템으로 변경:

**변경 전**:
```typescript
<p className="text-sm font-medium text-gray-900 dark:text-white">
<p className="text-xs text-gray-500 dark:text-gray-400">
className="bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"
```

**변경 후**:
```typescript
<p className="text-sm font-medium text-foreground">
<p className="text-xs text-muted-foreground">
className="bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-800"
```

## 변경된 파일 목록

### 공통 컴포넌트 (manager-web)
1. `/apps/manager-web/src/components/layouts/list-page-layout.tsx` (생성)
2. `/apps/manager-web/src/components/stats/stats-cards.tsx` (생성)
3. `/apps/manager-web/src/components/stats/stats-card.tsx` (생성)
4. `/apps/manager-web/src/components/filters/list-filter.tsx` (생성)

### 공통 컴포넌트 (tenants-web)
5. `/apps/tenants-web/src/components/layouts/list-page-layout.tsx` (생성)
6. `/apps/tenants-web/src/components/stats/stats-cards.tsx` (생성)
7. `/apps/tenants-web/src/components/stats/stats-card.tsx` (생성)
8. `/apps/tenants-web/src/components/filters/list-filter.tsx` (생성)

### 페이지 리팩토링 (manager-web)
9. `/apps/manager-web/src/app/(main)/idam/users/page.tsx` (수정)
10. `/apps/manager-web/src/app/(main)/idam/roles/page.tsx` (수정)
11. `/apps/manager-web/src/app/(main)/tnnt/tenant/page.tsx` (수정)

### 페이지 리팩토링 (tenants-web)
12. `/apps/tenants-web/src/app/(main)/adm/companies/page.tsx` (수정)

## 패턴 적용 예시

### 기본 구조

```typescript
export default function MyPage() {
  // 1. 통계 데이터 정의
  const stats = [
    {
      title: "통계 제목",
      value: "100",
      description: "부가 설명",
      icon: <Icon className="h-5 w-5" />,
      color: "primary" as const,
      trend: { value: 10, isPositive: true },  // 선택적
    },
  ];

  // 2. 필터 필드 정의 (선택적)
  const filterFields: FilterField[] = [
    {
      name: "search",
      type: "text",
      placeholder: "검색어 입력",
    },
    {
      name: "status",
      type: "select",
      label: "상태",
      options: [
        { label: "전체", value: "" },
        { label: "활성", value: "active" },
      ],
    },
  ];

  // 3. 액션 버튼 정의
  const actions = (
    <>
      <Button variant="outline" onClick={handleRefresh}>
        <RefreshCw className="mr-2 h-4 w-4" />
        새로고침
      </Button>
      <Button onClick={handleAdd}>
        <Plus className="mr-2 h-4 w-4" />
        추가
      </Button>
    </>
  );

  return (
    <ListPageLayout
      title="페이지 제목"
      description="페이지 설명"
      actions={actions}
    >
      {/* 1. 통계 카드 */}
      <StatsCards cards={stats} columns={4} />

      {/* 2. 필터 (선택적) */}
      <ListFilter
        fields={filterFields}
        onFilter={(values) => setFilters(values)}
        onReset={() => setFilters({})}
      />

      {/* 3. 데이터 테이블 */}
      <MyTable />
    </ListPageLayout>
  );
}
```

### 유연한 레이아웃 조합

```typescript
// 예시 1: Stats만 사용
<ListPageLayout title="..." actions={...}>
  <StatsCards cards={stats} columns={3} />
  <MyTable />
</ListPageLayout>

// 예시 2: Filter만 사용
<ListPageLayout title="..." actions={...}>
  <ListFilter fields={fields} onFilter={...} onReset={...} />
  <MyTable />
</ListPageLayout>

// 예시 3: 모두 사용
<ListPageLayout title="..." actions={...}>
  <StatsCards cards={stats} columns={4} />
  <ListFilter fields={fields} onFilter={...} onReset={...} />
  <MyTable />
</ListPageLayout>

// 예시 4: Table만 사용
<ListPageLayout title="..." actions={...}>
  <MyTable />
</ListPageLayout>
```

## 이점

### 1. 유연성 (Flexibility)
- 페이지별로 필요한 컴포넌트만 조합 가능
- 컴포넌트 순서 자유롭게 변경
- 커스텀 컨텐츠 삽입 용이

### 2. 재사용성 (Reusability)
- 모든 목록 페이지에서 동일한 컴포넌트 사용
- 일관된 UI/UX 제공
- DRY 원칙 준수

### 3. 확장성 (Scalability)
- 새로운 컴포넌트 추가 용이
- 기존 컴포넌트 수정 시 영향 범위 제한적
- 타입 안정성 보장

### 4. 유지보수성 (Maintainability)
- 단일 책임 원칙으로 코드 이해 쉬움
- 컴포넌트별 독립적 테스트 가능
- 버그 수정 및 기능 추가 용이

## 향후 개선사항

### 1. 추가 필터 타입 구현
- `multiSelect`: 다중 선택
- `dateRange`: 날짜 범위
- `date`: 단일 날짜

### 2. 고급 통계 카드 기능
- 차트 통합 (Recharts)
- 클릭 이벤트 처리
- 애니메이션 효과

### 3. 레이아웃 변형
- GridPageLayout (카드 그리드 레이아웃)
- FormPageLayout (폼 페이지 레이아웃)
- DetailPageLayout (상세 페이지 레이아웃)

### 4. 접근성 개선
- ARIA 레이블 추가
- 키보드 네비게이션 향상
- 스크린 리더 지원

## 참고사항

### 설정 vs 조합 비교

**설정 기반 (Before)**:
```typescript
<ListPageLayout
  title="..."
  stats={statsConfig}  // 설정 객체 전달
  filter={filterConfig}  // 설정 객체 전달
>
  <Table />
</ListPageLayout>
```

**조합 기반 (After)**:
```typescript
<ListPageLayout title="...">
  <StatsCards cards={stats} />  // 컴포넌트 조합
  <ListFilter fields={fields} />  // 컴포넌트 조합
  <Table />
</ListPageLayout>
```

### 주요 차이점

| 측면 | 설정 기반 | 조합 기반 |
|------|----------|----------|
| 유연성 | 제한적 | 매우 높음 |
| 확장성 | 어려움 | 쉬움 |
| 타입 안정성 | 복잡 | 명확 |
| 코드 가독성 | 추상화 과다 | 직관적 |
| 커스터마이징 | 제한적 | 자유로움 |

## 관련 문서

- `/docs/guides/COMPONENT-COMPOSITION-GUIDE.md` - 컴포넌트 조합 패턴 가이드
- `/docs/implementation/manager-web/데이터테이블_표준화_20251018172245.md` - 데이터 테이블 표준화
- `/docs/implementation/shared/디자인시스템_neutral_violet_최종_20251018175237.md` - 색상 시스템
