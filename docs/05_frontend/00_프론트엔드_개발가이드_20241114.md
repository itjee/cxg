# CXG 플랫폼 - 프론트엔드 GraphQL 개발 완전가이드

> **Next.js와 React를 사용한 GraphQL 기반 프론트엔드 개발 완전 레퍼런스**
>
> - **대상 독자**: 프론트엔드 개발자, UI/UX 개발자
> - **통신 방식**: GraphQL with Apollo Client (REST API 제거)
> - **마지막 업데이트**: 2024년 11월 16일 (타입 중앙집중화 완료)
> - **상태**: ✅ 프로덕션 준비 완료

---

## 목차

1. [빠른 시작](#빠른-시작)
2. [개발 원칙](#개발-원칙)
3. [프로젝트 구조](#프로젝트-구조)
4. [IDAM Users 모듈 완전 가이드](#idam-users-모듈-완전-가이드)
5. [GraphQL & Apollo Client](#graphql--apollo-client)
6. [타입 정의 시스템](#타입-정의-시스템)
7. [데이터 흐름 상세 분석](#데이터-흐름-상세-분석)
8. [상태 관리](#상태-관리)
9. [에러 처리 전략](#에러-처리-전략)
10. [베스트 프랙티스](#베스트-프랙티스)
11. [체크리스트](#체크리스트)

---

## 빠른 시작

### 개발 환경 설정

```bash
cd apps/manager-web
pnpm install
pnpm dev  # http://localhost:8200
```

### 기술 스택

| 계층               | 기술            | 버전   | 목적                    |
| ------------------ | --------------- | ------ | ----------------------- |
| 프레임워크         | Next.js         | 15+    | 메타프레임워크, SSR/SSG |
| 언어               | TypeScript      | 5+     | 타입 안전성             |
| 런타임             | React           | 19+    | UI 라이브러리           |
| GraphQL 클라이언트 | Apollo Client   | 3.11+  | GraphQL API 통신        |
| 스타일             | Tailwind CSS    | v4     | 유틸리티 CSS            |
| UI 컴포넌트        | shadcn/ui       | Latest | 재사용 가능 컴포넌트    |
| 글로벌 상태        | Zustand         | Latest | UI 상태 관리            |
| 폼                 | React Hook Form | Latest | 폼 상태 관리            |
| 검증               | Zod             | Latest | 스키마 검증             |

---

## 개발 원칙

### 1. Feature-Driven Architecture (필수)

모든 기능은 독립적인 Feature 단위로 개발하며, 각 모듈은 동일한 구조를 유지합니다.

```
features/idam/users/                    # Users 엔티티 폴더
├── components/                          # ✅ UI 컴포넌트 (7개 필수)
│   ├── users-columns.tsx               # 테이블 컬럼 정의
│   ├── users-table.tsx                 # 테이블 컴포넌트
│   ├── users-edit.tsx                  # 생성/수정 모달
│   ├── users-form.tsx                  # 폼 컴포넌트
│   ├── users-header.tsx                # 헤더 (제목, 버튼)
│   ├── users-filters.tsx               # 필터 컴포넌트
│   ├── users-stats.tsx                 # 통계 카드
│   └── index.ts
│
├── graphql/                             # ✅ GraphQL 정의 (쿼리/뮤테이션만)
│   ├── queries.ts                      # GET_USERS, GET_USER
│   ├── mutations.ts                    # CREATE_USER, UPDATE_USER
│   └── index.ts                        # Export 쿼리/뮤테이션만
│
├── hooks/                               # ✅ Apollo Hooks + UI Logic
│   ├── use-users.ts                    # useUsers(), useCreateUser() 등
│   └── index.ts
│
├── types/                               # ✅ 타입 중앙 집중 (단일 소스)
│   ├── users.types.ts                  # User, Variables, Response 모두
│   └── index.ts
│
├── services/                            # (선택) Non-React 컨텍스트
│   ├── users.service.ts
│   └── index.ts
│
├── stores/                              # ✅ UI 상태 관리 (Zustand)
│   ├── users.store.ts
│   └── index.ts
│
└── index.ts                             # 공개 API (Feature Index)
```

### 2. 계층별 책임 (SoC - Separation of Concerns)

```
PAGE/COMPONENT
    ↓ (사용자 입력, 이벤트)
HOOK (useQuery/useMutation)
    ↓ (GraphQL 쿼리/뮤테이션 실행)
GRAPHQL (쿼리/뮤테이션 정의)
    ↓ (HTTP POST)
APOLLO CLIENT (캐싱, 네트워크 최적화)
    ↓ (HTTP)
BACKEND API (GraphQL Server)
    ↓ (데이터 조회/저장)
DATABASE (PostgreSQL)
```

### 3. 타입 정의 원칙

**단 하나의 소스 (Single Source of Truth)**

```
types/users.types.ts에서 모든 타입 정의:
├── User (엔티티)
├── CreateUserInput (입력)
├── UpdateUserInput (입력)
├── UsersQueryVariables (목록 쿼리 변수)
├── UserQueryVariables (단일 쿼리 변수)
├── CreateUserVariables (뮤테이션 변수)
├── UpdateUserVariables (뮤테이션 변수)
└── Response 타입들

graphql/에서는 타입 정의 NOT:
  ❌ graphql/queries.ts에서 타입 정의 금지
  ❌ graphql/mutations.ts에서 타입 정의 금지
  ✅ graphql/에서는 types.ts에서 임포트만
```

### 4. 일관성 우선 (Consistency First)

- **모든 모듈은 동일한 폴더 구조**
- **모든 타입은 types.ts에서 관리**
- **모든 GraphQL은 쿼리/뮤테이션만 정의**
- **모든 Hook은 types.ts에서 타입 임포트**

---

## 프로젝트 구조

### Manager Web 디렉토리 레이아웃

```
apps/manager-web/
├── src/
│   ├── app/                          # Next.js App Router
│   │   ├── (auth)/                  # 인증 라우트
│   │   │   ├── signin/
│   │   │   └── signup/
│   │   │
│   │   └── (main)/                  # 메인 애플리케이션
│   │       ├── dashboard/
│   │       │   └── page.tsx
│   │       │
│   │       ├── idam/                # IDAM 도메인
│   │       │   ├── users/           # 사용자 목록 페이지
│   │       │   │   └── page.tsx
│   │       │   ├── roles/           # 역할 목록 페이지
│   │       │   ├── api-keys/        # API 키 목록 페이지
│   │       │   ├── sessions/        # 세션 목록 페이지
│   │       │   ├── permissions/     # 권한 목록 페이지
│   │       │   └── login-logs/      # 로그인 기록 페이지
│   │       │
│   │       └── layout.tsx
│   │
│   ├── components/                  # 공통 컴포넌트
│   │   ├── ui/                     # shadcn/ui
│   │   └── layouts/                # 레이아웃
│   │
│   ├── features/                    # Feature 모듈 (도메인별)
│   │   ├── auth/                    # 인증
│   │   │
│   │   └── idam/                    # ID&Access Management
│   │       ├── users/               # 사용자 (✅ 완전한 구현)
│   │       │   ├── components/
│   │       │   ├── graphql/
│   │       │   ├── hooks/
│   │       │   ├── types/
│   │       │   ├── stores/
│   │       │   ├── services/
│   │       │   └── index.ts
│   │       │
│   │       ├── roles/               # 역할
│   │       ├── api-keys/            # API 키
│   │       ├── sessions/            # 세션
│   │       ├── permissions/         # 권한
│   │       ├── login-logs/          # 로그인 기록
│   │       │
│   │       └── index.ts
│   │
│   ├── lib/                         # 유틸리티 및 설정
│   │   ├── apollo-client.ts         # Apollo 설정
│   │   └── apollo-provider.tsx      # Apollo Provider
│   │
│   └── providers/                   # Context Providers
│       └── apollo-provider.tsx
│
└── IDAM_DATA_FLOW_MERMAID.md        # 데이터 흐름 Mermaid 다이어그램
```

---

## IDAM Users 모듈 완전 가이드

Users 모듈은 IDAM의 가장 완전한 구현 예시입니다. 다른 모듈(roles, api-keys 등)도 동일한 패턴을 따릅니다.

### 폴더 구조

```
features/idam/users/
├── components/
│   ├── users-columns.tsx      # 테이블 컬럼 (필수)
│   ├── users-table.tsx        # 테이블 (필수)
│   ├── users-edit.tsx         # 수정 모달 (필수)
│   ├── users-form.tsx         # 폼 (필수)
│   ├── users-header.tsx       # 헤더 (필수)
│   ├── users-filters.tsx      # 필터 (필수)
│   ├── users-stats.tsx        # 통계 (필수)
│   └── index.ts
│
├── graphql/
│   ├── queries.ts             # GET_USERS, GET_USER
│   ├── mutations.ts           # CREATE_USER, UPDATE_USER
│   └── index.ts
│
├── hooks/
│   ├── use-users.ts           # Apollo Hooks
│   └── index.ts
│
├── types/
│   ├── users.types.ts         # 모든 타입 정의 (중앙집중)
│   └── index.ts
│
├── stores/
│   ├── users.store.ts         # UI 상태 (Zustand)
│   └── index.ts
│
├── services/
│   ├── users.service.ts       # Non-React 호출용
│   └── index.ts
│
└── index.ts                   # 공개 API
```

### 1. 타입 정의 (types/users.types.ts)

**원칙: 모든 타입을 여기서 관리합니다**

```typescript
/**
 * 사용자 GraphQL 타입 정의 (camelCase - GraphQL 네이티브)
 * 단일 소스: types.ts에서만 정의, graphql/에서는 임포트만 함
 */

// ===== 엔티티 타입 =====

export interface User {
  id: string;
  userType: "MASTER" | "TENANT" | "SYSTEM";
  fullName: string;
  email: string;
  phone?: string;
  username: string;
  ssoProvider?: string;
  mfaEnabled: boolean;
  status: "ACTIVE" | "INACTIVE" | "LOCKED" | "SUSPENDED";
  lastLoginAt?: string;
  failedLoginAttempts: number;
  timezone: string;
  locale: string;
  department?: string;
  position?: string;
  createdAt: string;
  updatedAt: string;
}

// ===== 입력 타입 (Input) =====

export interface CreateUserInput {
  userType: string;
  fullName: string;
  email: string;
  username: string;
  password: string;
  phone?: string;
  department?: string;
  position?: string;
}

export interface UpdateUserInput {
  fullName?: string;
  email?: string;
  phone?: string;
  department?: string;
  position?: string;
  status?: string;
  mfaEnabled?: boolean;
}

// ===== 쿼리 변수 타입 =====

/**
 * 사용자 목록 조회 파라미터 (복수형)
 * GET_USERS 쿼리에서 사용
 */
export interface UsersQueryVariables {
  limit?: number;
  offset?: number;
  userType?: string;
  status?: string;
}

/**
 * 사용자 단일 조회 파라미터 (단수형)
 * GET_USER 쿼리에서 사용
 */
export interface UserQueryVariables {
  id: string;
}

// ===== 뮤테이션 변수 타입 =====

export interface CreateUserVariables {
  input: CreateUserInput;
}

export interface UpdateUserVariables {
  id: string;
  input: UpdateUserInput;
}

// ===== GraphQL 응답 타입 =====

export interface GetUsersResponse {
  users: User[];
}

export interface GetUserResponse {
  user: User;
}

export interface CreateUserResponse {
  createUser: User;
}

export interface UpdateUserResponse {
  updateUser: User;
}
```

### 2. GraphQL 쿼리 정의 (graphql/queries.ts)

**원칙: 쿼리 정의만, 타입은 types.ts에서 임포트**

```typescript
import { gql } from "@apollo/client";
import type { UsersQueryVariables, UserQueryVariables } from "../types/users.types";

/**
 * 사용자 목록 조회 (복수)
 */
export const GET_USERS = gql`
  query GetUsers(
    $limit: Int
    $offset: Int
    $userType: String
    $status: String
  ) {
    users(
      limit: $limit
      offset: $offset
      userType: $userType
      status: $status
    ) {
      id
      userType
      fullName
      email
      status
      createdAt
      updatedAt
    }
  }
`;

/**
 * 사용자 상세 조회 (단수)
 */
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      userType
      fullName
      email
      phone
      username
      status
      createdAt
      updatedAt
    }
  }
`;
```

**주의: 타입 정의는 여기서 하지 않음** ✅

### 3. GraphQL 뮤테이션 정의 (graphql/mutations.ts)

```typescript
import { gql } from "@apollo/client";
import type {
  CreateUserInput,
  UpdateUserInput,
  CreateUserVariables,
  UpdateUserVariables,
} from "../types/users.types";

export const CREATE_USER = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id
      userType
      fullName
      email
      status
      createdAt
    }
  }
`;

export const UPDATE_USER = gql`
  mutation UpdateUser($id: ID!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      id
      userType
      fullName
      email
      status
      updatedAt
    }
  }
`;
```

### 4. GraphQL 인덱스 (graphql/index.ts)

**원칙: 쿼리/뮤테이션만 export, 타입은 절대 export 하지 않음**

```typescript
/**
 * ⚠️ 타입 정의는 ../types/users.types.ts에서 관리됩니다
 * 타입을 사용할 때는 반드시 types.ts에서 직접 임포트하세요
 */

export { GET_USERS, GET_USER } from "./queries";
export { CREATE_USER, UPDATE_USER } from "./mutations";
```

### 5. Apollo Hooks (hooks/use-users.ts)

```typescript
import { useQuery, useMutation } from "@apollo/client";
import { GET_USERS, GET_USER, CREATE_USER, UPDATE_USER } from "../graphql";
import type {
  User,
  UsersQueryVariables,
  UserQueryVariables,
  CreateUserVariables,
  UpdateUserVariables,
  GetUsersResponse,
  GetUserResponse,
  CreateUserResponse,
  UpdateUserResponse,
} from "../types/users.types";

// ========== useQuery Hooks (조회) ==========

/**
 * 사용자 목록 조회
 * @param variables - { limit, offset, userType, status }
 * @returns { data.users, loading, error, refetch }
 */
export function useUsers(variables?: UsersQueryVariables) {
  return useQuery<GetUsersResponse, UsersQueryVariables>(GET_USERS, {
    variables: {
      limit: 20,
      offset: 0,
      ...variables,
    },
    fetchPolicy: "cache-and-network",
  });
}

/**
 * 사용자 상세 조회
 */
export function useUser(id: string) {
  return useQuery<GetUserResponse, UserQueryVariables>(GET_USER, {
    variables: { id },
    skip: !id,
  });
}

// ========== useMutation Hooks (생성/수정) ==========

/**
 * 사용자 생성
 */
export function useCreateUser() {
  return useMutation<CreateUserResponse, Error, CreateUserVariables>(
    CREATE_USER,
    {
      refetchQueries: [
        {
          query: GET_USERS,
          variables: { limit: 20, offset: 0 },
        },
      ],
    }
  );
}

/**
 * 사용자 수정
 */
export function useUpdateUser() {
  return useMutation<UpdateUserResponse, Error, UpdateUserVariables>(
    UPDATE_USER
  );
}
```

**중요: 타입을 어디서 임포트하나?**
```typescript
// ✅ 올바른 방법
import type {
  User,
  UsersQueryVariables,
  CreateUserVariables,
} from "../types/users.types";

// ❌ 잘못된 방법 (graphql/index.ts에서 타입을 export 하지 않음)
import type { UsersQueryVariables } from "../graphql";  // 불가능!
```

### 6. 페이지에서 사용 (app/(main)/idam/users/page.tsx)

```typescript
"use client";

import { toast } from "sonner";
import { useUsers, useCreateUser, useUpdateUser } from "@/features/idam/users/hooks";
import {
  UsersTable,
  UsersHeader,
  UsersFilters,
  UsersStats,
} from "@/features/idam/users/components";
import { useUsersStore } from "@/features/idam/users/stores";

export default function UsersPage() {
  // 1. UI 상태 (Zustand Store)
  const { currentPage, itemsPerPage, selectedStatus } = useUsersStore();

  // 2. GraphQL 쿼리 (Apollo useQuery)
  const {
    data: usersResponse,
    loading,
    error,
    refetch,
  } = useUsers({
    limit: itemsPerPage,
    offset: currentPage * itemsPerPage,
    status: selectedStatus,
  });

  // 3. GraphQL 뮤테이션 (Apollo useMutation)
  const [createUser, { loading: creating }] = useCreateUser();

  // 4. 데이터 처리
  const users = usersResponse?.users || [];

  // 5. 이벤트 핸들러
  const handleCreate = async (input: CreateUserInput) => {
    try {
      await createUser({
        variables: { input },
      });
      toast.success("사용자가 생성되었습니다");
      refetch();
    } catch (err) {
      toast.error("생성 실패");
    }
  };

  return (
    <div className="space-y-6 p-6">
      <UsersHeader onRefresh={() => refetch()} />
      <UsersStats total={users.length} />
      <UsersFilters />
      <UsersTable data={users} isLoading={loading || creating} />
    </div>
  );
}
```

---

## GraphQL & Apollo Client

### 1. Apollo Client 설정 (lib/apollo-client.ts)

```typescript
import { ApolloClient, InMemoryCache, HttpLink, from } from "@apollo/client";
import { onError } from "@apollo/client/link/error";
import { setContext } from "@apollo/client/link/context";

const GRAPHQL_ENDPOINT =
  process.env.NEXT_PUBLIC_GRAPHQL_URL || "http://localhost:8100/graphql";

// 1️⃣ 인증 Link
const authLink = setContext((_, { headers }) => {
  let token: string | null = null;

  if (typeof window !== "undefined") {
    token = localStorage.getItem("access_token");
    if (!token) {
      token = document.cookie
        .split("; ")
        .find((row) => row.startsWith("access_token="))
        ?.split("=")[1] ?? null;
    }
  }

  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
    },
  };
});

// 2️⃣ 에러 처리 Link
const errorLink = onError(({ graphQLErrors, networkError }) => {
  if (graphQLErrors) {
    graphQLErrors.forEach(({ message, extensions }) => {
      if (
        extensions?.code === "UNAUTHENTICATED" ||
        extensions?.code === "AUTHENTICATION_REQUIRED"
      ) {
        if (typeof window !== "undefined") {
          localStorage.removeItem("access_token");
          window.location.href = "/signin";
        }
      }
    });
  }

  if (networkError) {
    console.error(`Network Error:`, networkError);
  }
});

// 3️⃣ HTTP Link
const httpLink = new HttpLink({
  uri: GRAPHQL_ENDPOINT,
  credentials: "include",
});

// 4️⃣ Apollo Client
export const apolloClient = new ApolloClient({
  link: from([errorLink, authLink, httpLink]),
  cache: new InMemoryCache(),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: "cache-and-network",
    },
    query: {
      fetchPolicy: "network-only",
    },
  },
});
```

### 2. Apollo Provider (lib/apollo-provider.tsx)

```typescript
"use client";

import { ApolloProvider as Provider } from "@apollo/client";
import { apolloClient } from "./apollo-client";

interface ApolloProviderProps {
  children: React.ReactNode;
}

export function ApolloProvider({ children }: ApolloProviderProps) {
  return <Provider client={apolloClient}>{children}</Provider>;
}
```

### 3. 앱 레이아웃에서 Apollo 적용 (app/layout.tsx)

```typescript
import { ApolloProvider } from "@/lib/apollo-provider";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ko">
      <body>
        <ApolloProvider>{children}</ApolloProvider>
      </body>
    </html>
  );
}
```

---

## 타입 정의 시스템

### 원칙: 단일 소스 (Single Source of Truth)

모든 타입 정의는 **types/module.types.ts 파일 하나**에서만 관리됩니다.

```
types/users.types.ts는 다음을 모두 포함합니다:
├── 엔티티 (User)
├── 입력 (CreateUserInput, UpdateUserInput)
├── 쿼리 변수 (UsersQueryVariables, UserQueryVariables)
├── 뮤테이션 변수 (CreateUserVariables, UpdateUserVariables)
└── 응답 (GetUsersResponse, GetUserResponse, ...)

graphql/queries.ts 또는 mutations.ts에서:
├── ✅ types.ts에서 타입 임포트 가능
└── ❌ 새로운 타입 정의 금지
```

### 타입 명명 규칙

```typescript
// 엔티티 (단수형)
export interface User { ... }
export interface Role { ... }
export interface Permission { ... }

// 입력 (단수형, Input suffix)
export interface CreateUserInput { ... }
export interface UpdateUserInput { ... }
export interface CreateRoleInput { ... }

// 쿼리 변수 (복수형 = 목록, 단수형 = 단일)
export interface UsersQueryVariables { ... }        // 목록 조회
export interface UserQueryVariables { ... }         // 단일 조회
export interface RolesQueryVariables { ... }
export interface RoleQueryVariables { ... }

// 뮤테이션 변수 (단수형, Variables suffix)
export interface CreateUserVariables { ... }
export interface UpdateUserVariables { ... }
export interface DeleteUserVariables { ... }

// 응답 (Response suffix, camelCase)
export interface GetUsersResponse { ... }
export interface GetUserResponse { ... }
export interface CreateUserResponse { ... }
```

---

## 데이터 흐름 상세 분석

### 시나리오 1: 사용자 목록 조회

```
1️⃣ PAGE (app/(main)/idam/users/page.tsx)
   └─ useUsers({ limit: 20, offset: 0 })

2️⃣ HOOK (hooks/use-users.ts)
   └─ useQuery<GetUsersResponse, UsersQueryVariables>(GET_USERS, ...)

3️⃣ GRAPHQL (graphql/queries.ts)
   └─ GET_USERS = gql`query GetUsers($limit: Int, ...) { ... }`

4️⃣ APOLLO CLIENT
   └─ HTTP POST to /graphql
      Request: { operationName: "GetUsers", variables: { ... } }

5️⃣ BACKEND (Python Strawberry)
   └─ users(limit, offset) → ManagerUser[]

6️⃣ DATABASE
   └─ SELECT * FROM manager_users LIMIT 20 OFFSET 0

7️⃣ RESPONSE (역순)
   └─ users: [ { id, userType, fullName, ... } ]

8️⃣ HOOK
   └─ data: { users: User[] }

9️⃣ PAGE
   └─ <UsersTable data={users} />
```

### 타입 변환 흐름

```
Frontend (camelCase)
├─ UsersQueryVariables: { limit: 20, offset: 0 }
├─ User: { id, userType, fullName, ... }

GraphQL (camelCase - 네이티브)
├─ query GetUsers($limit: Int, $offset: Int)
├─ users: [ { id, userType, fullName } ]

Backend (Python snake_case)
├─ user_type, full_name, created_at
├─ Strawberry 자동 변환: user_type → userType

Database (snake_case)
├─ user_type, full_name, created_at
```

---

## 상태 관리

### Zustand Store (UI 상태 분리)

**원칙: 서버 상태(API 데이터)는 Apollo에서, UI 상태(필터, 페이지)는 Zustand에서 관리**

```typescript
// features/idam/users/stores/users.store.ts
import { create } from "zustand";

interface UsersStoreState {
  // UI 상태
  currentPage: number;
  itemsPerPage: number;
  selectedStatus: string | null;
  searchQuery: string;

  // Actions
  setCurrentPage: (page: number) => void;
  setItemsPerPage: (size: number) => void;
  setSelectedStatus: (status: string | null) => void;
  setSearchQuery: (query: string) => void;
}

export const useUsersStore = create<UsersStoreState>((set) => ({
  // 초기 상태
  currentPage: 0,
  itemsPerPage: 20,
  selectedStatus: null,
  searchQuery: "",

  // Actions
  setCurrentPage: (page) => set({ currentPage: page }),
  setItemsPerPage: (size) => set({ itemsPerPage: size }),
  setSelectedStatus: (status) => set({ selectedStatus: status }),
  setSearchQuery: (query) => set({ searchQuery: query }),
}));
```

**페이지에서 사용:**

```typescript
const { currentPage, itemsPerPage, selectedStatus } = useUsersStore();

const { data } = useUsers({
  limit: itemsPerPage,
  offset: currentPage * itemsPerPage,
  status: selectedStatus,
});
```

---

## 에러 처리 전략

```typescript
const { data, loading, error } = useUsers();

if (error) {
  // GraphQL 에러
  if (error.graphQLErrors && error.graphQLErrors.length > 0) {
    error.graphQLErrors.forEach(({ message, extensions }) => {
      console.error(`[${extensions?.code}] ${message}`);

      if (extensions?.code === "AUTHENTICATION_REQUIRED") {
        window.location.href = "/signin";
      } else if (extensions?.code === "FORBIDDEN") {
        toast.error("권한이 없습니다");
      } else {
        toast.error(message);
      }
    });
  }

  // 네트워크 에러
  if (error.networkError) {
    toast.error("네트워크 연결 실패");
  }
}
```

---

## 베스트 프랙티스

### 1. ✅ 타입 임포트 위치

```typescript
// ✅ 올바름: types.ts에서만 임포트
import type {
  User,
  UsersQueryVariables,
  CreateUserVariables,
} from "../types/users.types";

import { GET_USERS, CREATE_USER } from "../graphql";

// ❌ 틀림: graphql/index.ts에서 타입 임포트
import type { UsersQueryVariables } from "../graphql";  // 불가능!
```

### 2. ✅ GraphQL 쿼리 최적화

```typescript
// ❌ 나쁨: 불필요한 필드
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      fullName
      email
      phone
      ssoProvider
      timezone
      locale
      # ... 모든 필드
    }
  }
`;

// ✅ 좋음: 필요한 필드만
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      fullName
      email
      status
      createdAt
    }
  }
`;
```

### 3. ✅ Hook 사용 규칙

```typescript
// ✅ 권장: 컴포넌트에서 Hook 사용
function UsersPage() {
  const { data } = useUsers();
}

// ⚠️ Non-React 컨텍스트: Service 사용
// (API Routes, Utils 등에서만)
import { usersService } from "./services/users.service";
const users = await usersService.listUsers();
```

### 4. ✅ 에러 메시지

```typescript
// ❌ 나쁨: 기술적 에러 노출
toast.error(`GraphQL Error: ${error.message}`);

// ✅ 좋음: 사용자 친화적 메시지
toast.error("사용자 생성에 실패했습니다. 다시 시도해주세요.");
```

### 5. ✅ 캐시 무효화

```typescript
// refetchQueries를 사용해 관련 쿼리 자동 갱신
const [createUser] = useCreateUser();

await createUser({
  variables: { input },
  refetchQueries: [
    {
      query: GET_USERS,
      variables: { limit: 20, offset: 0 },
    },
  ],
});
```

---

## 체크리스트

### 새로운 Entity 개발 체크리스트

- [ ] Feature 폴더 생성 (`features/idam/[entity]/`)
- [ ] **types/[entity].types.ts** - 모든 타입 정의
  - [ ] Entity 인터페이스
  - [ ] Input 인터페이스
  - [ ] QueryVariables 인터페이스
  - [ ] Mutation Variables 인터페이스
  - [ ] Response 인터페이스
- [ ] **graphql/queries.ts** - 쿼리 정의 (types.ts에서 임포트)
- [ ] **graphql/mutations.ts** - 뮤테이션 정의 (types.ts에서 임포트)
- [ ] **graphql/index.ts** - 쿼리/뮤테이션만 export
- [ ] **hooks/use-[entity].ts** - Apollo Hooks
  - [ ] useQuery Hooks
  - [ ] useMutation Hooks
- [ ] **components/** - 7개 필수 컴포넌트
  - [ ] [entity]-columns.tsx
  - [ ] [entity]-table.tsx
  - [ ] [entity]-edit.tsx
  - [ ] [entity]-form.tsx
  - [ ] [entity]-header.tsx
  - [ ] [entity]-filters.tsx
  - [ ] [entity]-stats.tsx
- [ ] **stores/[entity].store.ts** - UI 상태 (Zustand)
- [ ] **services/[entity].service.ts** - Non-React 호출용 (선택)
- [ ] **index.ts** - 공개 API 정의

### GraphQL 쿼리 검증

- [ ] 필요한 필드만 요청하는가?
- [ ] 타입이 types.ts와 일치하는가?
- [ ] 모든 변수에 타입이 지정되어 있는가?
- [ ] 에러 처리가 구현되어 있는가?
- [ ] 캐시 정책이 설정되어 있는가?

### 타입 안전성 검증

- [ ] types.ts에서만 타입을 정의하는가?
- [ ] graphql/에서 타입을 export하지 않는가?
- [ ] 모든 Hook이 types.ts에서 타입을 임포트하는가?
- [ ] `any` 타입을 사용하지 않는가?
- [ ] 응답 타입(Response)을 정의했는가?

---

## 참고 자료

- **내부 문서**: `/docs/IDAM_DATA_FLOW_MERMAID.md` - Mermaid 다이어그램
- [Apollo Client 공식 문서](https://www.apollographql.com/docs/react/)
- [GraphQL 공식 사이트](https://graphql.org/)
- [Next.js 공식 문서](https://nextjs.org/docs)
- [Zustand 공식 문서](https://github.com/pmndrs/zustand)

---

**버전**: 3.0 (타입 중앙집중화 완료)
**마지막 업데이트**: 2024년 11월 16일
**상태**: ✅ 프로덕션 준비 완료
