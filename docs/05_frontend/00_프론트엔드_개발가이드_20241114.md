# CXG 플랫폼 - 프론트엔드 개발 완전가이드 (GraphQL 전용)

> **Next.js와 React를 사용한 프론트엔드 개발 완전 레퍼런스**
>
> - **대상 독자**: 프론트엔드 개발자, UI/UX 개발자
> - **읽는 시간**: 2-3시간
> - **마지막 업데이트**: 2024년 11월 14일 (GraphQL 최적화 완료)
> - **통신 방식**: GraphQL with Apollo Client (REST API 제거)

---

## 목차

1. [빠른 시작](#빠른-시작)
2. [개발 원칙](#개발-원칙)
3. [프로젝트 구조](#프로젝트-구조)
4. [Shared Module (공통 코드)](#shared-module-공통-코드)
5. [필수 7개 컴포넌트 패턴](#필수-7개-컴포넌트-패턴)
6. [컴포넌트 개발 상세 가이드](#컴포넌트-개발-상세-가이드)
7. [상태 관리](#상태-관리)
8. [타입 정의 상세 가이드 (DTO 패턴)](#타입-정의-상세-가이드-dto-패턴)
9. [GraphQL & Apollo Client](#graphql--apollo-client)
10. [Zustand Store (UI 상태 분리)](#zustand-store-ui-상태-분리)
11. [에러 처리 전략](#에러-처리-전략)
12. [Feature Index (공개 API 패턴)](#feature-index-공개-api-패턴)
13. [목록 페이지 구성](#목록-페이지-구성)
14. [인증 시스템 (GraphQL 기반)](#인증-시스템-graphql-기반)
15. [스타일링 시스템](#스타일링-시스템)
16. [베스트 프랙티스](#베스트-프랙티스)
17. [체크리스트](#체크리스트)

---

## 빠른 시작

### 개발 환경 설정

```bash
cd apps/manager-web
pnpm install
pnpm dev  # http://localhost:8200
```

### 기술 스택

| 계층               | 기술            | 버전   | 목적                    |
| ------------------ | --------------- | ------ | ----------------------- |
| 프레임워크         | Next.js         | 15+    | 메타프레임워크, SSR/SSG |
| 언어               | TypeScript      | 5+     | 타입 안전성             |
| 런타임             | React           | 19+    | UI 라이브러리           |
| GraphQL 클라이언트 | Apollo Client   | 3.11+  | GraphQL API 통신        |
| 스타일             | Tailwind CSS    | v4     | 유틸리티 CSS            |
| UI 컴포넌트        | shadcn/ui       | Latest | 재사용 가능 컴포넌트    |
| 글로벌 상태        | Zustand         | Latest | UI 상태 관리            |
| 폼                 | React Hook Form | Latest | 폼 상태 관리            |
| 검증               | Zod             | Latest | 스키마 검증             |

---

## 개발 원칙

### 1. Feature-Driven Architecture (필수)

모든 기능은 독립적인 Feature 단위로 개발합니다.

```
features/
└── [domain]/           # 도메인별 feature
    ├── components/     # UI 컴포넌트 (7개 필수 컴포넌트)
    ├── graphql/        # ✨ GraphQL 쿼리/뮤테이션 (Feature별)
    ├── hooks/          # Apollo Client Hooks + UI Logic Hooks
    ├── services/       # GraphQL 서비스 (선택)
    ├── stores/         # Zustand 스토어 (UI 상태)
    ├── types/          # TypeScript 타입 (GraphQL 네이티브)
    └── index.ts        # Public exports
```

### 2. 관심사의 분리 (Separation of Concerns)

```
Page (라우팅)
    ↓
Component (UI 렌더링)
    ↓
Hook (로직 재사용)
    ↓
Store (UI 상태 관리)
    ↓
GraphQL (API 통신)
    ↓
Apollo Client (캐싱, 네트워크)
```

### 3. 일관성 우선 (Consistency First)

- **모든 목록 페이지는 동일한 구조** 유지
- **모든 테이블은 columns + table 분리**
- **7개 필수 컴포넌트 준수** (예외 없음)
- **GraphQL 쿼리/뮤테이션 표준 패턴 적용**

### 4. 타입 안전성 (Type Safety)

```typescript
// ✅ 필수
- TypeScript strict 모드
- any 타입 사용 금지
- 모든 함수에 명시적 타입 지정
- GraphQL 응답 타입 정의

// ❌ 금지
function handleClick(e: any) {}  // ❌ any 사용
const data = await graphQLQuery();  // ❌ 타입 미지정
```

---

## 프로젝트 구조

### 완전한 디렉토리 레이아웃

```
apps/manager-web/
├── src/
│   ├── app/                          # Next.js App Router
│   │   ├── (auth)/                  # 인증 라우트 그룹
│   │   │   ├── signin/
│   │   │   │   └── page.tsx
│   │   │   └── signup/
│   │   │       └── page.tsx
│   │   │
│   │   └── (main)/                  # 메인 애플리케이션 라우트 그룹
│   │       ├── dashboard/
│   │       │   └── page.tsx
│   │       ├── [schema]/            # 비즈니스 도메인 (tnnt, bill, idam, etc)
│   │       │   ├── [entity]/
│   │       │   │   ├── page.tsx     # 목록 페이지
│   │       │   │   ├── [id]/
│   │       │   │   │   └── page.tsx # 상세/수정 페이지
│   │       │   │   └── create/
│   │       │   │       └── page.tsx # 생성 페이지
│   │       │   └── layout.tsx
│   │       ├── api/                 # Next.js API 라우트 (webhook 등)
│   │       ├── layout.tsx
│   │       └── page.tsx             # 홈 페이지
│   │
│   ├── components/                  # 공통 컴포넌트
│   │   ├── ui/                     # shadcn/ui 컴포넌트
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   ├── dialog.tsx
│   │   │   └── ...
│   │   │
│   │   ├── layouts/                # 레이아웃 컴포넌트
│   │   │   ├── list-page-layout.tsx
│   │   │   ├── detail-page-layout.tsx
│   │   │   ├── app-layout.tsx
│   │   │   └── sidebar.tsx
│   │   │
│   │   ├── data-table/             # 데이터 테이블
│   │   │   ├── data-table.tsx
│   │   │   ├── data-table-header.tsx
│   │   │   ├── data-table-row.tsx
│   │   │   └── data-table-pagination.tsx
│   │   │
│   │   ├── filters/                # 필터 컴포넌트
│   │   │   ├── list-filter.tsx
│   │   │   ├── filter-field.tsx
│   │   │   └── filter-presets.tsx
│   │   │
│   │   └── stats/                  # 통계 카드
│   │       ├── stats-cards.tsx
│   │       └── stats-card.tsx
│   │
│   ├── features/                    # Feature 모듈 (도메인별)
│   │   ├── auth/                    # 인증 feature
│   │   │   ├── components/
│   │   │   │   ├── signin-form.tsx
│   │   │   │   ├── signup-form.tsx
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── graphql/            # GraphQL 뮤테이션
│   │   │   │   ├── mutations.ts
│   │   │   │   ├── queries.ts
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── hooks/
│   │   │   │   ├── use-auth.ts      # UI Logic + Apollo Hooks
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── services/
│   │   │   │   ├── auth.service.ts  # GraphQL 통신 계층
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── stores/
│   │   │   │   ├── auth.store.ts    # 글로벌 인증 상태
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── types/
│   │   │   │   ├── auth.types.ts    # GraphQL 네이티브 타입
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── providers/
│   │   │   │   └── auth-provider.tsx
│   │   │   │
│   │   │   └── index.ts
│   │   │
│   │   ├── tnnt/                    # 테넌트 도메인
│   │   │   ├── tenants/            # 테넌트 엔티티
│   │   │   │   ├── components/
│   │   │   │   │   ├── tenants-columns.tsx      # 테이블 컬럼 (필수)
│   │   │   │   │   ├── tenants-table.tsx        # 테이블 (필수)
│   │   │   │   │   ├── tenants-edit.tsx         # 수정 모달 (필수)
│   │   │   │   │   ├── tenants-form.tsx         # 폼 (필수)
│   │   │   │   │   ├── tenants-header.tsx       # 헤더 (필수)
│   │   │   │   │   ├── tenants-filters.tsx      # 필터 (필수)
│   │   │   │   │   ├── tenants-stats.tsx        # 통계 (필수)
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   ├── graphql/              # ✨ GraphQL 쿼리/뮤테이션
│   │   │   │   │   ├── queries.ts         # Tenants 조회 쿼리
│   │   │   │   │   ├── mutations.ts       # Tenants 생성/수정/삭제 뮤테이션
│   │   │   │   │   ├── fragments.ts       # Tenants Fragment (선택)
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   ├── hooks/
│   │   │   │   │   ├── use-tenants.ts    # GraphQL Hooks
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   ├── services/
│   │   │   │   │   ├── tenants.service.ts
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   ├── stores/
│   │   │   │   │   ├── tenants.store.ts   # UI 상태 분리
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   ├── types/
│   │   │   │   │   ├── tenants.types.ts   # GraphQL 타입
│   │   │   │   │   └── index.ts
│   │   │   │   │
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── subscriptions/       # 구독 엔티티 (동일한 구조)
│   │   │   ├── tenant-roles/        # 테넌트 역할 (동일한 구조)
│   │   │   ├── tenant-users/        # 테넌트 사용자 (동일한 구조)
│   │   │   └── index.ts             # tnnt 도메인 공개 API
│   │   │
│   │   ├── bill/                    # 청구 도메인 (동일한 구조)
│   │   ├── idam/                    # ID & Access 도메인 (동일한 구조)
│   │   └── ...
│   │
│   ├── shared/                       # ✨ 공통 코드 (Shared Module)
│   │   ├── hooks/
│   │   │   ├── ui/
│   │   │   │   ├── use-theme.ts
│   │   │   │   ├── use-toast.ts
│   │   │   │   └── index.ts
│   │   │   ├── auth/                # 인증 훅
│   │   │   │   └── index.ts
│   │   │   └── index.ts
│   │   │
│   │   ├── stores/
│   │   │   ├── theme.store.ts
│   │   │   └── index.ts
│   │   │
│   │   ├── types/
│   │   │   ├── api/
│   │   │   │   ├── graphql.types.ts # GraphQL 공통 타입
│   │   │   │   └── index.ts
│   │   │   ├── domain/
│   │   │   │   ├── common.types.ts
│   │   │   │   └── index.ts
│   │   │   └── index.ts
│   │   │
│   │   └── index.ts
│   │
│   ├── lib/                          # 유틸리티 및 설정
│   │   ├── apollo-client.ts         # ✨ Apollo Client 설정
│   │   ├── apollo-provider.tsx      # ✨ Apollo Provider
│   │   │
│   │   ├── graphql/                 # ✨ GraphQL 공통 요소
│   │   │   ├── fragments/           # 공통 Fragment
│   │   │   │   ├── common.ts        # TimestampFields, PaginationInfo
│   │   │   │   └── index.ts
│   │   │   └── types/               # GraphQL 공통 타입
│   │   │       └── common.types.ts
│   │   │
│   │   ├── errors.ts                # GraphQL 에러 처리
│   │   ├── utils.ts                 # 유틸리티 함수
│   │   └── constants.ts             # 상수
│   │
│   ├── providers/                    # Context Providers
│   │   ├── apollo-provider.tsx      # Apollo Provider
│   │   ├── theme-provider.tsx
│   │   └── index.ts
│   │
│   ├── styles/                       # 전역 스타일
│   │   ├── globals.css
│   │   └── variables.css
│   │
│   └── middleware.ts                 # Next.js 미들웨어
│
├── public/                           # 정적 파일
├── .env.local                        # 환경 변수
├── next.config.ts                    # Next.js 설정
└── package.json
```

---

## GraphQL & Apollo Client

### 개요

CXG 플랫폼은 **Apollo Client**를 사용하여 GraphQL API와 통신합니다. 모든 데이터 통신은 GraphQL을 통해서만 이루어지며, REST API는 사용하지 않습니다.

**핵심 원칙**:

- ✅ 모든 API 통신은 GraphQL 사용
- ✅ GraphQL 쿼리/뮤테이션은 Feature 내부에서 관리
- ✅ 공통 요소(Fragment, 타입)만 `lib/graphql`에서 관리
- ✅ Apollo Client가 모든 캐싱 담당

### 1. Apollo Client 설정

**파일**: `lib/apollo-client.ts`

```typescript
import { ApolloClient, InMemoryCache, HttpLink, from } from "@apollo/client";
import { onError } from "@apollo/client/link/error";
import { setContext } from "@apollo/client/link/context";

const GRAPHQL_ENDPOINT =
  process.env.NEXT_PUBLIC_GRAPHQL_URL || "http://localhost:8100/graphql";

// 1️⃣ 인증 Link - JWT 토큰 자동 추가
const authLink = setContext((_, { headers }) => {
  let token: string | null = null;

  if (typeof window !== "undefined") {
    // localStorage에서 먼저 확인
    token = localStorage.getItem("access_token");

    // 없으면 쿠키에서 확인
    if (!token) {
      token =
        document.cookie
          .split("; ")
          .find((row) => row.startsWith("access_token="))
          ?.split("=")[1] ?? null;
    }
  }

  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
    },
  };
});

// 2️⃣ 에러 처리 Link
const errorLink = onError(({ graphQLErrors, networkError }) => {
  // GraphQL 에러 처리
  if (graphQLErrors) {
    graphQLErrors.forEach(({ message, extensions }) => {
      console.error(`GraphQL Error: ${message}`);

      // 인증 에러 처리
      if (
        extensions?.code === "UNAUTHENTICATED" ||
        extensions?.code === "AUTHENTICATION_REQUIRED"
      ) {
        if (typeof window !== "undefined") {
          localStorage.removeItem("access_token");
          localStorage.removeItem("refresh_token");
          window.location.href = "/signin";
        }
      }
    });
  }

  // 네트워크 에러 처리
  if (networkError) {
    console.error(`Network Error: ${networkError}`);
  }
});

// 3️⃣ HTTP Link
const httpLink = new HttpLink({
  uri: GRAPHQL_ENDPOINT,
  credentials: "include", // 쿠키 포함
});

// 4️⃣ Apollo Client 인스턴스
export const apolloClient = new ApolloClient({
  link: from([errorLink, authLink, httpLink]),
  cache: new InMemoryCache({
    typePolicies: {
      Query: {
        fields: {
          // 캐시 정책 설정 (필요시)
          managerUsers: {
            keyArgs: ["userType", "status"],
            merge(existing = [], incoming) {
              return incoming;
            },
          },
        },
      },
    },
  }),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: "cache-and-network",
    },
    query: {
      fetchPolicy: "network-only",
    },
  },
  connectToDevTools: process.env.NODE_ENV === "development",
});
```

### 2. Apollo Provider 설정

**파일**: `lib/apollo-provider.tsx`

```typescript
"use client";

import { ApolloProvider as Provider } from "@apollo/client";
import { apolloClient } from "./apollo-client";

interface ApolloProviderProps {
  children: React.ReactNode;
}

export function ApolloProvider({ children }: ApolloProviderProps) {
  return <Provider client={apolloClient}>{children}</Provider>;
}
```

**파일**: `app/layout.tsx`

```typescript
import { ApolloProvider } from "@/lib/apollo-provider";
import { ThemeProvider } from "@/components/providers";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ko">
      <body>
        <ApolloProvider>
          <ThemeProvider>{children}</ThemeProvider>
        </ApolloProvider>
      </body>
    </html>
  );
}
```

### 3. 공통 Fragment 정의

**파일**: `lib/graphql/fragments/common.ts`

```typescript
import { gql } from "@apollo/client";

// 타임스탬프 Fragment - 모든 엔티티에서 재사용
export const TIMESTAMP_FIELDS = gql`
  fragment TimestampFields on Node {
    createdAt
    updatedAt
  }
`;

// 페이지네이션 정보 Fragment
export const PAGINATION_INFO = gql`
  fragment PaginationInfo on PageInfo {
    hasNextPage
    hasPreviousPage
    startCursor
    endCursor
  }
`;

// 사용자 기본 정보 Fragment
export const USER_BASIC_FIELDS = gql`
  fragment UserBasicFields on User {
    id
    fullName
    email
    username
  }
`;

// 테넌트 기본 정보 Fragment
export const TENANT_BASIC_FIELDS = gql`
  fragment TenantBasicFields on Tenant {
    id
    name
    status
  }
`;
```

### 4. Feature별 GraphQL 쿼리

**파일**: `features/tnnt/tenants/graphql/queries.ts`

```typescript
import { gql } from "@apollo/client";
import { TIMESTAMP_FIELDS } from "@/lib/graphql/fragments/common";

// 테넌트 목록 조회
export const GET_TENANTS = gql`
  query GetTenants($limit: Int, $offset: Int, $status: String) {
    tenants(limit: $limit, offset: $offset, status: $status) {
      edges {
        node {
          id
          name
          status
          createdAt
          updatedAt
        }
      }
      pageInfo {
        hasNextPage
        totalCount
      }
    }
  }
`;

// 테넌트 상세 조회
export const GET_TENANT = gql`
  query GetTenant($id: ID!) {
    tenant(id: $id) {
      id
      name
      description
      status
      createdAt
      updatedAt
    }
  }
`;

// 쿼리 변수 타입
export interface GetTenantsVariables {
  limit?: number;
  offset?: number;
  status?: string;
}

export interface GetTenantVariables {
  id: string;
}
```

### 5. Feature별 GraphQL 뮤테이션

**파일**: `features/tnnt/tenants/graphql/mutations.ts`

```typescript
import { gql } from "@apollo/client";

// 테넌트 생성
export const CREATE_TENANT = gql`
  mutation CreateTenant($input: TenantCreateInput!) {
    createTenant(input: $input) {
      id
      name
      status
      createdAt
    }
  }
`;

// 테넌트 수정
export const UPDATE_TENANT = gql`
  mutation UpdateTenant($id: ID!, $input: TenantUpdateInput!) {
    updateTenant(id: $id, input: $input) {
      id
      name
      status
      updatedAt
    }
  }
`;

// 테넌트 삭제
export const DELETE_TENANT = gql`
  mutation DeleteTenant($id: ID!) {
    deleteTenant(id: $id) {
      message
    }
  }
`;

// 뮤테이션 변수 타입
export interface CreateTenantVariables {
  input: {
    name: string;
    description?: string;
    status: "ACTIVE" | "INACTIVE";
  };
}

export interface UpdateTenantVariables {
  id: string;
  input: {
    name?: string;
    description?: string;
    status?: "ACTIVE" | "INACTIVE";
  };
}

export interface DeleteTenantVariables {
  id: string;
}
```

### 6. Feature별 GraphQL Hooks

**파일**: `features/tnnt/tenants/hooks/use-tenants.ts`

```typescript
import { useQuery, useMutation } from "@apollo/client";
import {
  GET_TENANTS,
  GET_TENANT,
  CREATE_TENANT,
  UPDATE_TENANT,
  DELETE_TENANT,
  type GetTenantsVariables,
  type GetTenantVariables,
  type CreateTenantVariables,
  type UpdateTenantVariables,
  type DeleteTenantVariables,
} from "../graphql";
import type { Tenant } from "../types";

// ========== useQuery Hooks ==========

/**
 * 테넌트 목록 조회
 */
export function useTenants(variables?: GetTenantsVariables) {
  return useQuery<
    { tenants: { edges: Array<{ node: Tenant }>; pageInfo: any } },
    GetTenantsVariables
  >(GET_TENANTS, {
    variables: {
      limit: 20,
      offset: 0,
      ...variables,
    },
    fetchPolicy: "network-only",
  });
}

/**
 * 테넌트 상세 조회
 */
export function useTenant(id: string) {
  return useQuery<{ tenant: Tenant }, GetTenantVariables>(GET_TENANT, {
    variables: { id },
    skip: !id, // id가 없으면 쿼리 실행 안 함
  });
}

// ========== useMutation Hooks ==========

/**
 * 테넌트 생성
 */
export function useCreateTenant() {
  return useMutation<{ createTenant: Tenant }, Error, CreateTenantVariables>(
    CREATE_TENANT,
    {
      update(cache, { data }) {
        // Apollo Cache 업데이트 (선택)
        if (data?.createTenant) {
          // 캐시 업데이트 로직
        }
      },
    }
  );
}

/**
 * 테넌트 수정
 */
export function useUpdateTenant() {
  return useMutation<{ updateTenant: Tenant }, Error, UpdateTenantVariables>(
    UPDATE_TENANT
  );
}

/**
 * 테넌트 삭제
 */
export function useDeleteTenant() {
  return useMutation<
    { deleteTenant: { message: string } },
    Error,
    DeleteTenantVariables
  >(DELETE_TENANT);
}
```

### 7. GraphQL 타입 정의 (GraphQL 네이티브)

**파일**: `features/tnnt/tenants/types/tenants.types.ts`

```typescript
/**
 * GraphQL 네이티브 타입 정의
 *
 * camelCase 필드 네이밍은 GraphQL 스키마와 직접 매칭됩니다.
 * 불필요한 타입 변환이 없어 성능이 우수합니다.
 */

// GraphQL 응답 타입 (camelCase)
export interface Tenant {
  id: string;
  name: string;
  description?: string;
  status: TenantStatus;
  createdAt: string;
  updatedAt: string;
}

// 상태 타입
export type TenantStatus = "ACTIVE" | "INACTIVE" | "SUSPENDED";

// 요청 DTO
export interface CreateTenantRequest {
  name: string;
  description?: string;
  status: TenantStatus;
}

export interface UpdateTenantRequest {
  name?: string;
  description?: string;
  status?: TenantStatus;
}

// 목록 응답
export interface TenantsListResponse {
  edges: Array<{
    node: Tenant;
  }>;
  pageInfo: {
    hasNextPage: boolean;
    hasPreviousPage: boolean;
    totalCount: number;
  };
}

// 쿼리 파라미터
export interface TenantsQueryParams {
  limit?: number;
  offset?: number;
  status?: TenantStatus;
  search?: string;
}
```

### 8. 컴포넌트에서 GraphQL 사용

**파일**: `app/(main)/tnnt/tenants/page.tsx`

```typescript
"use client";

import { toast } from "sonner";
import { useTenants, useDeleteTenant } from "@/features/tnnt/tenants/hooks";
import {
  TenantsTable,
  TenantsHeader,
  TenantsFilters,
} from "@/features/tnnt/tenants/components";
import { useTenantsStore } from "@/features/tnnt/tenants/stores";

export default function TenantsPage() {
  // Store에서 UI 상태 가져오기
  const { currentPage, itemsPerPage, selectedStatus, searchQuery } =
    useTenantsStore();

  // GraphQL 쿼리 - Apollo Hooks 사용
  const { data, loading, error, refetch } = useTenants({
    limit: itemsPerPage,
    offset: currentPage * itemsPerPage,
    status: selectedStatus,
  });

  // GraphQL 뮤테이션 - 삭제
  const [deleteTenant, { loading: deleting }] = useDeleteTenant();

  const handleDelete = async (id: string) => {
    try {
      await deleteTenant({
        variables: { id },
      });
      toast.success("테넌트가 삭제되었습니다");
      refetch(); // 목록 새로고침
    } catch (err) {
      toast.error("삭제 실패");
    }
  };

  if (loading) return <div>로딩 중...</div>;
  if (error) return <div>에러: {error.message}</div>;

  const tenants = data?.tenants?.edges?.map((edge) => edge.node) || [];

  return (
    <div className="space-y-6 p-6">
      <TenantsHeader onRefresh={() => refetch()} />
      <TenantsFilters />
      <TenantsTable
        data={tenants}
        isLoading={deleting}
        onDelete={handleDelete}
      />
    </div>
  );
}
```

### 9. Apollo Client DevTools

Chrome 확장 프로그램을 설치하여 GraphQL 쿼리 디버깅:

https://chrome.google.com/webstore/detail/apollo-client-devtools

**주요 기능**:

- 실행된 쿼리/뮤테이션 확인
- Apollo Cache 상태 검토
- 성능 분석
- 에러 디버깅

### 10. GraphQL Best Practices

#### ✅ Fragment Colocation

컴포넌트와 가까운 곳에 Fragment 정의:

```typescript
// components/TenantCard.tsx
import { gql } from "@apollo/client";

// 컴포넌트가 필요한 필드를 Fragment로 정의
export const TENANT_CARD_FIELDS = gql`
  fragment TenantCardFields on Tenant {
    id
    name
    status
    createdAt
  }
`;

interface TenantCardProps {
  tenant: TenantCardFields;
}

export function TenantCard({ tenant }: TenantCardProps) {
  return (
    <div>
      <h3>{tenant.name}</h3>
      <p>{tenant.status}</p>
    </div>
  );
}
```

#### ✅ 쿼리 네이밍 일관성

```typescript
// ✅ 좋음: 일관된 naming
export const GET_TENANTS = gql`...`;
export const GET_TENANT = gql`...`;
export const CREATE_TENANT = gql`...`;
export const UPDATE_TENANT = gql`...`;
export const DELETE_TENANT = gql`...`;

// ❌ 나쁨: 불일치
export const FETCH_TENANTS = gql`...`;
export const getTenant = gql`...`;
export const CreateTenant = gql`...`;
```

#### ✅ 에러 처리

```typescript
const { data, loading, error } = useTenants();

if (error) {
  // GraphQL 에러 처리
  if (error.graphQLErrors && error.graphQLErrors.length > 0) {
    error.graphQLErrors.forEach((err) => {
      console.error(`GraphQL Error: ${err.message}`);
      console.error(`Code: ${err.extensions?.code}`);
    });
  }

  // 네트워크 에러 처리
  if (error.networkError) {
    console.error("Network Error:", error.networkError);
  }
}
```

#### ✅ 캐시 무효화

```typescript
const [updateTenant] = useUpdateTenant();

// 뮤테이션 후 관련 쿼리 자동 refetch
await updateTenant({
  variables: { id, input: {...} },
  refetchQueries: [
    { query: GET_TENANTS },
    { query: GET_TENANT, variables: { id } },
  ],
});
```

---

## 인증 시스템 (GraphQL 기반)

### 개요

인증 시스템은 GraphQL 뮤테이션을 통해 로그인/회원가입을 처리합니다. 토큰은 localStorage와 쿠키에 저장되며, Apollo Client의 authLink를 통해 자동으로 모든 요청에 포함됩니다.

### 로그인 Flow

```
1. 로그인 폼 입력
   ↓
2. GraphQL Mutation: signin
   ↓
3. 토큰 응답 (accessToken, refreshToken)
   ↓
4. localStorage + Cookie 저장
   ↓
5. Zustand Store 업데이트
   ↓
6. Dashboard로 리다이렉트
```

### 구현 예시

**파일**: `features/auth/graphql/mutations.ts`

```typescript
import { gql } from "@apollo/client";

export const SIGNIN = gql`
  mutation Signin($input: SigninInput!) {
    signin(input: $input) {
      accessToken
      refreshToken
      tokenType
      expiresIn
    }
  }
`;

export const SIGNUP = gql`
  mutation Signup($input: SignupInput!) {
    signup(input: $input) {
      id
      username
      email
      fullName
    }
  }
`;

export interface SigninVariables {
  input: {
    username: string;
    password: string;
  };
}

export interface SignupVariables {
  input: {
    username: string;
    email: string;
    password: string;
    fullName?: string;
  };
}
```

**파일**: `features/auth/hooks/use-auth.ts`

```typescript
import { useAuthStore } from "@/features/auth/stores";

/**
 * UI Logic Hook - 컴포넌트에서 권장 사용
 */
export function useAuth() {
  const router = useRouter();
  const { login, isLoading, error } = useAuthStore();

  const signin = async (username: string, password: string) => {
    try {
      await login(username, password);
      router.push("/core/dashboard");
    } catch (err) {
      console.error("로그인 실패:", err);
      throw err;
    }
  };

  return {
    signin,
    isLoading,
    error,
  };
}
```

---

## 목록 페이지 구성

### 완전한 페이지 통합

```typescript
// app/(main)/tnnt/tenants/page.tsx
"use client";

import { toast } from "sonner";
import { useTenants, useDeleteTenant } from "@/features/tnnt/tenants/hooks";
import {
  TenantsHeader,
  TenantsStats,
  TenantsFilters,
  TenantsTable,
} from "@/features/tnnt/tenants/components";
import { useTenantsStore } from "@/features/tnnt/tenants/stores";

export default function TenantsPage() {
  // Store 상태
  const {
    globalFilter,
    selectedStatus,
    currentPage,
    itemsPerPage,
    setCurrentPage,
    setItemsPerPage,
  } = useTenantsStore();

  // GraphQL 조회
  const {
    data: tenantsResponse,
    loading,
    error,
    refetch,
  } = useTenants({
    limit: itemsPerPage,
    offset: currentPage * itemsPerPage,
    status: selectedStatus,
  });

  // GraphQL 삭제
  const [deleteTenant, { loading: deleting }] = useDeleteTenant();

  const handleDelete = async (id: string) => {
    try {
      await deleteTenant({
        variables: { id },
        refetchQueries: [{ query: GET_TENANTS }],
      });
      toast.success("테넌트가 삭제되었습니다");
    } catch (err) {
      toast.error("삭제 실패");
    }
  };

  const tenants =
    tenantsResponse?.tenants?.edges?.map((edge) => edge.node) || [];

  return (
    <div className="space-y-6 p-6">
      {/* 헤더 */}
      <TenantsHeader onRefresh={() => refetch()} />

      {/* 통계 */}
      <TenantsStats
        totalCount={tenantsResponse?.tenants?.pageInfo?.totalCount || 0}
      />

      {/* 필터 */}
      <TenantsFilters />

      {/* 테이블 */}
      <TenantsTable
        data={tenants}
        isLoading={loading || deleting}
        onDelete={handleDelete}
        pagination={{
          currentPage,
          itemsPerPage,
          total: tenantsResponse?.tenants?.pageInfo?.totalCount || 0,
          onPageChange: setCurrentPage,
          onPageSizeChange: setItemsPerPage,
        }}
      />
    </div>
  );
}
```

---

## 상태 관리

### Zustand Store 패턴

**파일**: `features/tnnt/tenants/stores/tenants.store.ts`

```typescript
import { create } from "zustand";

interface TenantsStoreState {
  // UI 상태
  globalFilter: string;
  selectedStatus: string | null;
  currentPage: number;
  itemsPerPage: number;

  // Actions
  setGlobalFilter: (filter: string) => void;
  setSelectedStatus: (status: string | null) => void;
  setCurrentPage: (page: number) => void;
  setItemsPerPage: (size: number) => void;
}

export const useTenantsStore = create<TenantsStoreState>((set) => ({
  // 초기 상태
  globalFilter: "",
  selectedStatus: null,
  currentPage: 0,
  itemsPerPage: 20,

  // Actions
  setGlobalFilter: (filter) => set({ globalFilter: filter }),
  setSelectedStatus: (status) => set({ selectedStatus: status }),
  setCurrentPage: (page) => set({ currentPage: page }),
  setItemsPerPage: (size) => set({ itemsPerPage: size }),
}));
```

**중요**: 서버 상태(API 데이터)는 Apollo Cache에서 관리하고, UI 상태(필터, 페이지네이션)만 Zustand에서 관리합니다.

---

## 에러 처리 전략

### GraphQL 에러 처리

```typescript
import type { ApolloError } from "@apollo/client";

function handleGraphQLError(error: ApolloError) {
  if (error.graphQLErrors) {
    error.graphQLErrors.forEach(({ message, extensions }) => {
      const code = extensions?.code;

      if (code === "AUTHENTICATION_REQUIRED") {
        // 인증 필요 - 로그인 페이지로 이동
        window.location.href = "/signin";
      } else if (code === "FORBIDDEN") {
        // 권한 없음
        toast.error("권한이 없습니다");
      } else if (code === "VALIDATION_ERROR") {
        // 입력값 오류
        toast.error(`입력 오류: ${message}`);
      } else {
        // 일반 에러
        toast.error(message);
      }
    });
  }

  if (error.networkError) {
    toast.error("네트워크 연결 실패");
  }
}
```

---

## Feature Index (공개 API 패턴)

**파일**: `features/tnnt/tenants/index.ts`

```typescript
// Components
export { TenantsTable } from "./components/tenants-table";
export { TenantsForm } from "./components/tenants-form";
export { TenantsEdit } from "./components/tenants-edit";
export { TenantsHeader } from "./components/tenants-header";
export { TenantsFilters } from "./components/tenants-filters";
export { TenantsStats } from "./components/tenants-stats";

// Hooks
export {
  useTenants,
  useTenant,
  useCreateTenant,
  useUpdateTenant,
  useDeleteTenant,
} from "./hooks";

// Stores
export { useTenantsStore } from "./stores";

// Types
export type { Tenant, TenantStatus, TenantsQueryParams } from "./types";

// GraphQL
export {
  GET_TENANTS,
  GET_TENANT,
  CREATE_TENANT,
  UPDATE_TENANT,
  DELETE_TENANT,
} from "./graphql";
```

---

## 타입 정의 상세 가이드

### GraphQL 네이티브 타입

**원칙**: GraphQL 스키마와 직접 매칭되는 camelCase 필드 사용

```typescript
// ✅ 좋음: camelCase (GraphQL 네이티브)
export interface User {
  id: string;
  fullName: string;
  email: string;
  createdAt: string;
  updatedAt: string;
}

// ❌ 나쁨: snake_case (REST API 스타일 - 불필요한 변환 필요)
export interface User {
  id: string;
  full_name: string;
  email: string;
  created_at: string;
  updated_at: string;
}
```

---

## 베스트 프랙티스

### 1. GraphQL 쿼리 최적화

```typescript
// ❌ 나쁨: 불필요한 필드 요청
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
      phone
      address
      createdAt
      updatedAt
      # ... 더 많은 필드
    }
  }
`;

// ✅ 좋음: 필요한 필드만 요청
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      name
      email
      createdAt
    }
  }
`;
```

### 2. Hooks 사용 규칙

```typescript
// ✅ 좋음
function UserList() {
  const { data, loading, error } = useUsers();
  // ...
}

// ❌ 나쁨: 직접 Apollo 호출
function UserList() {
  const { data } = useQuery(GET_USERS);
  // ...
}
```

### 3. 에러 처리

```typescript
// ✅ 좋음: 사용자 친화적 메시지
try {
  await createTenant({...});
  toast.success("테넌트가 생성되었습니다");
} catch (err) {
  toast.error("테넌트 생성에 실패했습니다. 다시 시도해주세요.");
}

// ❌ 나쁨: 기술 에러 노출
console.log(error);
```

---

## 체크리스트

### 새로운 Feature 개발 체크리스트

- [ ] Feature 폴더 구조 생성
- [ ] GraphQL 쿼리/뮤테이션 정의 (queries.ts, mutations.ts)
- [ ] GraphQL Hooks 작성 (use-\*.ts)
- [ ] 타입 정의 (types/\*.types.ts)
- [ ] Zustand Store 작성 (stores/\*.store.ts)
- [ ] 7개 필수 컴포넌트 개발
- [ ] Feature index.ts 작성
- [ ] 컴포넌트에서 GraphQL Hooks 통합
- [ ] 에러 처리 구현
- [ ] 테스트 작성

### GraphQL 쿼리 검증

- [ ] 필요한 필드만 요청하는가?
- [ ] Fragment를 재사용하는가?
- [ ] 타입이 안전한가?
- [ ] 에러 처리가 있는가?
- [ ] 캐시 정책이 설정되어 있는가?

### 성능 최적화

- [ ] 페이지네이션을 사용하는가?
- [ ] 불필요한 refetch가 없는가?
- [ ] Apollo Cache를 활용하는가?
- [ ] 쿼리가 최적화되어 있는가?

---

## 참고 자료

- [Apollo Client 공식 문서](https://www.apollographql.com/docs/react/)
- [GraphQL 공식 사이트](https://graphql.org/)
- [Next.js 공식 문서](https://nextjs.org/docs)
- [Zustand 공식 문서](https://github.com/pmndrs/zustand)

---

**버전**: 2.0 (GraphQL 최적화 완료)
**마지막 업데이트**: 2024년 11월 14일
**상태**: ✅ 프로덕션 준비 완료
