# CXG í”Œë«í¼ - í”„ë¡ íŠ¸ì—”ë“œ GraphQL ê°œë°œ ì™„ì „ê°€ì´ë“œ

> **Next.jsì™€ Reactë¥¼ ì‚¬ìš©í•œ GraphQL ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì™„ì „ ë ˆí¼ëŸ°ìŠ¤**
>
> - **ëŒ€ìƒ ë…ì**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì, UI/UX ê°œë°œì
> - **í†µì‹  ë°©ì‹**: GraphQL with Apollo Client (REST API ì œê±°)
> - **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„ 11ì›” 17ì¼ (UI ìŠ¤íƒ€ì¼ & ë ˆì´ì•„ì›ƒ ì¡°ì • - v4.2)
> - **ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ (Users ëª¨ë“ˆ ê¸°ì¤€)

---

## ëª©ì°¨

1. [ë¹ ë¥¸ ì‹œì‘](#ë¹ ë¥¸-ì‹œì‘)
2. [ê°œë°œ ì›ì¹™](#ê°œë°œ-ì›ì¹™)
3. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
4. [IDAM Users ëª¨ë“ˆ ì™„ì „ ê°€ì´ë“œ](#idam-users-ëª¨ë“ˆ-ì™„ì „-ê°€ì´ë“œ)
5. [Query ê¸°ë°˜ í•„í„°ë§ ì•„í‚¤í…ì²˜](#query-ê¸°ë°˜-í•„í„°ë§-ì•„í‚¤í…ì²˜)
6. [GraphQL & Apollo Client](#graphql--apollo-client)
7. [íƒ€ì… ì •ì˜ ì‹œìŠ¤í…œ](#íƒ€ì…-ì •ì˜-ì‹œìŠ¤í…œ)
8. [ë°ì´í„° íë¦„ ìƒì„¸ ë¶„ì„](#ë°ì´í„°-íë¦„-ìƒì„¸-ë¶„ì„)
9. [ìƒíƒœ ê´€ë¦¬](#ìƒíƒœ-ê´€ë¦¬)
10. [ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ](#ì—ëŸ¬-ì²˜ë¦¬-ì „ëµ)
11. [ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)
12. [ì²´í¬ë¦¬ìŠ¤íŠ¸](#ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## ë¹ ë¥¸ ì‹œì‘

### ê°œë°œ í™˜ê²½ ì„¤ì •

```bash
cd apps/manager-web
pnpm install
pnpm dev  # http://localhost:8200
```

### ê¸°ìˆ  ìŠ¤íƒ

| ê³„ì¸µ               | ê¸°ìˆ             | ë²„ì „   | ëª©ì                     |
| ------------------ | --------------- | ------ | ----------------------- |
| í”„ë ˆì„ì›Œí¬         | Next.js         | 15+    | ë©”íƒ€í”„ë ˆì„ì›Œí¬, SSR/SSG |
| ì–¸ì–´               | TypeScript      | 5+     | íƒ€ì… ì•ˆì „ì„±             |
| ëŸ°íƒ€ì„             | React           | 19+    | UI ë¼ì´ë¸ŒëŸ¬ë¦¬           |
| GraphQL í´ë¼ì´ì–¸íŠ¸ | Apollo Client   | 3.11+  | GraphQL API í†µì‹         |
| ìŠ¤íƒ€ì¼             | Tailwind CSS    | v4     | ìœ í‹¸ë¦¬í‹° CSS            |
| UI ì»´í¬ë„ŒíŠ¸        | shadcn/ui       | Latest | ì¬ì‚¬ìš© ê°€ëŠ¥ ì»´í¬ë„ŒíŠ¸    |
| ê¸€ë¡œë²Œ ìƒíƒœ        | Zustand         | Latest | UI ìƒíƒœ ê´€ë¦¬            |
| í¼                 | React Hook Form | Latest | í¼ ìƒíƒœ ê´€ë¦¬            |
| ê²€ì¦               | Zod             | Latest | ìŠ¤í‚¤ë§ˆ ê²€ì¦             |

---

## ê°œë°œ ì›ì¹™

### 1. Feature-Driven Architecture (í•„ìˆ˜)

ëª¨ë“  ê¸°ëŠ¥ì€ ë…ë¦½ì ì¸ Feature ë‹¨ìœ„ë¡œ ê°œë°œí•˜ë©°, ê° ëª¨ë“ˆì€ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

```
features/idam/users/                    # Users ì—”í‹°í‹° í´ë”
â”œâ”€â”€ components/                          # âœ… UI ì»´í¬ë„ŒíŠ¸ (7ê°œ í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-columns.tsx               # í…Œì´ë¸” ì»¬ëŸ¼ ì •ì˜
â”‚   â”œâ”€â”€ users-table.tsx                 # í…Œì´ë¸” ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ users-edit.tsx                  # ìƒì„±/ìˆ˜ì • ëª¨ë‹¬
â”‚   â”œâ”€â”€ users-form.tsx                  # í¼ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ users-header.tsx                # í—¤ë” (ì œëª©, ë²„íŠ¼)
â”‚   â”œâ”€â”€ users-filters.tsx               # í•„í„° ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ users-stats.tsx                 # í†µê³„ ì¹´ë“œ
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ graphql/                             # âœ… GraphQL ì •ì˜ (ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ë§Œ)
â”‚   â”œâ”€â”€ queries.ts                      # GET_USERS, GET_USER
â”‚   â”œâ”€â”€ mutations.ts                    # CREATE_USER, UPDATE_USER
â”‚   â””â”€â”€ index.ts                        # Export ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ë§Œ
â”‚
â”œâ”€â”€ hooks/                               # âœ… Apollo Hooks + UI Logic
â”‚   â”œâ”€â”€ use-users.ts                    # useUsers(), useCreateUser() ë“±
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ types/                               # âœ… íƒ€ì… ì¤‘ì•™ ì§‘ì¤‘ (ë‹¨ì¼ ì†ŒìŠ¤)
â”‚   â”œâ”€â”€ users.types.ts                  # User, Variables, Response ëª¨ë‘
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ services/                            # (ì„ íƒ) Non-React ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ users.service.ts
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ stores/                              # âœ… UI ìƒíƒœ ê´€ë¦¬ (Zustand)
â”‚   â”œâ”€â”€ users.store.ts
â”‚   â””â”€â”€ index.ts
â”‚
â””â”€â”€ index.ts                             # ê³µê°œ API (Feature Index)
```

### 2. ê³„ì¸µë³„ ì±…ì„ (SoC - Separation of Concerns)

```
PAGE/COMPONENT
    â†“ (ì‚¬ìš©ì ì…ë ¥, ì´ë²¤íŠ¸)
HOOK (useQuery/useMutation)
    â†“ (GraphQL ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ ì‹¤í–‰)
GRAPHQL (ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ ì •ì˜)
    â†“ (HTTP POST)
APOLLO CLIENT (ìºì‹±, ë„¤íŠ¸ì›Œí¬ ìµœì í™”)
    â†“ (HTTP)
BACKEND API (GraphQL Server)
    â†“ (ë°ì´í„° ì¡°íšŒ/ì €ì¥)
DATABASE (PostgreSQL)
```

### 3. íƒ€ì… ì •ì˜ ì›ì¹™

**ë‹¨ í•˜ë‚˜ì˜ ì†ŒìŠ¤ (Single Source of Truth)**

```
types/users.types.tsì—ì„œ ëª¨ë“  íƒ€ì… ì •ì˜:
â”œâ”€â”€ User (ì—”í‹°í‹°)
â”œâ”€â”€ CreateUserInput (ì…ë ¥)
â”œâ”€â”€ UpdateUserInput (ì…ë ¥)
â”œâ”€â”€ UsersQueryVariables (ëª©ë¡ ì¿¼ë¦¬ ë³€ìˆ˜)
â”œâ”€â”€ UserQueryVariables (ë‹¨ì¼ ì¿¼ë¦¬ ë³€ìˆ˜)
â”œâ”€â”€ CreateUserVariables (ë®¤í…Œì´ì…˜ ë³€ìˆ˜)
â”œâ”€â”€ UpdateUserVariables (ë®¤í…Œì´ì…˜ ë³€ìˆ˜)
â””â”€â”€ Response íƒ€ì…ë“¤

graphql/ì—ì„œëŠ” íƒ€ì… ì •ì˜ NOT:
  âŒ graphql/queries.tsì—ì„œ íƒ€ì… ì •ì˜ ê¸ˆì§€
  âŒ graphql/mutations.tsì—ì„œ íƒ€ì… ì •ì˜ ê¸ˆì§€
  âœ… graphql/ì—ì„œëŠ” types.tsì—ì„œ ì„í¬íŠ¸ë§Œ
```

### 4. ì¼ê´€ì„± ìš°ì„  (Consistency First)

- **ëª¨ë“  ëª¨ë“ˆì€ ë™ì¼í•œ í´ë” êµ¬ì¡°**
- **ëª¨ë“  íƒ€ì…ì€ types.tsì—ì„œ ê´€ë¦¬**
- **ëª¨ë“  GraphQLì€ ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ë§Œ ì •ì˜**
- **ëª¨ë“  Hookì€ types.tsì—ì„œ íƒ€ì… ì„í¬íŠ¸**

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

### Manager Web ë””ë ‰í† ë¦¬ ë ˆì´ì•„ì›ƒ

```
apps/manager-web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/                  # ì¸ì¦ ë¼ìš°íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ signin/
â”‚   â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ (main)/                  # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”‚       â”œâ”€â”€ dashboard/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ idam/                # IDAM ë„ë©”ì¸
â”‚   â”‚       â”‚   â”œâ”€â”€ users/           # ì‚¬ìš©ì ëª©ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚       â”‚   â”œâ”€â”€ roles/           # ì—­í•  ëª©ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚   â”œâ”€â”€ api-keys/        # API í‚¤ ëª©ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚   â”œâ”€â”€ sessions/        # ì„¸ì…˜ ëª©ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚   â”œâ”€â”€ permissions/     # ê¶Œí•œ ëª©ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚   â””â”€â”€ login-logs/      # ë¡œê·¸ì¸ ê¸°ë¡ í˜ì´ì§€
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                  # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ui/                     # shadcn/ui
â”‚   â”‚   â””â”€â”€ layouts/                # ë ˆì´ì•„ì›ƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                    # Feature ëª¨ë“ˆ (ë„ë©”ì¸ë³„)
â”‚   â”‚   â”œâ”€â”€ auth/                    # ì¸ì¦
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ idam/                    # ID&Access Management
â”‚   â”‚       â”œâ”€â”€ users/               # ì‚¬ìš©ì (âœ… ì™„ì „í•œ êµ¬í˜„)
â”‚   â”‚       â”‚   â”œâ”€â”€ components/
â”‚   â”‚       â”‚   â”œâ”€â”€ graphql/
â”‚   â”‚       â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚       â”‚   â”œâ”€â”€ types/
â”‚   â”‚       â”‚   â”œâ”€â”€ stores/
â”‚   â”‚       â”‚   â”œâ”€â”€ services/
â”‚   â”‚       â”‚   â””â”€â”€ index.ts
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ roles/               # ì—­í• 
â”‚   â”‚       â”œâ”€â”€ api-keys/            # API í‚¤
â”‚   â”‚       â”œâ”€â”€ sessions/            # ì„¸ì…˜
â”‚   â”‚       â”œâ”€â”€ permissions/         # ê¶Œí•œ
â”‚   â”‚       â”œâ”€â”€ login-logs/          # ë¡œê·¸ì¸ ê¸°ë¡
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                         # ìœ í‹¸ë¦¬í‹° ë° ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ apollo-client.ts         # Apollo ì„¤ì •
â”‚   â”‚   â””â”€â”€ apollo-provider.tsx      # Apollo Provider
â”‚   â”‚
â”‚   â””â”€â”€ providers/                   # Context Providers
â”‚       â””â”€â”€ apollo-provider.tsx
â”‚
â””â”€â”€ IDAM_DATA_FLOW_MERMAID.md        # ë°ì´í„° íë¦„ Mermaid ë‹¤ì´ì–´ê·¸ë¨
```

---

## IDAM Users ëª¨ë“ˆ ì™„ì „ ê°€ì´ë“œ

Users ëª¨ë“ˆì€ IDAMì˜ ê°€ì¥ ì™„ì „í•œ êµ¬í˜„ ì˜ˆì‹œì…ë‹ˆë‹¤. ë‹¤ë¥¸ ëª¨ë“ˆ(roles, api-keys ë“±)ë„ ë™ì¼í•œ íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤.

### í´ë” êµ¬ì¡°

```
features/idam/users/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ users-columns.tsx      # í…Œì´ë¸” ì»¬ëŸ¼ (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-table.tsx        # í…Œì´ë¸” (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-edit.tsx         # ìˆ˜ì • ëª¨ë‹¬ (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-form.tsx         # í¼ (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-header.tsx       # í—¤ë” (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-filters.tsx      # í•„í„° (í•„ìˆ˜)
â”‚   â”œâ”€â”€ users-stats.tsx        # í†µê³„ (í•„ìˆ˜)
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ graphql/
â”‚   â”œâ”€â”€ queries.ts             # GET_USERS, GET_USER
â”‚   â”œâ”€â”€ mutations.ts           # CREATE_USER, UPDATE_USER
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-users.ts           # Apollo Hooks
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ users.types.ts         # ëª¨ë“  íƒ€ì… ì •ì˜ (ì¤‘ì•™ì§‘ì¤‘)
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ users.store.ts         # UI ìƒíƒœ (Zustand)
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ users.service.ts       # Non-React í˜¸ì¶œìš©
â”‚   â””â”€â”€ index.ts
â”‚
â””â”€â”€ index.ts                   # ê³µê°œ API
```

### 1. íƒ€ì… ì •ì˜ (types/users.types.ts)

**ì›ì¹™: ëª¨ë“  íƒ€ì…ì„ ì—¬ê¸°ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤**

```typescript
/**
 * ì‚¬ìš©ì GraphQL íƒ€ì… ì •ì˜ (camelCase - GraphQL ë„¤ì´í‹°ë¸Œ)
 * ë‹¨ì¼ ì†ŒìŠ¤: types.tsì—ì„œë§Œ ì •ì˜, graphql/ì—ì„œëŠ” ì„í¬íŠ¸ë§Œ í•¨
 */

// ===== ì—”í‹°í‹° íƒ€ì… =====

export interface User {
  id: string;
  userType: "MASTER" | "TENANT" | "SYSTEM";
  fullName: string;
  email: string;
  phone?: string;
  username: string;
  ssoProvider?: string;
  mfaEnabled: boolean;
  status: "ACTIVE" | "INACTIVE" | "LOCKED" | "SUSPENDED";
  lastLoginAt?: string;
  failedLoginAttempts: number;
  timezone: string;
  locale: string;
  department?: string;
  position?: string;
  createdAt: string;
  updatedAt: string;
}

// ===== ì…ë ¥ íƒ€ì… (Input) =====

export interface CreateUserInput {
  userType: string;
  fullName: string;
  email: string;
  username: string;
  password: string;
  phone?: string;
  department?: string;
  position?: string;
}

export interface UpdateUserInput {
  fullName?: string;
  email?: string;
  phone?: string;
  department?: string;
  position?: string;
  status?: string;
  mfaEnabled?: boolean;
}

// ===== ì¿¼ë¦¬ ë³€ìˆ˜ íƒ€ì… =====

/**
 * ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ íŒŒë¼ë¯¸í„° (ë³µìˆ˜í˜•)
 * GET_USERS ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©
 */
export interface UsersQueryVariables {
  limit?: number;
  offset?: number;
  userType?: string;
  status?: string;
}

/**
 * ì‚¬ìš©ì ë‹¨ì¼ ì¡°íšŒ íŒŒë¼ë¯¸í„° (ë‹¨ìˆ˜í˜•)
 * GET_USER ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©
 */
export interface UserQueryVariables {
  id: string;
}

// ===== ë®¤í…Œì´ì…˜ ë³€ìˆ˜ íƒ€ì… =====

export interface CreateUserVariables {
  input: CreateUserInput;
}

export interface UpdateUserVariables {
  id: string;
  input: UpdateUserInput;
}

// ===== GraphQL ì‘ë‹µ íƒ€ì… =====

export interface GetUsersResponse {
  users: User[];
}

export interface GetUserResponse {
  user: User;
}

export interface CreateUserResponse {
  createUser: User;
}

export interface UpdateUserResponse {
  updateUser: User;
}
```

### 2. GraphQL ì¿¼ë¦¬ ì •ì˜ (graphql/queries.ts)

**ì›ì¹™: ì¿¼ë¦¬ ì •ì˜ë§Œ, íƒ€ì…ì€ types.tsì—ì„œ ì„í¬íŠ¸**

```typescript
import { gql } from "@apollo/client";
import type { UsersQueryVariables, UserQueryVariables } from "../types/users.types";

/**
 * ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ (ë³µìˆ˜)
 */
export const GET_USERS = gql`
  query GetUsers(
    $limit: Int
    $offset: Int
    $userType: String
    $status: String
  ) {
    users(
      limit: $limit
      offset: $offset
      userType: $userType
      status: $status
    ) {
      id
      userType
      fullName
      email
      status
      createdAt
      updatedAt
    }
  }
`;

/**
 * ì‚¬ìš©ì ìƒì„¸ ì¡°íšŒ (ë‹¨ìˆ˜)
 */
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      userType
      fullName
      email
      phone
      username
      status
      createdAt
      updatedAt
    }
  }
`;
```

**ì£¼ì˜: íƒ€ì… ì •ì˜ëŠ” ì—¬ê¸°ì„œ í•˜ì§€ ì•ŠìŒ** âœ…

### 3. GraphQL ë®¤í…Œì´ì…˜ ì •ì˜ (graphql/mutations.ts)

```typescript
import { gql } from "@apollo/client";
import type {
  CreateUserInput,
  UpdateUserInput,
  CreateUserVariables,
  UpdateUserVariables,
} from "../types/users.types";

export const CREATE_USER = gql`
  mutation CreateUser($input: CreateUserInput!) {
    createUser(input: $input) {
      id
      userType
      fullName
      email
      status
      createdAt
    }
  }
`;

export const UPDATE_USER = gql`
  mutation UpdateUser($id: ID!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      id
      userType
      fullName
      email
      status
      updatedAt
    }
  }
`;
```

### 4. GraphQL ì¸ë±ìŠ¤ (graphql/index.ts)

**ì›ì¹™: ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ë§Œ export, íƒ€ì…ì€ ì ˆëŒ€ export í•˜ì§€ ì•ŠìŒ**

```typescript
/**
 * âš ï¸ íƒ€ì… ì •ì˜ëŠ” ../types/users.types.tsì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤
 * íƒ€ì…ì„ ì‚¬ìš©í•  ë•ŒëŠ” ë°˜ë“œì‹œ types.tsì—ì„œ ì§ì ‘ ì„í¬íŠ¸í•˜ì„¸ìš”
 */

export { GET_USERS, GET_USER } from "./queries";
export { CREATE_USER, UPDATE_USER } from "./mutations";
```

### 5. í¼ ì»´í¬ë„ŒíŠ¸ (components/users-form.tsx)

**ì›ì¹™: React Hook Form + Zod ê²€ì¦ + Hint Icons (Popover ë„ì›€ë§)**

```typescript
/**
 * ì‚¬ìš©ì í¼ ì»´í¬ë„ŒíŠ¸
 * - ìƒì„± ëª¨ë“œ: ëª¨ë“  í•„ë“œ ì…ë ¥
 * - ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ë° username í•„ë“œ ë¹„í™œì„±í™”
 * - Hint Icons: ê° í•„ë“œë§ˆë‹¤ ë„ì›€ë§ ì•„ì´ì½˜ í¬í•¨
 */

import { useEffect, useState } from "react";
import { useForm, Controller } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { HelpCircle } from "lucide-react";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";

// ===== í•„ë“œë³„ íŒíŠ¸ ì„¤ëª… =====
const fieldHints = {
  username: "3ì ì´ìƒì˜ ê³ ìœ í•œ ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”",
  email: "ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”",
  fullName: "ì‚¬ìš©ìì˜ ì‹¤ì œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”",
  password: "ë³´ì•ˆì„ ìœ„í•´ 8ì ì´ìƒì˜ ë³µì¡í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”",
  userType: "ì‚¬ìš©ìì˜ ì—­í• ì— ë”°ë¼ ì ì ˆí•œ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”",
  phone: "ì—°ë½ ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",
  department: "ì†Œì† ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”",
  position: "ì‚¬ìš©ìì˜ ì§ì±…/ì§ê¸‰ì„ ì…ë ¥í•˜ì„¸ìš”",
};

// ===== Hint Icon ì»´í¬ë„ŒíŠ¸ =====
function HintIcon({ hint }: { hint: string }) {
  const [open, setOpen] = useState(false);

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <button
          type="button"
          className="inline-flex items-center justify-center w-4 h-4 ml-1 text-muted-foreground hover:text-foreground transition-colors"
          onClick={(e) => {
            e.preventDefault();
            setOpen(!open);
          }}
        >
          <HelpCircle className="w-4 h-4" />
        </button>
      </PopoverTrigger>
      <PopoverContent className="w-48 text-xs p-2">
        {hint}
      </PopoverContent>
    </Popover>
  );
}

// ===== í¼ ê²€ì¦ ìŠ¤í‚¤ë§ˆ =====
const userFormSchema = z.object({
  username: z.string().min(3, "ì‚¬ìš©ìëª…ì€ 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤"),
  email: z.string().email("ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),
  fullName: z.string().min(1, "ì „ì²´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),
  password: z.string().min(8, "ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤").optional(),
  userType: z.enum(["ADMIN", "MANAGER", "USER"]),
  phone: z.string().optional(),
  department: z.string().optional(),
  position: z.string().optional(),
  status: z.enum(["ACTIVE", "INACTIVE", "LOCKED"]).optional(),
});

interface UsersFormProps {
  initialData?: User;
  onSubmit: (data: UserFormData) => void;
  onCancel: () => void;
  isLoading?: boolean;
}

export function UsersForm({
  initialData,
  onSubmit,
  onCancel,
  isLoading = false,
}: UsersFormProps) {
  const isEditing = !!initialData;

  const { register, handleSubmit, formState: { errors }, reset, control } =
    useForm<UserFormData>({
      resolver: zodResolver(userFormSchema),
      defaultValues: {
        username: initialData?.username || "",
        email: initialData?.email || "",
        fullName: initialData?.fullName || "",
        password: "",
        userType: initialData?.userType || "USER",
        phone: initialData?.phone || "",
        department: initialData?.department || "",
        position: initialData?.position || "",
      },
    });

  // ===== í¼ ë°ì´í„° ë¡œë“œ (ìƒì„±/ìˆ˜ì • ëª¨ë“œ ì²˜ë¦¬) =====
  useEffect(() => {
    if (initialData) {
      // âœ… ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ë°ì´í„°ë¡œ form ì—…ë°ì´íŠ¸
      reset({
        username: initialData.username || "",
        email: initialData.email || "",
        fullName: initialData.fullName || "",
        password: "",  // ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ë¹„ë°€ë²ˆí˜¸ ë¯¸ì…ë ¥
        userType: initialData.userType || "USER",
        phone: initialData?.phone || "",
        department: initialData?.department || "",
        position: initialData?.position || "",
        status: initialData?.status as "ACTIVE" | "INACTIVE" | "LOCKED",
      });
    } else {
      // âœ… ìƒì„± ëª¨ë“œ: form ì´ˆê¸°í™”
      reset({
        username: "",
        email: "",
        fullName: "",
        password: "",
        userType: "USER",
        phone: "",
        department: "",
        position: "",
        status: "ACTIVE",
      });
    }
  }, [initialData, reset]);

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* 2ì—´ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */}
      <div className="grid grid-cols-2 gap-4">
        {/* ì‚¬ìš©ìëª… */}
        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <Label htmlFor="username" className="text-xs">
              ì‚¬ìš©ìëª… <span className="text-red-500">*</span>
            </Label>
            <HintIcon hint={fieldHints.username} />
          </div>
          <Input
            id="username"
            {...register("username")}
            disabled={isLoading || isEditing}  // ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ë¹„í™œì„±í™”
          />
          {errors.username && (
            <p className="text-xs text-red-500">{errors.username.message}</p>
          )}
        </div>

        {/* ì´ë©”ì¼ */}
        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <Label htmlFor="email" className="text-xs">
              ì´ë©”ì¼ <span className="text-red-500">*</span>
            </Label>
            <HintIcon hint={fieldHints.email} />
          </div>
          <Input id="email" type="email" {...register("email")} disabled={isLoading} />
        </div>

        {/* ë¹„ë°€ë²ˆí˜¸ (ìƒì„± ëª¨ë“œì—ì„œë§Œ í‘œì‹œ) */}
        {!isEditing && (
          <div className="space-y-2">
            <div className="flex items-center justify-between">
              <Label htmlFor="password" className="text-xs">
                ë¹„ë°€ë²ˆí˜¸ <span className="text-red-500">*</span>
              </Label>
              <HintIcon hint={fieldHints.password} />
            </div>
            <Input
              id="password"
              type="password"
              {...register("password")}
              disabled={isLoading}
            />
          </div>
        )}

        {/* ì‚¬ìš©ì ìœ í˜• */}
        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <Label htmlFor="userType" className="text-xs">
              ì‚¬ìš©ì ìœ í˜• <span className="text-red-500">*</span>
            </Label>
            <HintIcon hint={fieldHints.userType} />
          </div>
          <Controller
            name="userType"
            control={control}
            render={({ field }) => (
              <Select value={field.value} onValueChange={field.onChange} disabled={isLoading}>
                <SelectTrigger id="userType">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="USER">ì¼ë°˜ ì‚¬ìš©ì</SelectItem>
                  <SelectItem value="MANAGER">ë§¤ë‹ˆì €</SelectItem>
                  <SelectItem value="ADMIN">ê´€ë¦¬ì</SelectItem>
                </SelectContent>
              </Select>
            )}
          />
        </div>
      </div>

      <EntityFormButtons onCancel={onCancel} isLoading={isLoading} submitText={isEditing ? "ìˆ˜ì •" : "ë“±ë¡"} />
    </form>
  );
}
```

**ì£¼ìš” íŠ¹ì§•:**
1. **Hint Icons**: ê° í•„ë“œ ì˜†ì— ë¬¼ìŒí‘œ ì•„ì´ì½˜ìœ¼ë¡œ ë„ì›€ë§ ì œê³µ (Popover)
2. **2ì—´ ê·¸ë¦¬ë“œ**: `grid grid-cols-2 gap-4`ë¡œ í•­ëª© ë°°ì¹˜
3. **ë¼ë²¨ ì •ë ¬**: `flex items-center justify-between`ìœ¼ë¡œ íŒíŠ¸ ì•„ì´ì½˜ì„ ìš°ì¸¡ì— ë°°ì¹˜
4. **ìˆ˜ì • ëª¨ë“œ**: initialData ì¡´ì¬ ì‹œ username í•„ë“œ ë¹„í™œì„±í™”, ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ìˆ¨ê¹€
5. **í¼ ë°ì´í„° ë¡œë“œ**: useEffectì—ì„œ ì¡°ê±´ë¶€ë¡œ form.reset() í˜¸ì¶œ (ìƒì„±/ìˆ˜ì • ëª¨ë“œ êµ¬ë¶„)

### 6. Apollo Hooks (hooks/use-users.ts)

```typescript
import { useQuery, useMutation } from "@apollo/client";
import { GET_USERS, GET_USER, CREATE_USER, UPDATE_USER } from "../graphql";
import type {
  User,
  UsersQueryVariables,
  UserQueryVariables,
  CreateUserVariables,
  UpdateUserVariables,
  GetUsersResponse,
  GetUserResponse,
  CreateUserResponse,
  UpdateUserResponse,
} from "../types/users.types";

// ========== useQuery Hooks (ì¡°íšŒ) ==========

/**
 * ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
 * @param variables - { limit, offset, userType, status }
 * @returns { data.users, loading, error, refetch }
 */
export function useUsers(variables?: UsersQueryVariables) {
  return useQuery<GetUsersResponse, UsersQueryVariables>(GET_USERS, {
    variables: {
      limit: 20,
      offset: 0,
      ...variables,
    },
    fetchPolicy: "cache-and-network",
  });
}

/**
 * ì‚¬ìš©ì ìƒì„¸ ì¡°íšŒ
 */
export function useUser(id: string) {
  return useQuery<GetUserResponse, UserQueryVariables>(GET_USER, {
    variables: { id },
    skip: !id,
  });
}

// ========== useMutation Hooks (ìƒì„±/ìˆ˜ì •) ==========

/**
 * ì‚¬ìš©ì ìƒì„±
 */
export function useCreateUser() {
  return useMutation<CreateUserResponse, Error, CreateUserVariables>(
    CREATE_USER,
    {
      refetchQueries: [
        {
          query: GET_USERS,
          variables: { limit: 20, offset: 0 },
        },
      ],
    }
  );
}

/**
 * ì‚¬ìš©ì ìˆ˜ì •
 */
export function useUpdateUser() {
  return useMutation<UpdateUserResponse, Error, UpdateUserVariables>(
    UPDATE_USER
  );
}
```

**ì¤‘ìš”: íƒ€ì…ì„ ì–´ë””ì„œ ì„í¬íŠ¸í•˜ë‚˜?**
```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
import type {
  User,
  UsersQueryVariables,
  CreateUserVariables,
} from "../types/users.types";

// âŒ ì˜ëª»ëœ ë°©ë²• (graphql/index.tsì—ì„œ íƒ€ì…ì„ export í•˜ì§€ ì•ŠìŒ)
import type { UsersQueryVariables } from "../graphql";  // ë¶ˆê°€ëŠ¥!
```

### 6. í˜ì´ì§€ì—ì„œ ì‚¬ìš© (app/(main)/idam/users/page.tsx)

```typescript
"use client";

import { useState, useEffect } from "react";
import { toast } from "sonner";
import {
  UsersHeader,
  UsersStats,
  UsersFilter,
  UsersTable,
  UsersEdit,
  useUsers,
  useUpdateUser,
  useUsersStore,
  type UsersFilterState,
  type User,
} from "@/features/idam/users";

export default function UsersPage() {
  // 1ï¸âƒ£ UI ìƒíƒœ (Zustand Store)
  const { currentPage, itemsPerPage, setSearchText, setSelectedStatus, setCurrentPage, openForm, setSelectedId } =
    useUsersStore();

  // 2ï¸âƒ£ ì¿¼ë¦¬ í•„í„° ìƒíƒœ (íŒì—…ì—ì„œ ìˆ˜ì •, ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œë§Œ ì„œë²„ ì¿¼ë¦¬ ì‹¤í–‰)
  const [queryFilters, setQueryFilters] = useState<Record<string, string[] | null>>({
    status: null,
    userType: null,
  });

  // 3ï¸âƒ£ ì¿¼ë¦¬ í…ìŠ¤íŠ¸ (ììœ  ê²€ìƒ‰) - 500ms ë””ë°”ìš´ìŠ¤ ì ìš©
  const [queryText, setQueryTextLocal] = useState("");
  const [debouncedQueryText, setDebouncedQueryText] = useState("");

  // 3-1ï¸âƒ£ ì¿¼ë¦¬ í…ìŠ¤íŠ¸ ë””ë°”ìš´ìŠ¤ (500ms)
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedQueryText(queryText);
      setSearchText(queryText);
    }, 500);

    return () => clearTimeout(timer);
  }, [queryText, setSearchText]);

  // 4ï¸âƒ£ GraphQL ì¿¼ë¦¬ (Apollo useQuery)
  const {
    data: usersResponse,
    loading,
    refetch,
  } = useUsers({
    limit: itemsPerPage,
    offset: currentPage * itemsPerPage,
    userType: queryFilters.userType ? queryFilters.userType.join(",") : undefined,
    status: queryFilters.status ? queryFilters.status.join(",") : undefined,
    search: debouncedQueryText || undefined,
  });

  // 5ï¸âƒ£ GraphQL ë®¤í…Œì´ì…˜ (Apollo useMutation)
  const [updateUser, { loading: updating }] = useUpdateUser();

  // 6ï¸âƒ£ ë°ì´í„° ì²˜ë¦¬
  const users = usersResponse?.users || [];

  // 7ï¸âƒ£ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬

  /** ê²€ìƒ‰ í…ìŠ¤íŠ¸ ë³€ê²½ (UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸, ë””ë°”ìš´ìŠ¤ í›„ ê²€ìƒ‰) */
  const handleQueryTextChange = (text: string) => {
    setQueryTextLocal(text);
  };

  /** í•„í„° ì ìš© */
  const handleApplyQuery = () => {
    // í•„í„° ì ìš© ì‹œ í•„ìš”í•œ ì¶”ê°€ ì‘ì—…ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì— ì‘ì„±
    // í˜„ì¬ëŠ” queryFilters ìƒíƒœ ì—…ë°ì´íŠ¸ë¡œ useUsersê°€ ìë™ìœ¼ë¡œ refetchë¨
  };

  /** ëª¨ë“  í•„í„° ì´ˆê¸°í™” */
  const handleClearAllFilters = () => {
    setQueryFilters({
      status: null,
      userType: null,
    });
    setSearchText("");
    setQueryTextLocal("");
    setDebouncedQueryText("");
    setCurrentPage(0);  // í˜ì´ì§€ ë²ˆí˜¸ ì´ˆê¸°í™”
  };

  /** ì‚¬ìš©ì ìˆ˜ì • */
  const handleEdit = (user: User) => {
    // ì„ íƒëœ ì‚¬ìš©ì IDë¥¼ storeì— ì €ì¥
    setSelectedId(user.id);
    // ìˆ˜ì • í¼ ì˜¤í”ˆ
    openForm();
  };

  /** ì‚¬ìš©ì ì‚­ì œ (ìƒíƒœ ë³€ê²½) */
  const handleDelete = async (user: any) => {
    if (confirm(`'${user.fullName}' ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      try {
        await updateUser({
          variables: {
            id: user.id,
            input: { status: "INACTIVE" },
          },
        });
        toast.success("ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤");
        refetch();
      } catch (error) {
        toast.error("ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
        console.error("Failed to delete user:", error);
      }
    }
  };

  if (loading) return <div className="p-6">ë¡œë”© ì¤‘...</div>;

  return (
    <div className="space-y-6">
      <UsersHeader onRefresh={() => refetch()} />
      <UsersStats data={users} />

      {/* Jira ìŠ¤íƒ€ì¼ Query í•„í„°ë§ UI */}
      <UsersFilter
        queryText={queryText}
        onQueryTextChange={handleQueryTextChange}
        queryFilters={queryFilters}
        onQueryFiltersChange={setQueryFilters}
        onApplyQuery={handleApplyQuery}
        onClearAllFilters={handleClearAllFilters}
      />

      <UsersTable data={users} isLoading={updating} onEdit={handleEdit} onDelete={handleDelete} />
      <UsersEdit />
    </div>
  );
}
```

**ì£¼ìš” íŠ¹ì§•:**

1. **Jira ìŠ¤íƒ€ì¼ í•„í„°ë§**:
   - ììœ  ê²€ìƒ‰ í…ìŠ¤íŠ¸ (queryText) + êµ¬ì¡°í™”ëœ í•„í„° (queryFilters)
   - í•„í„° íŒì—…ì—ì„œë§Œ ìˆ˜ì • ê°€ëŠ¥ (ì„ì‹œ ìƒíƒœ)
   - ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œë§Œ ì„œë²„ì— ì¿¼ë¦¬ ì‹¤í–‰

2. **ë‘ ê°€ì§€ ìƒíƒœ ê´€ë¦¬**:
   - **UI ìƒíƒœ** (í˜ì´ì§€, í˜ì´ì§€ í¬ê¸°): Zustand Store
   - **ì¿¼ë¦¬ ìƒíƒœ** (í•„í„°, ê²€ìƒ‰): Component State

3. **QueryText ë””ë°”ìš´ìŠ¤ (500ms)**:
   ```typescript
   // ì‚¬ìš©ìê°€ ì…ë ¥í•˜ë©´ UIëŠ” ì¦‰ì‹œ ì—…ë°ì´íŠ¸
   const handleQueryTextChange = (text: string) => {
     setQueryTextLocal(text);  // UI ì¦‰ì‹œ ë°˜ì˜
   };

   // í•˜ì§€ë§Œ GraphQL ì¿¼ë¦¬ëŠ” 500ms í›„ì— ì‹¤í–‰
   useEffect(() => {
     const timer = setTimeout(() => {
       setDebouncedQueryText(queryText);  // GraphQL ì¿¼ë¦¬ìš©
       setSearchText(queryText);            // Store ì—…ë°ì´íŠ¸
     }, 500);
     return () => clearTimeout(timer);
   }, [queryText, setSearchText]);

   // GraphQL ì¿¼ë¦¬ëŠ” ë””ë°”ìš´ìŠ¤ëœ ê°’ ì‚¬ìš©
   const { data } = useUsers({
     search: debouncedQueryText || undefined,
   });
   ```
   **ëª©ì **: ì‚¬ìš©ìê°€ ë¬¸ìë¥¼ ì™„ì„±í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì¿¼ë¦¬ ê°ì†Œ

4. **Edit Mode ì—°ê²°**:
   ```typescript
   const handleEdit = (user: User) => {
     setSelectedId(user.id);  // Storeì— ì„ íƒëœ ì‚¬ìš©ì ID ì €ì¥
     openForm();              // í¼ ëª¨ë‹¬ ì˜¤í”ˆ
   };
   ```
   - í…Œì´ë¸”ì˜ Edit ë²„íŠ¼ â†’ handleEdit í˜¸ì¶œ
   - selectedId â†’ users-edit.tsx â†’ useUser ì¿¼ë¦¬ ì‹¤í–‰
   - ì‚¬ìš©ì ë°ì´í„° â†’ users-form.tsxì˜ initialDataë¡œ ì „ë‹¬

5. **GraphQL íŒŒë¼ë¯¸í„° ë³€í™˜**:
   ```typescript
   userType: queryFilters.userType ? queryFilters.userType.join(",") : undefined,
   status: queryFilters.status ? queryFilters.status.join(",") : undefined,
   ```
   ë°°ì—´ì„ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ë³€í™˜

---

## Query ê¸°ë°˜ í•„í„°ë§ ì•„í‚¤í…ì²˜

### ê°œìš”

Users ëª¨ë“ˆì—ì„œ êµ¬í˜„ëœ **Query ê¸°ë°˜ í•„í„°ë§**ì€ Jiraì˜ í•„í„°ë§ ë°©ì‹ì„ ì°¨ìš©í•©ë‹ˆë‹¤.

```
[ğŸ” ê²€ìƒ‰ì–´...] [í•„í„° 3] [âœ• í•„í„° ì§€ìš°ê¸°] [â‹¯]
```

### í•„í„°ë§ì˜ ë‘ ê°€ì§€ ìš”ì†Œ

```typescript
// 1ï¸âƒ£ ììœ  ê²€ìƒ‰ í…ìŠ¤íŠ¸ (ì¿¼ë¦¬ í…ìŠ¤íŠ¸)
queryText: string                              // "john doe"

// 2ï¸âƒ£ êµ¬ì¡°í™”ëœ í•„í„° (ì¿¼ë¦¬ í•„í„°)
queryFilters: Record<string, string[] | null>  // { status: ["ACTIVE", "LOCKED"], userType: ["ADMIN"] }
```

### ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì…ë ¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QueryBar (UI)                       â”‚
â”‚ - ê²€ìƒ‰ ì…ë ¥                         â”‚
â”‚ - í•„í„° ë²„íŠ¼ í´ë¦­                    â”‚
â”‚ - í™œì„± í•„í„° ê°œìˆ˜ ë°°ì§€              â”‚
â”‚ - í•„í„° ì§€ìš°ê¸° ë²„íŠ¼                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ onClick
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QueryFilterPopup (ëª¨ë‹¬)             â”‚
â”‚ - Jira ìŠ¤íƒ€ì¼ ì¢Œìš° ë¶„í•  ë ˆì´ì•„ì›ƒ   â”‚
â”‚ - ì¢Œì¸¡: í•„í„° í•­ëª© ëª©ë¡              â”‚
â”‚ - ìš°ì¸¡: ì²´í¬ë°•ìŠ¤ ë©€í‹° ì„ íƒ          â”‚
â”‚ - ì„ì‹œ ìƒíƒœ (tempQueryFilters)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ ì ìš© ë²„íŠ¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Page Component                      â”‚
â”‚ - queryFilters ìƒíƒœ ì—…ë°ì´íŠ¸       â”‚
â”‚ - queryText ì—…ë°ì´íŠ¸                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apollo useQuery (ìë™ refetch)      â”‚
â”‚ - ë³€ìˆ˜ ë³€í™˜ (ë°°ì—´ â†’ ì‰¼í‘œ êµ¬ë¶„ ë¬¸ì) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GraphQL Query                       â”‚
â”‚ { users(status, userType, search) }â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend API (GraphQL Server)        â”‚
â”‚ - SQL WHERE ì ˆ ìƒì„±                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Query Result               â”‚
â”‚ - í•„í„°ë§ëœ ì‚¬ìš©ì ëª©ë¡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1ï¸âƒ£ ìƒíƒœ ê´€ë¦¬ êµ¬ì¡°

```typescript
// ===== Page Component (app/(main)/idam/users/page.tsx) =====

// UI ìƒíƒœ (Zustand Store)
const { currentPage, itemsPerPage, setCurrentPage, setSearchText } = useUsersStore();

// ì¿¼ë¦¬ ìƒíƒœ (Component State)
const [queryText, setQueryTextLocal] = useState("");
const [queryFilters, setQueryFilters] = useState<Record<string, string[] | null>>({
  status: null,
  userType: null,
});
```

**ìƒíƒœ ë¶„ë¦¬ ì´ìœ :**
- **UI ìƒíƒœ**: í˜ì´ì§€ ë²ˆí˜¸, í˜ì´ì§€ í¬ê¸°ëŠ” ì „ì²´ ì•±ì—ì„œ ê³µìœ  (Zustand)
- **ì¿¼ë¦¬ ìƒíƒœ**: í•„í„°ëŠ” í˜ì´ì§€ë³„ë¡œ ë…ë¦½ì  (Component State)

### 2ï¸âƒ£ í•„í„° íŒì—…ì˜ ì„ì‹œ ìƒíƒœ ê´€ë¦¬

```typescript
// ===== QueryFilterPopup Component (query-filter-popup.tsx) =====

// íŒì—… ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì„ì‹œ ìƒíƒœ
const [tempQueryFilters, setTempQueryFilters] = useState<Record<string, string[] | null>>(
  queryFilters
);

// íŒì—… ì—´ ë•Œ ë¶€ëª¨ ìƒíƒœ ë³µì‚¬
const handleOpenChange = useCallback((newOpen: boolean) => {
  if (newOpen) {
    setTempQueryFilters(queryFilters);  // ë¶€ëª¨ ìƒíƒœ ë³µì‚¬
  }
  onOpenChange(newOpen);
}, [queryFilters, onOpenChange]);

// ì²´í¬ë°•ìŠ¤ ì„ íƒ (ì„ì‹œ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸)
const handleCheckboxChange = useCallback(
  (values: string[]) => {
    setTempQueryFilters({
      ...tempQueryFilters,
      [selectedItemKey]: values.length > 0 ? values : null,
    });
  },
  [selectedItemKey, tempQueryFilters]
);

// ì ìš© ë²„íŠ¼ (ì„ì‹œ ìƒíƒœ â†’ ë¶€ëª¨ ìƒíƒœ)
const handleApply = useCallback(() => {
  onQueryFiltersChange(tempQueryFilters);  // ë¶€ëª¨ì— ë°˜ì˜
  onOpenChange(false);  // íŒì—… ë‹«ê¸°
}, [tempQueryFilters, onQueryFiltersChange, onOpenChange]);
```

**ì„ì‹œ ìƒíƒœì˜ ëª©ì :**
- íŒì—…ì—ì„œë§Œ í•„í„° ìˆ˜ì • ê°€ëŠ¥
- ì·¨ì†Œí•˜ë©´ ë³€ê²½ì‚¬í•­ ë¬´ì‹œ
- ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œë§Œ ë¶€ëª¨ ìƒíƒœ ì—…ë°ì´íŠ¸
- íŒì—… ë‚´ ë³€ê²½ì´ ì„œë²„ ì¿¼ë¦¬ë¥¼ ì¦‰ì‹œ íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠìŒ

### 3ï¸âƒ£ GraphQL ë³€ìˆ˜ ë³€í™˜

```typescript
// Pageì—ì„œ GraphQLì— ì „ë‹¬í•˜ê¸° ì „ì— ë³€í™˜ í•„ìš”
const { data } = useUsers({
  limit: itemsPerPage,
  offset: currentPage * itemsPerPage,
  // âŒ ì˜ëª»ë¨: [ë°±ì—”ë“œëŠ” ì‰¼í‘œ êµ¬ë¶„ ë¬¸ìì—´ ê¸°ëŒ€]
  // userType: queryFilters.userType,

  // âœ… ì˜¬ë°”ë¦„: ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜
  userType: queryFilters.userType ? queryFilters.userType.join(",") : undefined,
  status: queryFilters.status ? queryFilters.status.join(",") : undefined,

  search: queryText || undefined,
});
```

**ë³€í™˜ ê·œì¹™:**
```typescript
// Frontend (ë°°ì—´)
{ status: ["ACTIVE", "LOCKED"] }

// GraphQL ë³€ìˆ˜ (ë¬¸ìì—´)
{ status: "ACTIVE,LOCKED" }

// Backend (ë¬¸ìì—´ íŒŒì‹±)
status in ['ACTIVE', 'LOCKED']
```

### 4ï¸âƒ£ í•„í„° ì´ˆê¸°í™”

```typescript
const handleClearAllFilters = () => {
  // 1. ëª¨ë“  í•„í„° ì´ˆê¸°í™”
  setQueryFilters({
    status: null,
    userType: null,
  });

  // 2. ê²€ìƒ‰ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
  setSearchText("");
  setQueryTextLocal("");

  // 3. í˜ì´ì§€ ë²ˆí˜¸ ì´ˆê¸°í™” (ì¤‘ìš”!)
  setCurrentPage(0);
};
```

**í˜ì´ì§€ ì´ˆê¸°í™”ê°€ ì¤‘ìš”í•œ ì´ìœ :**
- í•„í„°ë¥¼ ë²—ìœ¼ë©´ ì „ì²´ ë°ì´í„° ì„¸íŠ¸ ë°˜í™˜
- ì´ì „ í˜ì´ì§€ ë²ˆí˜¸(ì˜ˆ: page=2)ê°€ ìœ íš¨í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- ê·¸ë˜ì„œ í•­ìƒ page=0(ì²« í˜ì´ì§€)ë¡œ ì´ˆê¸°í™”

### 5ï¸âƒ£ ê³µí†µ í•„í„° ì»´í¬ë„ŒíŠ¸ (components/filters/)

ì´ì œ `@/components/filters`ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•„í„° ì»´í¬ë„ŒíŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```typescript
// ===== Query ê¸°ë°˜ í•„í„°ë§ ì»´í¬ë„ŒíŠ¸ =====

// 1. QueryBar - ê²€ìƒ‰ + í•„í„° ë²„íŠ¼ UI
import { QueryBar } from "@/components/filters";

<QueryBar
  queryText={queryText}
  onQueryTextChange={setQueryText}
  queryFilters={queryFilters}
  onQueryFilterClick={() => setFilterOpen(true)}
  onClearAllFilters={handleClear}
/>

// 2. QueryFilter - QueryBar + QueryFilterPopup (ë³µí•©)
import { QueryFilter } from "@/components/filters";

<QueryFilter
  queryText={queryText}
  onQueryTextChange={setQueryText}
  queryFilters={queryFilters}
  onQueryFiltersChange={setQueryFilters}
  onApply={handleApply}
  onClearAllFilters={handleClear}
  filterItems={[
    { key: "status", label: "ìƒíƒœ", options: [...] },
    { key: "userType", label: "ì‚¬ìš©ì íƒ€ì…", options: [...] },
  ]}
/>

// 3. QueryFilterPopup - Jira ìŠ¤íƒ€ì¼ í•„í„° íŒì—… (ëª¨ë‹¬)
import { QueryFilterPopup } from "@/components/filters";

<QueryFilterPopup
  open={filterOpen}
  onOpenChange={setFilterOpen}
  queryFilters={queryFilters}
  onQueryFiltersChange={setQueryFilters}
  onApply={handleApply}
  items={filterItems}
/>
```

---

## GraphQL & Apollo Client

### 1. Apollo Client ì„¤ì • (lib/apollo-client.ts)

```typescript
import { ApolloClient, InMemoryCache, HttpLink, ApolloLink, from, gql } from '@apollo/client';
import { onError } from '@apollo/client/link/error';
import { setContext } from '@apollo/client/link/context';

const GRAPHQL_ENDPOINT = process.env.NEXT_PUBLIC_GRAPHQL_URL || 'http://localhost:8100/graphql/manager';

/**
 * í† í° ê°±ì‹  ë®¤í…Œì´ì…˜ ì •ì˜
 * âš ï¸ ì¤‘ìš”: 'auth' ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í¬í•¨í•˜ì§€ ì•ŠìŒ (ë°±ì—”ë“œ GraphQL êµ¬ì¡°ì— ë§ì¶¤)
 */
const REFRESH_TOKEN_MUTATION = gql`
  mutation RefreshToken($input: RefreshTokenInput!) {
    refreshToken(input: $input) {
      accessToken
      refreshToken
      tokenType
      expiresIn
    }
  }
`;

/**
 * í† í° ê°±ì‹  í•¨ìˆ˜
 * Refresh Tokenìœ¼ë¡œ ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
 */
async function refreshAccessToken(): Promise<{ accessToken: string; refreshToken: string } | null> {
  try {
    if (typeof window === 'undefined') return null;

    const refreshToken = localStorage.getItem('refresh_token');
    if (!refreshToken) {
      console.warn('No refresh token available');
      return null;
    }

    const response = await fetch(GRAPHQL_ENDPOINT, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        query: `
          mutation RefreshToken($input: RefreshTokenInput!) {
            refreshToken(input: $input) {
              accessToken
              refreshToken
              tokenType
              expiresIn
            }
          }
        `,
        variables: {
          input: { refreshToken },
        },
      }),
    });

    const data = await response.json();

    if (data.errors) {
      console.error('í† í° ê°±ì‹  ì˜¤ë¥˜:', data.errors);
      return null;
    }

    // âœ… ì˜¬ë°”ë¥¸ ì‘ë‹µ ê²½ë¡œ: data.data.refreshToken (auth ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì œê±°ë¨)
    const { accessToken, refreshToken: newRefreshToken } = data.data.refreshToken;

    // ìƒˆ í† í° ì €ì¥
    localStorage.setItem('access_token', accessToken);
    localStorage.setItem('refresh_token', newRefreshToken);

    return { accessToken, refreshToken: newRefreshToken };
  } catch (error) {
    console.error('í† í° ê°±ì‹  ì‹¤íŒ¨:', error);
    return null;
  }
}

// 1ï¸âƒ£ ì¸ì¦ Link
const authLink = setContext((_, { headers }) => {
  let token: string | null = null;

  if (typeof window !== "undefined") {
    token = localStorage.getItem("access_token");
    if (!token) {
      token = document.cookie
        .split("; ")
        .find((row) => row.startsWith("access_token="))
        ?.split("=")[1] ?? null;
    }
  }

  return {
    headers: {
      ...headers,
      authorization: token ? `Bearer ${token}` : "",
    },
  };
});

// 2ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ Link
const errorLink = onError(({ graphQLErrors, networkError, operation, forward }) => {
  if (graphQLErrors) {
    graphQLErrors.forEach(({ message, locations, path, extensions }) => {
      console.error(
        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`,
        extensions
      );

      // ì¸ì¦ ì‹¤íŒ¨ ì—ëŸ¬ ì²˜ë¦¬
      if (extensions?.code === 'UNAUTHENTICATED' || message?.includes('Authentication required')) {
        if (typeof window !== "undefined") {
          localStorage.removeItem("access_token");
          localStorage.removeItem("refresh_token");
          window.location.href = "/signin";
        }
      }
    });
  }

  if (networkError) {
    console.error(`[Network error]: ${networkError}`);

    // HTTP 401 ì—ëŸ¬ ì²˜ë¦¬ - í† í° ê°±ì‹  ì‹œë„
    if ('statusCode' in networkError && networkError.statusCode === 401) {
      if (typeof window !== "undefined") {
        (async () => {
          const newTokens = await refreshAccessToken();

          if (newTokens) {
            console.log('Token refreshed, retrying request');
            return forward(operation);
          } else {
            console.log('Token refresh failed, redirecting to login');
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");
            window.location.href = "/signin";
          }
        })();
      }
    }
  }
});

// 3ï¸âƒ£ HTTP Link
const httpLink = new HttpLink({
  uri: GRAPHQL_ENDPOINT,
  credentials: "include",
});

// 4ï¸âƒ£ Apollo Client
export const apolloClient = new ApolloClient({
  link: from([errorLink, authLink, httpLink]),
  cache: new InMemoryCache({
    typePolicies: {
      Query: {
        fields: {
          users: {
            keyArgs: ['userType', 'status'],
            merge(existing = [], incoming) {
              return incoming;
            },
          },
        },
      },
    },
  }),
  defaultOptions: {
    watchQuery: {
      fetchPolicy: "cache-and-network",
      errorPolicy: "all",
    },
    query: {
      fetchPolicy: "network-only",
      errorPolicy: "all",
    },
    mutate: {
      errorPolicy: "all",
    },
  },
  devtools: {
    enabled: process.env.NODE_ENV === 'development',
  },
});
```

**í† í° ê°±ì‹  GraphQL ì¿¼ë¦¬ ì£¼ì˜ì‚¬í•­:**
```typescript
// âŒ ì˜ëª»ë¨: 'auth' ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í¬í•¨
mutation RefreshToken($input: RefreshTokenInput!) {
  auth {
    refreshToken(input: $input) {
      accessToken
      refreshToken
    }
  }
}

// âœ… ì˜¬ë°”ë¦„: ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì œê±°
mutation RefreshToken($input: RefreshTokenInput!) {
  refreshToken(input: $input) {
    accessToken
    refreshToken
  }
}
```

### 2. Apollo Provider (lib/apollo-provider.tsx)

```typescript
"use client";

import { ApolloProvider as Provider } from "@apollo/client";
import { apolloClient } from "./apollo-client";

interface ApolloProviderProps {
  children: React.ReactNode;
}

export function ApolloProvider({ children }: ApolloProviderProps) {
  return <Provider client={apolloClient}>{children}</Provider>;
}
```

### 3. ì•± ë ˆì´ì•„ì›ƒì—ì„œ Apollo ì ìš© (app/layout.tsx)

```typescript
import { ApolloProvider } from "@/lib/apollo-provider";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ko">
      <body>
        <ApolloProvider>{children}</ApolloProvider>
      </body>
    </html>
  );
}
```

---

## íƒ€ì… ì •ì˜ ì‹œìŠ¤í…œ

### ì›ì¹™: ë‹¨ì¼ ì†ŒìŠ¤ (Single Source of Truth)

ëª¨ë“  íƒ€ì… ì •ì˜ëŠ” **types/module.types.ts íŒŒì¼ í•˜ë‚˜**ì—ì„œë§Œ ê´€ë¦¬ë©ë‹ˆë‹¤.

```
types/users.types.tsëŠ” ë‹¤ìŒì„ ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤:
â”œâ”€â”€ ì—”í‹°í‹° (User)
â”œâ”€â”€ ì…ë ¥ (CreateUserInput, UpdateUserInput)
â”œâ”€â”€ ì¿¼ë¦¬ ë³€ìˆ˜ (UsersQueryVariables, UserQueryVariables)
â”œâ”€â”€ ë®¤í…Œì´ì…˜ ë³€ìˆ˜ (CreateUserVariables, UpdateUserVariables)
â””â”€â”€ ì‘ë‹µ (GetUsersResponse, GetUserResponse, ...)

graphql/queries.ts ë˜ëŠ” mutations.tsì—ì„œ:
â”œâ”€â”€ âœ… types.tsì—ì„œ íƒ€ì… ì„í¬íŠ¸ ê°€ëŠ¥
â””â”€â”€ âŒ ìƒˆë¡œìš´ íƒ€ì… ì •ì˜ ê¸ˆì§€
```

### íƒ€ì… ëª…ëª… ê·œì¹™

```typescript
// ì—”í‹°í‹° (ë‹¨ìˆ˜í˜•)
export interface User { ... }
export interface Role { ... }
export interface Permission { ... }

// ì…ë ¥ (ë‹¨ìˆ˜í˜•, Input suffix)
export interface CreateUserInput { ... }
export interface UpdateUserInput { ... }
export interface CreateRoleInput { ... }

// ì¿¼ë¦¬ ë³€ìˆ˜ (ë³µìˆ˜í˜• = ëª©ë¡, ë‹¨ìˆ˜í˜• = ë‹¨ì¼)
export interface UsersQueryVariables { ... }        // ëª©ë¡ ì¡°íšŒ
export interface UserQueryVariables { ... }         // ë‹¨ì¼ ì¡°íšŒ
export interface RolesQueryVariables { ... }
export interface RoleQueryVariables { ... }

// ë®¤í…Œì´ì…˜ ë³€ìˆ˜ (ë‹¨ìˆ˜í˜•, Variables suffix)
export interface CreateUserVariables { ... }
export interface UpdateUserVariables { ... }
export interface DeleteUserVariables { ... }

// ì‘ë‹µ (Response suffix, camelCase)
export interface GetUsersResponse { ... }
export interface GetUserResponse { ... }
export interface CreateUserResponse { ... }
```

---

## ë°ì´í„° íë¦„ ìƒì„¸ ë¶„ì„

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ

```
1ï¸âƒ£ PAGE (app/(main)/idam/users/page.tsx)
   â””â”€ useUsers({ limit: 20, offset: 0 })

2ï¸âƒ£ HOOK (hooks/use-users.ts)
   â””â”€ useQuery<GetUsersResponse, UsersQueryVariables>(GET_USERS, ...)

3ï¸âƒ£ GRAPHQL (graphql/queries.ts)
   â””â”€ GET_USERS = gql`query GetUsers($limit: Int, ...) { ... }`

4ï¸âƒ£ APOLLO CLIENT
   â””â”€ HTTP POST to /graphql
      Request: { operationName: "GetUsers", variables: { ... } }

5ï¸âƒ£ BACKEND (Python Strawberry)
   â””â”€ users(limit, offset) â†’ ManagerUser[]

6ï¸âƒ£ DATABASE
   â””â”€ SELECT * FROM manager_users LIMIT 20 OFFSET 0

7ï¸âƒ£ RESPONSE (ì—­ìˆœ)
   â””â”€ users: [ { id, userType, fullName, ... } ]

8ï¸âƒ£ HOOK
   â””â”€ data: { users: User[] }

9ï¸âƒ£ PAGE
   â””â”€ <UsersTable data={users} />
```

### íƒ€ì… ë³€í™˜ íë¦„

```
Frontend (camelCase)
â”œâ”€ UsersQueryVariables: { limit: 20, offset: 0 }
â”œâ”€ User: { id, userType, fullName, ... }

GraphQL (camelCase - ë„¤ì´í‹°ë¸Œ)
â”œâ”€ query GetUsers($limit: Int, $offset: Int)
â”œâ”€ users: [ { id, userType, fullName } ]

Backend (Python snake_case)
â”œâ”€ user_type, full_name, created_at
â”œâ”€ Strawberry ìë™ ë³€í™˜: user_type â†’ userType

Database (snake_case)
â”œâ”€ user_type, full_name, created_at
```

---

## ìƒíƒœ ê´€ë¦¬

### Zustand Store (UI ìƒíƒœ ë¶„ë¦¬)

**ì›ì¹™: ì„œë²„ ìƒíƒœ(API ë°ì´í„°)ëŠ” Apolloì—ì„œ, UI ìƒíƒœ(í•„í„°, í˜ì´ì§€, í¼)ëŠ” Zustandì—ì„œ ê´€ë¦¬**

```typescript
// features/idam/users/stores/users.store.ts
import { create } from "zustand";

interface UsersStore {
  // ===== UI ìƒíƒœ =====
  currentPage: number;
  itemsPerPage: number;
  searchText: string;
  selectedStatus: string | null;
  formOpen: boolean;
  selectedId: string | null;
  sorting: Array<{ id: string; desc: boolean }>;

  // ===== ì•¡ì…˜ =====
  setCurrentPage: (page: number) => void;
  setItemsPerPage: (size: number) => void;
  setSearchText: (text: Updater<string>) => void;
  setSelectedStatus: (status: string | null) => void;
  setSelectedId: (id: string | null) => void;
  openForm: (id?: string) => void;
  closeForm: () => void;
  setSorting: (sorting: Updater<Array<{ id: string; desc: boolean }>>) => void;
  resetFilters: () => void;
  reset: () => void;
}

const initialState = {
  currentPage: 0,
  itemsPerPage: 20,
  searchText: "",
  selectedStatus: null,
  formOpen: false,
  selectedId: null,
  sorting: [],
};

export const useUsersStore = create<UsersStore>((set) => ({
  ...initialState,

  setCurrentPage: (page) => set({ currentPage: page }),
  setItemsPerPage: (size) => set({ itemsPerPage: size, currentPage: 0 }),
  setSearchText: (text) =>
    set((state) => ({
      searchText: typeof text === 'function' ? text(state.searchText) : text,
      currentPage: 0,
    })),
  setSelectedStatus: (status) =>
    set({
      selectedStatus: status,
      currentPage: 0,
    }),
  setSelectedId: (id) => set({ selectedId: id }),
  openForm: (id) => set({ formOpen: true, selectedId: id || null }),
  closeForm: () => set({ formOpen: false, selectedId: null }),
  setSorting: (sorting) =>
    set((state) => ({
      sorting: typeof sorting === 'function' ? sorting(state.sorting) : sorting,
    })),
  resetFilters: () =>
    set({
      searchText: "",
      selectedStatus: null,
      sorting: [],
      currentPage: 0,
    }),
  reset: () => set(initialState),
}));
```

**í˜ì´ì§€ì—ì„œ ì‚¬ìš©:**

```typescript
// 1. ëª©ë¡ ì¡°íšŒ
const { currentPage, itemsPerPage, selectedStatus } = useUsersStore();
const { data } = useUsers({
  limit: itemsPerPage,
  offset: currentPage * itemsPerPage,
  status: selectedStatus,
});

// 2. ìˆ˜ì • ëª¨ë“œ í™œì„±í™”
const { setSelectedId, openForm } = useUsersStore();
const handleEdit = (user: User) => {
  setSelectedId(user.id);  // ì„ íƒëœ ì‚¬ìš©ì ID ì €ì¥
  openForm();               // í¼ ëª¨ë‹¬ ì˜¤í”ˆ
};

// 3. ìˆ˜ì • í¼ì—ì„œ ë°ì´í„° ë¡œë“œ
const { selectedId } = useUsersStore();
const { data: editingUserData } = useUser(selectedId);
```

**ì£¼ìš” ë©”ì„œë“œ ì„¤ëª…:**
- `setSelectedId(id)`: ì„ íƒëœ ì‚¬ìš©ì IDë¥¼ ì €ì¥ (Edit ëª¨ë“œ ì§„ì… ì‹œ)
- `openForm(id?)`: í¼ ëª¨ë‹¬ì„ ì—´ê³  ì„ íƒëœ ID ì„¤ì •
- `closeForm()`: í¼ ëª¨ë‹¬ì„ ë‹«ê³  selectedId ì´ˆê¸°í™”

---

## ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

```typescript
const { data, loading, error } = useUsers();

if (error) {
  // GraphQL ì—ëŸ¬
  if (error.graphQLErrors && error.graphQLErrors.length > 0) {
    error.graphQLErrors.forEach(({ message, extensions }) => {
      console.error(`[${extensions?.code}] ${message}`);

      if (extensions?.code === "AUTHENTICATION_REQUIRED") {
        window.location.href = "/signin";
      } else if (extensions?.code === "FORBIDDEN") {
        toast.error("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤");
      } else {
        toast.error(message);
      }
    });
  }

  // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
  if (error.networkError) {
    toast.error("ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨");
  }
}
```

---

## ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. âœ… íƒ€ì… ì„í¬íŠ¸ ìœ„ì¹˜

```typescript
// âœ… ì˜¬ë°”ë¦„: types.tsì—ì„œë§Œ ì„í¬íŠ¸
import type {
  User,
  UsersQueryVariables,
  CreateUserVariables,
} from "../types/users.types";

import { GET_USERS, CREATE_USER } from "../graphql";

// âŒ í‹€ë¦¼: graphql/index.tsì—ì„œ íƒ€ì… ì„í¬íŠ¸
import type { UsersQueryVariables } from "../graphql";  // ë¶ˆê°€ëŠ¥!
```

### 2. âœ… GraphQL ì¿¼ë¦¬ ìµœì í™”

```typescript
// âŒ ë‚˜ì¨: ë¶ˆí•„ìš”í•œ í•„ë“œ
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      fullName
      email
      phone
      ssoProvider
      timezone
      locale
      # ... ëª¨ë“  í•„ë“œ
    }
  }
`;

// âœ… ì¢‹ìŒ: í•„ìš”í•œ í•„ë“œë§Œ
export const GET_USER = gql`
  query GetUser($id: ID!) {
    user(id: $id) {
      id
      fullName
      email
      status
      createdAt
    }
  }
`;
```

### 3. âœ… Hook ì‚¬ìš© ê·œì¹™

```typescript
// âœ… ê¶Œì¥: ì»´í¬ë„ŒíŠ¸ì—ì„œ Hook ì‚¬ìš©
function UsersPage() {
  const { data } = useUsers();
}

// âš ï¸ Non-React ì»¨í…ìŠ¤íŠ¸: Service ì‚¬ìš©
// (API Routes, Utils ë“±ì—ì„œë§Œ)
import { usersService } from "./services/users.service";
const users = await usersService.listUsers();
```

### 4. âœ… ì—ëŸ¬ ë©”ì‹œì§€

```typescript
// âŒ ë‚˜ì¨: ê¸°ìˆ ì  ì—ëŸ¬ ë…¸ì¶œ
toast.error(`GraphQL Error: ${error.message}`);

// âœ… ì¢‹ìŒ: ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€
toast.error("ì‚¬ìš©ì ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
```

### 5. âœ… ìºì‹œ ë¬´íš¨í™”

```typescript
// refetchQueriesë¥¼ ì‚¬ìš©í•´ ê´€ë ¨ ì¿¼ë¦¬ ìë™ ê°±ì‹ 
const [createUser] = useCreateUser();

await createUser({
  variables: { input },
  refetchQueries: [
    {
      query: GET_USERS,
      variables: { limit: 20, offset: 0 },
    },
  ],
});
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒˆë¡œìš´ Entity ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### 1ë‹¨ê³„: í´ë” ë° íƒ€ì… êµ¬ì¡°

- [ ] Feature í´ë” ìƒì„± (`features/idam/[entity]/`)
- [ ] **types/[entity].types.ts** - ëª¨ë“  íƒ€ì… ì •ì˜
  - [ ] Entity ì¸í„°í˜ì´ìŠ¤
  - [ ] Input ì¸í„°í˜ì´ìŠ¤
  - [ ] QueryVariables ì¸í„°í˜ì´ìŠ¤ (ìºë©œ ì¼€ì´ìŠ¤)
  - [ ] Mutation Variables ì¸í„°í˜ì´ìŠ¤
  - [ ] Response ì¸í„°í˜ì´ìŠ¤

#### 2ë‹¨ê³„: GraphQL ì •ì˜

- [ ] **graphql/queries.ts** - ì¿¼ë¦¬ ì •ì˜
  - [ ] types.tsì—ì„œ íƒ€ì… ì„í¬íŠ¸ âœ…
  - [ ] í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ (ê³¼ë‹¤ ìš”ì²­ ê¸ˆì§€)
  - [ ] í•„í„° íŒŒë¼ë¯¸í„° ì§€ì› (search, status, userType ë“±)
- [ ] **graphql/mutations.ts** - ë®¤í…Œì´ì…˜ ì •ì˜
  - [ ] CREATE, UPDATE, DELETE ë®¤í…Œì´ì…˜
  - [ ] íƒ€ì…ì€ types.tsì—ì„œë§Œ ì„í¬íŠ¸
- [ ] **graphql/index.ts** - ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ë§Œ export (íƒ€ì… ê¸ˆì§€)

#### 3ë‹¨ê³„: Apollo Hooks

- [ ] **hooks/use-[entity].ts** - Apollo Hooks
  - [ ] useQuery Hooks (ëª©ë¡, ë‹¨ì¼)
  - [ ] useMutation Hooks (ìƒì„±, ìˆ˜ì •, ì‚­ì œ)
  - [ ] fetchPolicy ì„¤ì • ("cache-and-network" ê¶Œì¥)
  - [ ] refetchQueries ì„¤ì • (ìºì‹œ ë¬´íš¨í™”)

#### 4ë‹¨ê³„: ì»´í¬ë„ŒíŠ¸ (7ê°œ í•„ìˆ˜)

- [ ] **components/[entity]-columns.tsx** - í…Œì´ë¸” ì»¬ëŸ¼ ì •ì˜
- [ ] **components/[entity]-table.tsx** - í…Œì´ë¸” ë Œë”ë§
- [ ] **components/[entity]-edit.tsx** - ìƒì„±/ìˆ˜ì • ëª¨ë‹¬
- [ ] **components/[entity]-form.tsx** - í¼ (react-hook-form)
- [ ] **components/[entity]-header.tsx** - í—¤ë” (ì œëª©, ë²„íŠ¼)
- [ ] **components/[entity]-filter.tsx** - í•„í„° (QueryFilter ì‚¬ìš©)
  - [ ] filterItems ì„¤ì • (í•„í„° ì˜µì…˜ ì •ì˜)
  - [ ] í˜ì´ì§€ì—ì„œ í•„ìš”í•œ props ì „ë‹¬
- [ ] **components/[entity]-stats.tsx** - í†µê³„ ì¹´ë“œ

#### 5ë‹¨ê³„: ìƒíƒœ ê´€ë¦¬

- [ ] **stores/[entity].store.ts** - UI ìƒíƒœ (Zustand)
  - [ ] currentPage
  - [ ] itemsPerPage
  - [ ] searchText (UIì— í‘œì‹œí•  ê²€ìƒ‰ì–´)
  - [ ] í•„ìš”ì‹œ ì¶”ê°€ UI ìƒíƒœ
- [ ] **services/[entity].service.ts** - Non-React í˜¸ì¶œìš© (ì„ íƒ)

#### 6ë‹¨ê³„: Export ë° Page

- [ ] **index.ts** - ê³µê°œ API ì •ì˜
  - [ ] Components export
  - [ ] Hooks export
  - [ ] Types export
  - [ ] Store export
- [ ] **app/(main)/[domain]/[entity]/page.tsx** - List Page
  - [ ] QueryBar ë˜ëŠ” QueryFilter ì‚¬ìš©
  - [ ] ì¿¼ë¦¬ í•„í„° ìƒíƒœ (useState)
  - [ ] ê²€ìƒ‰ í…ìŠ¤íŠ¸ ìƒíƒœ (useState)
  - [ ] GraphQL ë³€ìˆ˜ ë³€í™˜ (ë°°ì—´ â†’ ì‰¼í‘œ êµ¬ë¶„ ë¬¸ìì—´)
  - [ ] handleClearAllFilters êµ¬í˜„

### GraphQL ì¿¼ë¦¬ ê²€ì¦

- [ ] í•„ìš”í•œ í•„ë“œë§Œ ìš”ì²­í•˜ëŠ”ê°€?
- [ ] íƒ€ì…ì´ types.tsì™€ ì¼ì¹˜í•˜ëŠ”ê°€?
- [ ] ëª¨ë“  ë³€ìˆ˜ì— íƒ€ì…ì´ ì§€ì •ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ì—ëŸ¬ ì²˜ë¦¬ê°€ êµ¬í˜„ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ìºì‹œ ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?

### íƒ€ì… ì•ˆì „ì„± ê²€ì¦

- [ ] types.tsì—ì„œë§Œ íƒ€ì…ì„ ì •ì˜í•˜ëŠ”ê°€?
- [ ] graphql/ì—ì„œ íƒ€ì…ì„ exportí•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] ëª¨ë“  Hookì´ types.tsì—ì„œ íƒ€ì…ì„ ì„í¬íŠ¸í•˜ëŠ”ê°€?
- [ ] `any` íƒ€ì…ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] ì‘ë‹µ íƒ€ì…(Response)ì„ ì •ì˜í–ˆëŠ”ê°€?

---

## ì°¸ê³  ìë£Œ

- **ë‚´ë¶€ ë¬¸ì„œ**: `/docs/IDAM_DATA_FLOW_MERMAID.md` - Mermaid ë‹¤ì´ì–´ê·¸ë¨
- [Apollo Client ê³µì‹ ë¬¸ì„œ](https://www.apollographql.com/docs/react/)
- [GraphQL ê³µì‹ ì‚¬ì´íŠ¸](https://graphql.org/)
- [Next.js ê³µì‹ ë¬¸ì„œ](https://nextjs.org/docs)
- [Zustand ê³µì‹ ë¬¸ì„œ](https://github.com/pmndrs/zustand)

---

## ìµœê·¼ ì—…ë°ì´íŠ¸ ìš”ì•½

### v4.2 (2024ë…„ 11ì›” 17ì¼) - UI ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ ë° ë ˆì´ì•„ì›ƒ ì¡°ì •

**UI ìŠ¤íƒ€ì¼ ê°œì„ :**

1. **í°íŠ¸ í¬ê¸° ìµœì í™” (Option A ìŠ¤ì¼€ì¼)**
   - ê¸°ì¡´ 3ë‹¨ê³„ â†’ ìƒˆë¡œìš´ 7ë‹¨ê³„ í°íŠ¸ ìŠ¤ì¼€ì¼ (11px-20px)
   - `globals.css`ì—ì„œ ì •ì˜:
     ```css
     --font-size-xs: 0.6875rem;   /* 11px */
     --font-size-sm: 0.75rem;     /* 12px */
     --font-size-base: 0.8125rem; /* 13px */
     --font-size-lg: 0.875rem;    /* 14px */
     --font-size-xl: 1rem;        /* 16px */
     --font-size-2xl: 1.125rem;   /* 18px */
     --font-size-3xl: 1.25rem;    /* 20px */
     ```
   - íŒŒì¼: `app/globals.css`

2. **ì»´í¬ë„ŒíŠ¸ë³„ í°íŠ¸ ì ìš©**
   - Button: `text-xs` â†’ `text-base` (ë” ê°€ë…ì„± ì¢‹ìŒ)
   - Label: `text-sm` â†’ `text-lg` (í¼ ë¼ë²¨)
   - Form ë¼ë²¨: `text-xs` â†’ `text-sm` (í•„ë“œ ì„¤ëª…)
   - Page í—¤ë”: `text-3xl` â†’ `text-2xl` (ë” ë°”ë€ìŠ¤ ìˆìŒ)
   - Breadcrumb: `text-sm` â†’ `text-xs`
   - ì‚¬ìš©ìëª…: `text-sm` â†’ `text-lg`

3. **í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ìˆ˜ì •**
   - Import ê²½ë¡œ ì˜¤ë¥˜ ìˆ˜ì •: `./theme-provider` â†’ `@/lib/theme-provider`
   - ë²„íŠ¼ í¬ê¸°: 36x36 â†’ 32x32 (w-9 h-9 â†’ w-8 h-8)
   - ê²€ìƒ‰ ì…ë ¥ë°•ìŠ¤: height 36px â†’ 32px (h-9 â†’ h-8)
   - íŒŒì¼: `components/providers/theme-toggle.tsx`

4. **ë¼ì´íŠ¸ í…Œë§ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì •**
   - ë²„íŠ¼ ë°°ê²½ìƒ‰ ë¬¸ì œ: ë¼ì´íŠ¸ í…Œë§ˆì—ì„œë„ ë‹¤í¬ ìƒ‰ìƒìœ¼ë¡œ ë Œë”ë§ë¨
   - í•´ê²°: `bg-neutral-950` â†’ `bg-background/50` (CSS ë³€ìˆ˜ ì‚¬ìš©)
   - ì ìš©ëœ variant: `outline`, `secondary`, `destructive`
   - íŒŒì¼: `components/ui/button.tsx`

**ì»´í¬ë„ŒíŠ¸ ë ˆì´ì•„ì›ƒ ì¡°ì •:**

5. **í†µê³„ ì¹´ë“œ (Stat Card) ë†’ì´ ì¡°ì •**
   - ë†’ì´: h-32 (128px) â†’ h-28 (112px) (ë” ì½¤íŒ©íŠ¸í•¨)
   - ë‚´ë¶€ ë ˆì´ì•„ì›ƒ: `justify-center` â†’ `justify-between` (ìˆ˜ì§ ë°°ì¹˜)
   - íŒ¨ë”©: p-6 â†’ p-4
   - êµ¬ì¡°:
     ```
     ìƒë‹¨: ì œëª© (text-xs)
     ì¤‘ê°„: í° ê°’ (text-xl)
     í•˜ë‹¨: Trend + ì„¤ëª…
     ```
   - íŒŒì¼:
     - `components/stats/stats-card.tsx`
     - `features/dashboard/components/stat-card.tsx`

6. **ë°ì´í„° í…Œì´ë¸” í—¤ë” ë†’ì´ ì¡°ì •**
   - TableHead ë†’ì´: h-12 (48px) â†’ h-10 (40px)
   - íŒ¨ë”©: py-3 â†’ py-2
   - íŒŒì¼:
     - `components/data-table/data-table.tsx`
     - `tenants-web/components/data-table/data-table.tsx`
     - `tenants-web/components/data-table/data-table-advanced.tsx`

**ì˜í–¥ë°›ëŠ” íŒŒì¼ (ì´ 29ê°œ):**
- UI ì»´í¬ë„ŒíŠ¸: button, label, data-table (3ê°œ)
- ë ˆì´ì•„ì›ƒ: main-header, page-header, page, theme-toggle (4ê°œ)
- í†µê³„: stats-card, dashboard stat-card (2ê°œ)
- í¼: users-form (1ê°œ)
- í•„í„°: query-bar (1ê°œ)
- í…Œë§ˆ: theme-settings, theme-preview, theme-preview-card (3ê°œ)
- ì¸ì¦: signin, signup, logout, forgot-password, reset-password (5ê°œ)
- ê¸°íƒ€: tenant-growth-chart, resources, permissions, login-logs, plans (7ê°œ)

**ì´ì :**
- ì¼ê´€ëœ í°íŠ¸ ìŠ¤ì¼€ì¼ë¡œ ë” ì„¸ë ¨ëœ UI
- ëŒ€ì‹œë³´ë“œ ì¤‘ì‹¬ì˜ í°íŠ¸ í¬ê¸° ìµœì í™”
- ë¼ì´íŠ¸/ë‹¤í¬ í…Œë§ˆ ìë™ ì§€ì›
- ë” íš¨ìœ¨ì ì¸ ê³µê°„ í™œìš© (ì»´íŒ©íŠ¸í•œ ì¹´ë“œ, í…Œì´ë¸”)

---

### v4.1 (2024ë…„ 11ì›” 17ì¼) - í¼ ê°œì„  ë° í† í° ê°±ì‹  ìˆ˜ì •

**ë²„ê·¸ ìˆ˜ì •:**

1. **í† í° ê°±ì‹  GraphQL ì¿¼ë¦¬ ì˜¤ë¥˜ ìˆ˜ì •**
   - ë¬¸ì œ: `"badly formed hexadecimal UUID string"` ì˜¤ë¥˜
   - ì›ì¸: í† í° ê°±ì‹  ë®¤í…Œì´ì…˜ì—ì„œ 'auth' ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¶ˆí•„ìš”
   - ìˆ˜ì •:
     ```typescript
     // âŒ ë³€ê²½ ì „
     auth { refreshToken(input: $input) { ... } }

     // âœ… ë³€ê²½ í›„
     refreshToken(input: $input) { ... }
     ```
   - íŒŒì¼: `lib/apollo-client.ts` (ë¼ì¸ 1047)

2. **QueryText ì¦‰ì‹œ ê²€ìƒ‰ ë¬¸ì œ ìˆ˜ì •**
   - ë¬¸ì œ: ì‚¬ìš©ìê°€ íƒ€ì´í•‘ ì¤‘ì¼ ë•Œ ê° í‚¤ë§ˆë‹¤ GraphQL ì¿¼ë¦¬ ì‹¤í–‰
   - í•´ê²°: 500ms ë””ë°”ìš´ìŠ¤ ì¶”ê°€
   ```typescript
   // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
   const [queryText, setQueryTextLocal] = useState("");

   // GraphQL ì¿¼ë¦¬ëŠ” 500ms í›„ ì‹¤í–‰
   const [debouncedQueryText, setDebouncedQueryText] = useState("");
   useEffect(() => {
     const timer = setTimeout(() => {
       setDebouncedQueryText(queryText);
     }, 500);
     return () => clearTimeout(timer);
   }, [queryText]);
   ```
   - íŒŒì¼: `app/(main)/idam/users/page.tsx` (ë¼ì¸ 582-594)

**ê¸°ëŠ¥ ê°œì„ :**

3. **Edit ëª¨ë“œ ì—°ê²° êµ¬í˜„**
   - í…Œì´ë¸”ì˜ Edit ë²„íŠ¼ â†’ selectedId ì €ì¥ â†’ í¼ ë°ì´í„° ë¡œë“œ
   - êµ¬í˜„:
     ```typescript
     // Pageì—ì„œ
     const handleEdit = (user: User) => {
       setSelectedId(user.id);
       openForm();
     };

     // Zustand Storeì—
     setSelectedId: (id) => set({ selectedId: id })
     ```
   - íŒŒì¼: `app/(main)/idam/users/page.tsx` (ë¼ì¸ 640-646)
   - íŒŒì¼: `stores/users.store.ts` (ë¼ì¸ 1257)

4. **í¼ ë°ì´í„° ë¡œë“œ ê°œì„ **
   - ìƒì„± ëª¨ë“œ: ëª¨ë“  í•„ë“œ ì´ˆê¸°í™”
   - ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ë°ì´í„° ë¡œë“œ + username ë¹„í™œì„±í™”
   - useEffectì—ì„œ ì¡°ê±´ë¶€ reset() í˜¸ì¶œ:
   ```typescript
   useEffect(() => {
     if (initialData) {
       // ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
       reset({ ...initialData });
     } else {
       // ìƒì„± ëª¨ë“œ: ì´ˆê¸°í™”
       reset({ ...initialValues });
     }
   }, [initialData, reset]);
   ```
   - íŒŒì¼: `components/users-form.tsx` (ë¼ì¸ 563-592)

5. **Hint Icons êµ¬í˜„**
   - ê° í¼ í•„ë“œì— ë¬¼ìŒí‘œ ì•„ì´ì½˜ ì¶”ê°€
   - í´ë¦­ ì‹œ Popoverë¡œ ë„ì›€ë§ í‘œì‹œ
   - ë¼ë²¨ ìš°ì¸¡ì— ì •ë ¬ (`justify-between`)
   - íŒŒì¼: `components/users-form.tsx` (ë¼ì¸ 495-517)

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**
- `app/(main)/idam/users/page.tsx` (debounce, edit handler ì¶”ê°€)
- `components/users-form.tsx` (HintIcon, form reset ê°œì„ )
- `stores/users.store.ts` (setSelectedId, openForm ì¶”ê°€)
- `lib/apollo-client.ts` (í† í° ê°±ì‹  ì¿¼ë¦¬ ìˆ˜ì •)

---

### v4.0 (2024ë…„ 11ì›” 17ì¼) - Query í•„í„°ë§ & í•„í„° UI ì™„ì„±

**ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥:**

1. **Query ê¸°ë°˜ í•„í„°ë§ ì•„í‚¤í…ì²˜**
   - Jira ìŠ¤íƒ€ì¼ í•„í„°ë§: ììœ  ê²€ìƒ‰ í…ìŠ¤íŠ¸ + êµ¬ì¡°í™”ëœ í•„í„°
   - í•„í„° íŒì—…ì˜ ì„ì‹œ ìƒíƒœ ê´€ë¦¬ (tempQueryFilters)
   - ì‹¤ì‹œê°„ í•„í„° ê°œìˆ˜ í‘œì‹œ ë° ë°°ì§€ ì—…ë°ì´íŠ¸

2. **ê³µí†µ í•„í„° ì»´í¬ë„ŒíŠ¸** (`@/components/filters/`)
   - `QueryBar`: ê²€ìƒ‰ ì…ë ¥ + í•„í„° ë²„íŠ¼ UI
   - `QueryFilter`: QueryBar + QueryFilterPopup ë³µí•© ì»´í¬ë„ŒíŠ¸
   - `QueryFilterPopup`: Jira ìŠ¤íƒ€ì¼ ì¢Œìš° ë¶„í•  í•„í„° íŒì—…
   - `QueryCheckboxGroup`: ë©€í‹° ì„ íƒ ì²´í¬ë°•ìŠ¤

3. **í•„í„° UI ê°œì„ **
   - í•„í„° ì§€ìš°ê¸° ë²„íŠ¼ (X ì•„ì´ì½˜ + í…ìŠ¤íŠ¸)
   - í™œì„± í•„í„° ê°œìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ
   - í™”ë©´ ê¹œë¹¡ì„ ì œê±° (í˜ì´ì§€ ì´ˆê¸°í™” ì¶”ê°€)

4. **ìƒíƒœ ê´€ë¦¬ ê°œì„ **
   - UI ìƒíƒœ (í˜ì´ì§€, í¬ê¸°)ì™€ ì¿¼ë¦¬ ìƒíƒœ (í•„í„°) ë¶„ë¦¬
   - íŒì—…ì˜ ì„ì‹œ ìƒíƒœë¡œ ì„œë²„ ì¿¼ë¦¬ ì¦‰ì‹œ íŠ¸ë¦¬ê±° ë°©ì§€
   - í•„í„° ì´ˆê¸°í™” ì‹œ í˜ì´ì§€ ë²ˆí˜¸ë„ í•¨ê»˜ ì´ˆê¸°í™”

---

**ë²„ì „**: 4.2 (UI ìŠ¤íƒ€ì¼ & ë ˆì´ì•„ì›ƒ ì¡°ì •)
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„ 11ì›” 17ì¼
**ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ (Users ëª¨ë“ˆ ê¸°ì¤€)
