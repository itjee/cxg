# CXG í”Œë«í¼ - ë°°í¬ ì™„ì „ ê°€ì´ë“œ

> **í”„ë¡œë•ì…˜ ë°°í¬, ë§ˆì´ê·¸ë ˆì´ì…˜, ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜ ì™„ì „ ê°€ì´ë“œ**
> - **ëŒ€ìƒ ë…ì**: DevOps ì—”ì§€ë‹ˆì–´, ìš´ì˜íŒ€, ì‹œë‹ˆì–´ ê°œë°œì
> - **ì½ëŠ” ì‹œê°„**: 1.5-2ì‹œê°„
> - **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„ 11ì›” 8ì¼

---

## ëª©ì°¨

1. [ë¹ ë¥¸ ì‹œì‘](#ë¹ ë¥¸-ì‹œì‘)
2. [ë°°í¬ ì•„í‚¤í…ì²˜](#ë°°í¬-ì•„í‚¤í…ì²˜)
3. [ë°°í¬ í™˜ê²½ êµ¬ì„±](#ë°°í¬-í™˜ê²½-êµ¬ì„±)
4. [ë°°í¬ ì „ ì¤€ë¹„](#ë°°í¬-ì „-ì¤€ë¹„)
5. [ë°°í¬ í”„ë¡œì„¸ìŠ¤](#ë°°í¬-í”„ë¡œì„¸ìŠ¤)
6. [ë¬´ì¤‘ë‹¨ ë°°í¬ (Blue-Green)](#ë¬´ì¤‘ë‹¨-ë°°í¬-blue-green)
7. [ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜](#ë°ì´í„°ë² ì´ìŠ¤-ë§ˆì´ê·¸ë ˆì´ì…˜)
8. [ë¡¤ë°± ì „ëµ](#ë¡¤ë°±-ì „ëµ)
9. [ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…](#ëª¨ë‹ˆí„°ë§-ë°-ë¡œê¹…)
10. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
11. [ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸](#ë³´ì•ˆ-ì²´í¬ë¦¬ìŠ¤íŠ¸)
12. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ë¹ ë¥¸ ì‹œì‘

### ë°°í¬ í™˜ê²½ í™•ì¸

```bash
# ë°°í¬ ì „ í™•ì¸ì‚¬í•­
cd /home/itjee/workspace/cxg

# 1. ì½”ë“œ ìƒíƒœ í™•ì¸
git status
git log --oneline -5

# 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
cd apps/backend-api && pytest tests/
cd ../../apps/manager-web && pnpm test
cd ../../apps/tenants-web && pnpm test

# 3. ë¹Œë“œ í…ŒìŠ¤íŠ¸
cd apps/backend-api
pip install -r requirements.txt
mypy src/
ruff check src/

cd ../../apps/manager-web
pnpm install
pnpm build
pnpm type-check

cd ../../apps/tenants-web
pnpm install
pnpm build
pnpm type-check
```

### ë°°í¬ ëª…ë ¹ì–´ (Docker)

```bash
# ê°œë°œ í™˜ê²½
docker-compose -f docker-compose.dev.yml up -d

# ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜
docker-compose -f docker-compose.prod.yml up -d
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml logs -f
```

### í™˜ê²½ë³„ í¬íŠ¸

| í™˜ê²½ | Backend | Manager Web | Tenants Web | Database | Redis |
|------|---------|-------------|-------------|----------|-------|
| Dev | 8100 | 8200 | 8300 | 5432 | 6379 |
| Staging | 8100 | 8200 | 8300 | 5433 | 6380 |
| Prod | 8100 | 8200 | 8300 | 5434 | 6381 |

---

## ë°°í¬ ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì¸í„°ë„· ì‚¬ìš©ì                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  CloudFlare / CDN / WAF        â”‚
        â”‚  - DDoS ë°©ì–´                    â”‚
        â”‚  - ìºì‹±                         â”‚
        â”‚  - SSL/TLS                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚
        â†“                                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Manager Web       â”‚      â”‚   Tenants Web       â”‚
   â”‚  (í¬íŠ¸ 8200)        â”‚      â”‚  (í¬íŠ¸ 8300)        â”‚
   â”‚  - Next.js 15       â”‚      â”‚  - Next.js 15       â”‚
   â”‚  - React 19         â”‚      â”‚  - React 19         â”‚
   â”‚  - SPA ë¼ìš°íŒ…       â”‚      â”‚  - SPA ë¼ìš°íŒ…       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   ë¡œë“œ ë°¸ëŸ°ì„œ (Nginx/HAProxy)  â”‚
           â”‚  - SSL ì¢…ë£Œ                    â”‚
           â”‚  - ìš”ì²­ ë¶„ì‚°                   â”‚
           â”‚  - í—¬ìŠ¤ ì²´í¬                   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚
        â†“                                     â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Backend API #1  â”‚             â”‚  Backend API #2  â”‚
   â”‚  (í¬íŠ¸ 8100)     â”‚             â”‚  (í¬íŠ¸ 8100)     â”‚
   â”‚ - FastAPI       â”‚             â”‚ - FastAPI       â”‚
   â”‚ - ë¹„ë™ê¸° ì²˜ë¦¬    â”‚             â”‚ - ë¹„ë™ê¸° ì²˜ë¦¬    â”‚
   â”‚ - ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬â”‚             â”‚ - ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â†“                   â†“                   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Manager  â”‚        â”‚ Tenants  â”‚        â”‚ Redis  â”‚
   â”‚    DB    â”‚        â”‚    DB    â”‚        â”‚ Cache  â”‚
   â”‚PostgreSQLâ”‚        â”‚PostgreSQLâ”‚        â”‚ 6379   â”‚
   â”‚ 5432     â”‚        â”‚ 5432     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Kubernetes Cluster (í–¥í›„)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Worker-1   â”‚  â”‚   Worker-2   â”‚       â”‚
â”‚  â”‚  (4 cores)   â”‚  â”‚  (4 cores)   â”‚       â”‚
â”‚  â”‚  (8GB RAM)   â”‚  â”‚  (8GB RAM)   â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚       â”‚
â”‚  â”‚ Backend Pod  â”‚  â”‚ Backend Pod  â”‚       â”‚
â”‚  â”‚ Frontend Pod â”‚  â”‚ Frontend Pod â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Persistent Volume Store         â”‚  â”‚
â”‚  â”‚  - PostgreSQL Data                    â”‚  â”‚
â”‚  â”‚  - Redis Data                         â”‚  â”‚
â”‚  â”‚  - Backup Storage                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°°í¬ í™˜ê²½ êµ¬ì„±

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

#### ê°œë°œ í™˜ê²½ (.env.development)

```bash
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://dev:dev@localhost:5432/cxg_tenants_dev
MANAGER_DATABASE_URL=postgresql://dev:dev@localhost:5432/cxg_manager_dev

# Redis
REDIS_URL=redis://localhost:6379

# API ì„¤ì •
API_TITLE=CXG API (Development)
API_VERSION=1.0.0
DEBUG=true
LOG_LEVEL=DEBUG

# ë³´ì•ˆ (ê°œë°œìš©)
SECRET_KEY=dev-secret-key-not-for-production
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# CORS
CORS_ORIGINS=["http://localhost:8200","http://localhost:8300"]

# OpenAI (ì„ íƒ)
OPENAI_API_KEY=sk-...

# ë©”ì¼ (ì„ íƒ)
MAIL_SERVER=localhost
MAIL_PORT=1025
MAIL_USERNAME=dev
MAIL_PASSWORD=dev
```

#### ìŠ¤í…Œì´ì§• í™˜ê²½ (.env.staging)

```bash
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://staging_user:${STAGING_DB_PASSWORD}@staging-db.example.com:5432/cxg_tenants_staging
MANAGER_DATABASE_URL=postgresql://staging_user:${STAGING_DB_PASSWORD}@staging-db.example.com:5432/cxg_manager_staging

# Redis (í´ëŸ¬ìŠ¤í„°)
REDIS_URL=redis-cluster.staging.example.com:6379

# API ì„¤ì •
API_TITLE=CXG API (Staging)
API_VERSION=1.0.0
DEBUG=false
LOG_LEVEL=INFO

# ë³´ì•ˆ
SECRET_KEY=${STAGING_SECRET_KEY}
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# CORS
CORS_ORIGINS=["https://staging-manager.example.com","https://staging-tenants.example.com"]

# ëª¨ë‹ˆí„°ë§
SENTRY_DSN=${STAGING_SENTRY_DSN}
DD_API_KEY=${STAGING_DD_API_KEY}

# ì™¸ë¶€ ì„œë¹„ìŠ¤
OPENAI_API_KEY=${STAGING_OPENAI_KEY}
```

#### í”„ë¡œë•ì…˜ í™˜ê²½ (.env.production)

```bash
# ë°ì´í„°ë² ì´ìŠ¤ (ê´€ë¦¬í˜• ì„œë¹„ìŠ¤)
DATABASE_URL=postgresql://${PROD_DB_USER}:${PROD_DB_PASSWORD}@prod-db.example.com:5432/cxg_tenants_prod
MANAGER_DATABASE_URL=postgresql://${PROD_DB_USER}:${PROD_DB_PASSWORD}@prod-db.example.com:5432/cxg_manager_prod

# Redis (ê´€ë¦¬í˜• ì„œë¹„ìŠ¤)
REDIS_URL=redis-cluster.prod.example.com:6379

# API ì„¤ì •
API_TITLE=CXG API
API_VERSION=1.0.0
DEBUG=false
LOG_LEVEL=WARN

# ë³´ì•ˆ (ê°•ë ¥í•œ í‚¤ ì‚¬ìš©)
SECRET_KEY=${PROD_SECRET_KEY}
JWT_ALGORITHM=RS256
JWT_EXPIRATION_HOURS=4

# CORS (í”„ë¡œë•ì…˜ ë„ë©”ì¸ë§Œ)
CORS_ORIGINS=["https://manager.conexgrow.com","https://app.conexgrow.com"]

# ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
SENTRY_DSN=${PROD_SENTRY_DSN}
DD_API_KEY=${PROD_DD_API_KEY}
DATADOG_ENV=production

# ì™¸ë¶€ ì„œë¹„ìŠ¤
OPENAI_API_KEY=${PROD_OPENAI_KEY}

# ë³´ì•ˆ í—¤ë”
SECURE_HSTS_SECONDS=31536000
SECURE_SSL_REDIRECT=true
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
```

### Docker êµ¬ì„±

#### docker-compose.dev.yml

```yaml
version: '3.8'

services:
  # PostgreSQL Manager DB
  postgres-manager:
    image: postgres:15-alpine
    container_name: cxg-postgres-manager
    environment:
      POSTGRES_DB: cxg_manager_dev
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: dev
    ports:
      - "5432:5432"
    volumes:
      - postgres-manager-data:/var/lib/postgresql/data
    networks:
      - cxg-network

  # PostgreSQL Tenants DB
  postgres-tenants:
    image: postgres:15-alpine
    container_name: cxg-postgres-tenants
    environment:
      POSTGRES_DB: cxg_tenants_dev
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: dev
    ports:
      - "5433:5432"
    volumes:
      - postgres-tenants-data:/var/lib/postgresql/data
    networks:
      - cxg-network

  # Redis
  redis:
    image: redis:7-alpine
    container_name: cxg-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    networks:
      - cxg-network

  # Backend API
  backend-api:
    build:
      context: ./apps/backend-api
      dockerfile: Dockerfile
    container_name: cxg-backend-api
    environment:
      DATABASE_URL: postgresql://dev:dev@postgres-tenants:5432/cxg_tenants_dev
      MANAGER_DATABASE_URL: postgresql://dev:dev@postgres-manager:5432/cxg_manager_dev
      REDIS_URL: redis://redis:6379
      DEBUG: "true"
      LOG_LEVEL: DEBUG
    ports:
      - "8100:8000"
    volumes:
      - ./apps/backend-api:/app
    depends_on:
      - postgres-manager
      - postgres-tenants
      - redis
    networks:
      - cxg-network

  # Manager Web
  manager-web:
    build:
      context: ./apps/manager-web
      dockerfile: Dockerfile
    container_name: cxg-manager-web
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8100
    ports:
      - "8200:3000"
    volumes:
      - ./apps/manager-web:/app
    depends_on:
      - backend-api
    networks:
      - cxg-network

  # Tenants Web
  tenants-web:
    build:
      context: ./apps/tenants-web
      dockerfile: Dockerfile
    container_name: cxg-tenants-web
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8100
    ports:
      - "8300:3000"
    volumes:
      - ./apps/tenants-web:/app
    depends_on:
      - backend-api
    networks:
      - cxg-network

volumes:
  postgres-manager-data:
  postgres-tenants-data:
  redis-data:

networks:
  cxg-network:
    driver: bridge
```

#### Dockerfile (Backend)

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# ì˜ì¡´ì„± ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY src/ src/
COPY alembic/ alembic/
COPY alembic.ini .

# í—¬ìŠ¤ ì²´í¬
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD python -c "import requests; requests.get('http://localhost:8000/health')"

# Uvicorn ì‹œì‘
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### Dockerfile (Frontend - Next.js)

```dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install

COPY . .
RUN pnpm build

FROM node:20-alpine

WORKDIR /app

COPY --from=builder /app/package.json /app/pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --prod

COPY --from=builder /app/.next /app/.next
COPY --from=builder /app/public /app/public

HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD node -e "require('http').get('http://localhost:3000/health', r => r.statusCode === 200 ? process.exit(0) : process.exit(1))"

EXPOSE 3000
CMD ["pnpm", "start"]
```

---

## ë°°í¬ ì „ ì¤€ë¹„

### í”„ë¦¬í”Œë¼ì´íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
#!/bin/bash
# deploy-preflight-check.sh

set -e

echo "ğŸ” ë°°í¬ ì „ ì‚¬ì „ ì ê²€..."

# 1. ì½”ë“œ ìƒíƒœ í™•ì¸
echo "âœ“ Git ìƒíƒœ í™•ì¸..."
if [ -n "$(git status --porcelain)" ]; then
    echo "âŒ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤"
    exit 1
fi

# 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "âœ“ ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸..."
cd apps/backend-api
pytest tests/ --cov=src --cov-report=term-only
cd ../..

echo "âœ“ í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸..."
cd apps/manager-web
pnpm test -- --run
cd ../..

cd apps/tenants-web
pnpm test -- --run
cd ../..

# 3. íƒ€ì… ì²´í¬
echo "âœ“ íƒ€ì… ì²´í¬..."
cd apps/backend-api
mypy src/
cd ../..

cd apps/manager-web
pnpm type-check
cd ../..

# 4. Lint ì‹¤í–‰
echo "âœ“ ë¦°íŠ¸ í™•ì¸..."
cd apps/backend-api
ruff check src/
cd ../..

cd apps/manager-web
pnpm lint
cd ../..

# 5. ë¹Œë“œ í…ŒìŠ¤íŠ¸
echo "âœ“ ë¹Œë“œ í…ŒìŠ¤íŠ¸..."
cd apps/backend-api
python -m pip install -r requirements.txt
cd ../..

cd apps/manager-web
pnpm build
cd ../..

cd apps/tenants-web
pnpm build
cd ../..

# 6. ë³´ì•ˆ ì²´í¬
echo "âœ“ ë³´ì•ˆ ì ê²€..."
cd apps/backend-api
bandit -r src/
cd ../..

cd apps/manager-web
npm audit --audit-level=moderate
cd ../..

echo "âœ… ëª¨ë“  ì‚¬ì „ ì ê²€ ì™„ë£Œ!"
```

### ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…

```bash
#!/bin/bash
# backup-databases.sh

BACKUP_DIR="./backups/$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"

echo "ğŸ“¦ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹œì‘..."

# Manager DB ë°±ì—…
echo "  - Manager DB ë°±ì—…..."
pg_dump -U dev -h localhost -d cxg_manager_dev > "$BACKUP_DIR/manager_db.sql"

# Tenants DB ë°±ì—…
echo "  - Tenants DB ë°±ì—…..."
pg_dump -U dev -h localhost -d cxg_tenants_dev > "$BACKUP_DIR/tenants_db.sql"

# ì••ì¶•
echo "  - ì••ì¶•..."
tar -czf "$BACKUP_DIR.tar.gz" "$BACKUP_DIR"
rm -rf "$BACKUP_DIR"

echo "âœ… ë°±ì—… ì™„ë£Œ: $BACKUP_DIR.tar.gz"
```

---

## ë°°í¬ í”„ë¡œì„¸ìŠ¤

### ë‹¨ê³„ë³„ ë°°í¬ (Rolling Deployment)

```bash
#!/bin/bash
# deploy.sh

set -e

ENVIRONMENT=${1:-staging}
DEPLOYMENT_ID=$(date +%s)

echo "ğŸš€ ë°°í¬ ì‹œì‘: $ENVIRONMENT ($DEPLOYMENT_ID)"

# 1. ì‚¬ì „ ì ê²€
echo "ğŸ“‹ ì‚¬ì „ ì ê²€..."
./scripts/deploy-preflight-check.sh

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
echo "ğŸ“¦ ë°±ì—…..."
./scripts/backup-databases.sh

# 3. ì´ë¯¸ì§€ ë¹Œë“œ
echo "ğŸ”¨ ì´ë¯¸ì§€ ë¹Œë“œ..."
docker-compose -f docker-compose.$ENVIRONMENT.yml build --no-cache

# 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜..."
docker-compose -f docker-compose.$ENVIRONMENT.yml run backend-api alembic upgrade head

# 5. í—¬ìŠ¤ ì²´í¬
echo "ğŸ¥ í—¬ìŠ¤ ì²´í¬..."
for i in {1..30}; do
    if curl -f http://localhost:8100/health > /dev/null 2>&1; then
        echo "âœ“ ë°±ì—”ë“œ í—¬ìŠ¤ ì²´í¬ ì„±ê³µ"
        break
    fi
    echo "  ì¬ì‹œë„ $i/30..."
    sleep 2
done

# 6. ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸
echo "ğŸ§ª ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸..."
./scripts/smoke-tests.sh

# 7. ë°°í¬ ì™„ë£Œ
echo "âœ… ë°°í¬ ì™„ë£Œ"
echo "ë°°í¬ ID: $DEPLOYMENT_ID"
echo "í™˜ê²½: $ENVIRONMENT"
echo "ì‹œê°„: $(date)"
```

### ì¹´ë‚˜ë¦¬ ë°°í¬ (Canary Deployment)

```bash
#!/bin/bash
# deploy-canary.sh

echo "ğŸ¯ ì¹´ë‚˜ë¦¬ ë°°í¬ ì‹œì‘..."

# 1ë‹¨ê³„: 10% íŠ¸ë˜í”½
echo "ğŸ“Š ë¼ìš´ë“œ 1: 10% íŠ¸ë˜í”½"
kubectl set image deployment/backend backend=registry.example.com/cxg-backend:latest-canary
kubectl patch deployment backend -p '{"spec":{"replicas":10}}'
kubectl patch service backend -p '{"spec":{"selector":{"version":"canary"}}}'

# ëª¨ë‹ˆí„°ë§
sleep 60
ERROR_RATE=$(curl -s http://prometheus:9090/api/v1/query?query=rate\(errors_total\[5m\]\) | jq '.data.result[0].value[1]' | tr -d '"')
if (( $(echo "$ERROR_RATE > 0.05" | bc -l) )); then
    echo "âŒ ì—ëŸ¬ìœ¨ ë†’ìŒ, ë¡¤ë°±"
    ./scripts/rollback.sh
    exit 1
fi

# 2ë‹¨ê³„: 50% íŠ¸ë˜í”½
echo "ğŸ“Š ë¼ìš´ë“œ 2: 50% íŠ¸ë˜í”½"
kubectl patch deployment backend -p '{"spec":{"replicas":50}}'
sleep 120

# 3ë‹¨ê³„: 100% íŠ¸ë˜í”½
echo "ğŸ“Š ë¼ìš´ë“œ 3: 100% íŠ¸ë˜í”½"
kubectl patch deployment backend -p '{"spec":{"replicas":100}}'
kubectl patch service backend -p '{"spec":{"selector":{"version":"stable"}}}'

echo "âœ… ì¹´ë‚˜ë¦¬ ë°°í¬ ì™„ë£Œ"
```

---

## ë¬´ì¤‘ë‹¨ ë°°í¬ (Blue-Green)

### Blue-Green ë°°í¬ ì „ëµ

```
ì‹œê°„ 0ë¶„: Blue í™˜ê²½ (ìš´ì˜ì¤‘)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Blue (ìš´ì˜)    â”‚ â† íŠ¸ë˜í”½ 100%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‹œê°„ 1-5ë¶„: Green í™˜ê²½ ì¤€ë¹„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Blue (ìš´ì˜)    â”‚       â”‚  Green (ì¤€ë¹„)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†  íŠ¸ë˜í”½ 100%            â† í…ŒìŠ¤íŠ¸ ì¤‘

ì‹œê°„ 5ë¶„: íŠ¸ë˜í”½ ì „í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Blue (ëŒ€ê¸°)    â”‚       â”‚  Green (ìš´ì˜)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â† 0%                 â† íŠ¸ë˜í”½ 100%

ì‹œê°„ 10ë¶„ ì´í›„: Blue ì œê±°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Green (ìš´ì˜)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â† íŠ¸ë˜í”½ 100%
```

### Blue-Green ë°°í¬ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# deploy-blue-green.sh

set -e

BLUE_PORT=8001
GREEN_PORT=8002
PRODUCTION_PORT=8100
HEALTH_CHECK_URL="/health"

echo "ğŸ”„ Blue-Green ë°°í¬ ì‹œì‘..."

# 1. Green í™˜ê²½ ì‹œì‘
echo "ğŸŸ¢ Green í™˜ê²½ ì‹œì‘..."
docker-compose -f docker-compose.green.yml up -d
docker-compose -f docker-compose.green.yml run backend-api alembic upgrade head

# 2. Green í—¬ìŠ¤ ì²´í¬
echo "ğŸ¥ Green í—¬ìŠ¤ ì²´í¬..."
for i in {1..30}; do
    if curl -f http://localhost:$GREEN_PORT$HEALTH_CHECK_URL > /dev/null 2>&1; then
        echo "âœ“ Green í—¬ìŠ¤ ì²´í¬ ì„±ê³µ"
        break
    fi
    echo "  ì¬ì‹œë„ $i/30..."
    sleep 2
done

# 3. Green ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸
echo "ğŸ§ª Green ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸..."
curl -f http://localhost:$GREEN_PORT/api/v1/health || exit 1

# 4. íŠ¸ë˜í”½ ì „í™˜ (ë¡œë“œ ë°¸ëŸ°ì„œ)
echo "ğŸ”€ íŠ¸ë˜í”½ ì „í™˜..."
# Nginx ì„¤ì • ì—…ë°ì´íŠ¸ ë° ë¦¬ë¡œë“œ
sed -i "s/server localhost:$BLUE_PORT;/server localhost:$GREEN_PORT;/g" /etc/nginx/conf.d/upstream.conf
nginx -s reload

# 5. Blue í™˜ê²½ ì¤‘ì§€
echo "ğŸ”µ Blue í™˜ê²½ ì¤‘ì§€..."
sleep 10  # ì—°ê²° ì •ë¦¬ ëŒ€ê¸°
docker-compose -f docker-compose.blue.yml down

# 6. ë¡¤ì•„ì›ƒ ê²€ì¦
echo "âœ… ë°°í¬ ì™„ë£Œ"
echo "í˜„ì¬ í™˜ê²½: Green (í¬íŠ¸ $GREEN_PORT)"
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

```bash
#!/bin/bash
# migrate-database.sh

set -e

ENVIRONMENT=${1:-staging}
DB_URL=${DATABASE_URL}

echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ($ENVIRONMENT)"

# 1. í˜„ì¬ ìƒíƒœ í™•ì¸
echo "ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬..."
alembic history --verbose

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚¬ì „ ê²€ì‚¬
echo "ğŸ” ë§ˆì´ê·¸ë ˆì´ì…˜ ìœ íš¨ì„± ê²€ì‚¬..."
alembic upgrade head --sql > /tmp/migration.sql
echo "ì˜ˆì •ëœ SQL:"
cat /tmp/migration.sql

# 3. ë°±ì—… (í”„ë¡œë•ì…˜ë§Œ)
if [ "$ENVIRONMENT" = "production" ]; then
    echo "ğŸ“¦ í”„ë¡œë•ì…˜ ë°±ì—…..."
    pg_dump "$DB_URL" > /tmp/pre-migration.sql
fi

# 4. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
echo "âš™ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰..."
alembic upgrade head

# 5. ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€ì¦
echo "âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€ì¦..."
alembic current

echo "âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ"
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì„± ê°€ì´ë“œ

```python
"""Create user table

Revision ID: ae1027a6acf
Create Date: 2024-11-08 12:00:00.000000

"""
from alembic import op
import sqlalchemy as sa
from datetime import datetime

# ë¦¬ë¹„ì „ ì‹ë³„ì
revision = 'ae1027a6acf'
down_revision = None
branch_labels = None
depends_on = None


def upgrade() -> None:
    """ì—…ê·¸ë ˆì´ë“œ ë¡œì§"""
    op.create_table(
        'user',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(50), nullable=False, unique=True),
        sa.Column('email', sa.String(120), nullable=False, unique=True),
        sa.Column('password_hash', sa.String(255), nullable=False),
        sa.Column('is_active', sa.Boolean(), default=True),
        sa.Column('created_at', sa.DateTime(), default=datetime.utcnow),
        sa.Column('updated_at', sa.DateTime(), default=datetime.utcnow, onupdate=datetime.utcnow),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_email'), 'user', ['email'], unique=True)
    op.create_index(op.f('ix_user_username'), 'user', ['username'], unique=True)


def downgrade() -> None:
    """ë‹¤ìš´ê·¸ë ˆì´ë“œ ë¡œì§"""
    op.drop_index(op.f('ix_user_username'), table_name='user')
    op.drop_index(op.f('ix_user_email'), table_name='user')
    op.drop_table('user')
```

---

## ë¡¤ë°± ì „ëµ

### ìë™ ë¡¤ë°± ì¡°ê±´

```yaml
# monitoring/rollback-rules.yaml
rollback_conditions:
  error_rate:
    threshold: 0.05  # 5%
    duration: 300    # 5ë¶„ ì´ìƒ ì§€ì†
    action: automatic_rollback

  response_time:
    threshold_p99: 5000  # 5ì´ˆ
    duration: 300        # 5ë¶„ ì´ìƒ ì§€ì†
    action: automatic_rollback

  cpu_usage:
    threshold: 0.90  # 90%
    duration: 600    # 10ë¶„ ì´ìƒ ì§€ì†
    action: automatic_rollback

  memory_usage:
    threshold: 0.85  # 85%
    duration: 600    # 10ë¶„ ì´ìƒ ì§€ì†
    action: automatic_rollback
```

### ìˆ˜ë™ ë¡¤ë°± í”„ë¡œì„¸ìŠ¤

```bash
#!/bin/bash
# rollback.sh

set -e

echo "â®ï¸ ë¡¤ë°± í”„ë¡œì„¸ìŠ¤ ì‹œì‘..."

# 1. í˜„ì¬ ë²„ì „ í™•ì¸
CURRENT_VERSION=$(docker-compose exec backend-api alembic current | grep -oE '[a-z0-9]{12}' | head -1)
echo "í˜„ì¬ ë²„ì „: $CURRENT_VERSION"

# 2. ì´ì „ ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
echo "ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë¡¤ë°±..."
docker-compose exec backend-api alembic downgrade -1

# 3. ì´ì „ ì´ë¯¸ì§€ë¡œ ë°°í¬
echo "ğŸ”„ ì´ë¯¸ì§€ ë¡¤ë°±..."
docker-compose down
docker-compose -f docker-compose.blue.yml up -d

# 4. í—¬ìŠ¤ ì²´í¬
echo "ğŸ¥ í—¬ìŠ¤ ì²´í¬..."
for i in {1..30}; do
    if curl -f http://localhost:8100/health > /dev/null 2>&1; then
        echo "âœ“ ë¡¤ë°± ì™„ë£Œ"
        break
    fi
    sleep 2
done

# 5. ê²€ì¦
echo "ğŸ§ª ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸..."
./scripts/smoke-tests.sh

echo "âœ… ë¡¤ë°± ì™„ë£Œ"
```

---

## ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### Prometheus ì„¤ì •

```yaml
# monitoring/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'backend-api'
    static_configs:
      - targets: ['localhost:8100']
    metrics_path: '/metrics'

  - job_name: 'postgres'
    static_configs:
      - targets: ['localhost:5432']

  - job_name: 'redis'
    static_configs:
      - targets: ['localhost:6379']
```

### ë¡œê¹… ì „ëµ

```python
# src/core/logging.py
import logging
from pythonjsonlogger import jsonlogger
import sys

# JSON ë¡œê±° ì„¤ì •
def setup_logging():
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)

    # ì½˜ì†” í•¸ë“¤ëŸ¬ (JSON)
    console_handler = logging.StreamHandler(sys.stdout)
    console_handler.setLevel(logging.INFO)
    formatter = jsonlogger.JsonFormatter()
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)

    return logger

logger = setup_logging()

# ì‚¬ìš© ì˜ˆ
logger.info("User login", extra={
    "user_id": 123,
    "timestamp": "2024-11-08T12:00:00Z",
    "ip": "192.168.1.1"
})
```

### Datadog í†µí•©

```python
# src/core/monitoring.py
from ddtrace import tracer, patch_all
from ddtrace.ext import http

# ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ íŒ¨ì¹˜
patch_all()

# ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­
from datadog import initialize, api

options = {
    'api_key': os.getenv('DD_API_KEY'),
    'app_key': os.getenv('DD_APP_KEY')
}

initialize(**options)

# ë©”íŠ¸ë¦­ ì „ì†¡
api.Metric.send(
    metric='cxg.api.request_count',
    points=1,
    tags=['env:production', 'service:backend-api']
)
```

---

## ì„±ëŠ¥ ìµœì í™”

### ë°±ì—”ë“œ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
â–¡ ì¸ë±ìŠ¤ ìƒì„± (ì™¸ë˜í‚¤, ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì—´)
â–¡ ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë¶„ì„ (EXPLAIN ANALYZE)
â–¡ í…Œì´ë¸” í†µê³„ ì—…ë°ì´íŠ¸ (ANALYZE)
â–¡ ì—°ê²° í’€ íŠœë‹
â–¡ ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê¹…

# ìºì‹± ìµœì í™”
â–¡ Redis í‚¤ ì„¤ê³„ (TTL ì„¤ì •)
â–¡ ìºì‹œ ì›Œë° ì „ëµ
â–¡ ìºì‹œ ë¬´íš¨í™” ì „ëµ
â–¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

# API ìµœì í™”
â–¡ í˜ì´ì§€ ì²˜ë¦¬ (pagination)
â–¡ ì‘ë‹µ ì••ì¶• (gzip)
â–¡ HTTP ìºì‹œ í—¤ë”
â–¡ ì—°ê²° ì¬ì‚¬ìš© (connection pooling)

# ë¹„ë™ê¸° ì²˜ë¦¬
â–¡ ë¹„ë™ê¸° ì‘ì—… í (Celery, RQ)
â–¡ ì´ë©”ì¼ ë°œì†¡ ë¹„ë™ê¸°í™”
â–¡ ë¦¬í¬íŠ¸ ìƒì„± ë¹„ë™ê¸°í™”
â–¡ ë°°ì¹˜ ì‘ì—… ìŠ¤ì¼€ì¤„ë§
```

### í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# ë²ˆë“¤ ìµœì í™”
â–¡ ë²ˆë“¤ í¬ê¸° ë¶„ì„ (bundle-analyzer)
â–¡ Code Splitting (ë™ì  import)
â–¡ Tree Shaking (ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ ì œê±°)
â–¡ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìµœì†Œí™”

# ì´ë¯¸ì§€ ìµœì í™”
â–¡ ì´ë¯¸ì§€ ì••ì¶• (ImageOptim, TinyPNG)
â–¡ WebP í˜•ì‹ ì§€ì›
â–¡ ë°˜ì‘í˜• ì´ë¯¸ì§€ (srcset)
â–¡ ë ˆì´ì§€ ë¡œë”©

# ì„±ëŠ¥ ì§€í‘œ
â–¡ Core Web Vitals ì¸¡ì •
  - LCP (Largest Contentful Paint): < 2.5s
  - FID (First Input Delay): < 100ms
  - CLS (Cumulative Layout Shift): < 0.1

â–¡ ë¹Œë“œ ì‹œê°„ ìµœì í™”
â–¡ ìºì‹œ ì „ëµ (long-term caching)
```

---

## ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ ë³´ì•ˆ ì ê²€

```bash
#!/bin/bash
# security-check.sh

echo "ğŸ” ë³´ì•ˆ ì ê²€..."

# 1. ì˜ì¡´ì„± ì·¨ì•½ì 
echo "ğŸ“¦ ì˜ì¡´ì„± ì·¨ì•½ì  ê²€ì‚¬..."
pip audit  # Python
npm audit  # Node.js
npm audit --audit-level=moderate || exit 1

# 2. ì •ì  ë¶„ì„
echo "ğŸ” ì •ì  ë¶„ì„..."
cd apps/backend-api
bandit -r src/ -ll
cd ../..

cd apps/manager-web
eslint . --max-warnings 0
cd ../..

# 3. í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo "ğŸ”‘ í™˜ê²½ ë³€ìˆ˜ í™•ì¸..."
if grep -r "password\|secret\|key" .env* 2>/dev/null; then
    echo "âŒ í•˜ë“œì½”ë”©ëœ ì•”í˜¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤"
    exit 1
fi

# 4. .gitignore í™•ì¸
echo "ğŸ“ ë¯¼ê°í•œ íŒŒì¼ í™•ì¸..."
if git ls-files | grep -E "\.env|\.key|secret|password"; then
    echo "âŒ ë¯¼ê°í•œ íŒŒì¼ì´ Gitì— ì»¤ë°‹ë˜ì—ˆìŠµë‹ˆë‹¤"
    exit 1
fi

# 5. HTTPS/SSL í™•ì¸
echo "ğŸ”’ SSL ì¸ì¦ì„œ í™•ì¸..."
openssl s_client -connect example.com:443 -servername example.com </dev/null | \
    openssl x509 -noout -dates

# 6. ë³´ì•ˆ í—¤ë” í™•ì¸
echo "ğŸ“‹ ë³´ì•ˆ í—¤ë” í™•ì¸..."
curl -I https://example.com | grep -E "Strict-Transport-Security|Content-Security-Policy|X-Content-Type-Options"

echo "âœ… ë³´ì•ˆ ì ê²€ ì™„ë£Œ"
```

### í”„ë¡œë•ì…˜ ë³´ì•ˆ ì„¤ì •

```python
# src/core/security.py
from fastapi.middleware.cors import CORSMiddleware
from fastapi.middleware.trustedhost import TrustedHostMiddleware
from starlette.middleware.gzip import GZIPMiddleware

def add_security_middleware(app: FastAPI):
    """ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€"""

    # CORS ì„¤ì • (ì—„ê²©í•œ)
    app.add_middleware(
        CORSMiddleware,
        allow_origins=[os.getenv("CORS_ORIGINS", "").split(",")],
        allow_credentials=True,
        allow_methods=["GET", "POST", "PUT", "DELETE"],
        allow_headers=["*"],
        max_age=600,
    )

    # ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” í˜¸ìŠ¤íŠ¸ë§Œ í—ˆìš©
    app.add_middleware(
        TrustedHostMiddleware,
        allowed_hosts=["example.com", "*.example.com"]
    )

    # Gzip ì••ì¶•
    app.add_middleware(GZIPMiddleware, minimum_size=1000)

    # ë³´ì•ˆ í—¤ë”
    @app.middleware("http")
    async def add_security_headers(request: Request, call_next):
        response = await call_next(request)
        response.headers["Strict-Transport-Security"] = "max-age=31536000; includeSubDomains"
        response.headers["X-Content-Type-Options"] = "nosniff"
        response.headers["X-Frame-Options"] = "DENY"
        response.headers["Content-Security-Policy"] = "default-src 'self'"
        response.headers["X-XSS-Protection"] = "1; mode=block"
        return response
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë°°í¬ í›„ ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

```bash
# ë¬¸ì œ ì§„ë‹¨
docker-compose logs postgres
psql -U dev -h localhost -d cxg_manager_dev -c "SELECT 1"

# í•´ê²° ë°©ë²•
# 1. ì—°ê²° ë¬¸ìì—´ í™•ì¸
echo $DATABASE_URL

# 2. ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘ í™•ì¸
docker-compose ps postgres

# 3. ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker network ls
docker inspect cxg-network

# 4. ì—°ê²° í’€ ì¬ì„¤ì •
docker-compose restart backend-api
```

#### 2. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜

```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
docker stats cxg-backend-api

# í™ ë¤í”„ ìƒì„± (Python)
python -m tracemalloc src/main.py

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¶„ì„
objgraph.show_most_common_types(limit=20)
```

#### 3. ë†’ì€ ì‘ë‹µ ì‹œê°„

```bash
# ìŠ¬ë¡œìš° ì¿¼ë¦¬ í™•ì¸
docker-compose exec postgres psql -U dev -d cxg_manager_dev << EOF
SELECT query, calls, mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
EOF

# ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë¶„ì„
EXPLAIN ANALYZE SELECT * FROM user WHERE id = 1;

# ì¸ë±ìŠ¤ í™•ì¸
SELECT * FROM pg_stat_user_indexes;
```

#### 4. íŒŒì¼ ì‹œìŠ¤í…œ ê°€ë“ ì°¸

```bash
# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸
df -h
du -sh ./*

# Docker ì´ë¯¸ì§€/ì»¨í…Œì´ë„ˆ ì •ë¦¬
docker system prune -a
docker image prune -a

# ë¡œê·¸ íŒŒì¼ ì •ë¦¬
find /var/lib/docker/containers -name "*-json.log" -delete
```

### ë¡¤ë°± í•„ìš” ì‹œ

```bash
#!/bin/bash
# emergency-rollback.sh

echo "ğŸ†˜ ê¸´ê¸‰ ë¡¤ë°±..."

# 1. íŠ¸ë˜í”½ ì°¨ë‹¨ (ë¡œë“œ ë°¸ëŸ°ì„œ)
nginx -s stop

# 2. í˜„ì¬ ìƒíƒœ ì €ì¥
docker-compose logs > /tmp/logs-$(date +%s).tar.gz
pg_dump $(echo $DATABASE_URL | grep -oE 'postgres://[^/]+') > /tmp/db-backup.sql

# 3. ì´ì „ ë²„ì „ ë°°í¬
docker-compose down
git checkout HEAD~1
docker-compose up -d

# 4. í—¬ìŠ¤ ì²´í¬
sleep 10
curl http://localhost:8100/health || exit 1

# 5. íŠ¸ë˜í”½ ì¬ê°œ
nginx

echo "âœ… ê¸´ê¸‰ ë¡¤ë°± ì™„ë£Œ"
```

---

ë” ìì„¸í•œ ë‚´ìš©ì€:
- [ì•„í‚¤í…ì²˜ ê°€ì´ë“œ](../02_architecture/01_ì•„í‚¤í…ì²˜_ì¢…í•©ê°€ì´ë“œ_20241108.md)
- [API ê°œë°œ ê°€ì´ë“œ](../04_api/01_APIê°œë°œê°€ì´ë“œ_20241108.md)
- [ë°ì´í„°ë² ì´ìŠ¤ ê°€ì´ë“œ](../03_database/00_ë°ì´í„°ë² ì´ìŠ¤_ê°€ì´ë“œ_20241108.md)

ë°°í¬ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”! ğŸš€
